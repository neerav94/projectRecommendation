Characterizing Overlapping Galaxies
Using Machine Learning Techniques∗

Luis Alvarez

Stanford University

(Dated: December 12, 2014)

As next generation telescopes enhance our ability to see dimmer objects in outer space, the number
of optically overlapping galaxies in astronomical images increases. Measurements of galaxy shapes
must now account for blended objects. This research attempts to study the classiﬁcation of blended
objects using machine learning techniques.

I.

INTRODUCTION

II. METHODOLOGY

Gravitational lensing, the bending of light through
gravitational ﬁelds, provides insight into current prob-
lems in cosmology concerning the nature of dark matter
and dark energy, mysterious components of the universe
that do not emit light yet play a fundamental role in the
time evolution of the universe.

Gravitational lensing studies are able to estimate the
amount of dark matter and luminous matter by observ-
ing light emitted from galaxies distorted by dark matter;
galaxy shapes are the key observables. Optically overlap-
ping galaxies present a challenge to existing shape algo-
rithms therefore classifying and resolving blended proﬁles
into respective components are critical for lensing studies
that will collect information on billions of galaxies such as
the Large Synoptic Survey Telescope (LSST) beginning
in 2019.

A. Deﬁnitions

In this paper we use the following terminology:
• A postage stamp describes an image that bounds a
particular object of interest; a representative size is
about 30 x 30 pixels depending on the size of the
object.

• An object may consist of a blend of two or more

distinct proﬁles or one proﬁle.

• Each object contains a ﬂux density that describes

the number of counts per pixel.

• The ﬂux is the sum of ﬂux values over all pixels, or

the total count.

• A catalog denotes the set of all objects, with corre-

sponding postage stamps.

∗ Thank you to Patricia Burchat, Mandeep S.S. Gill, and Joshua
Evan Meyers for providing me with the wonderful opportunity to
learn about weak lensing and for providing a rich and engaging
learning environment.

A. Goal

We aim to predict whether the object in a given
postage stamp is composed of two or more proﬁles or
only one proﬁle. This corresponds to two or more galax-
ies or only one galaxy.

B. Data Collection

We use an open-source galaxy simulation package
called Galsim[3] to simulate astronomical images. We
create single or blended objects using a number of ﬂux
densities and sampling methods and can simulate a cat-
alog of postage stamps under the real conditions a future
survey is likely to encounter. The Point-Spread Function
(PSF), the model of the eﬀects of atmospheric turbulence
on images and sky-noise, the uncertainty in the bright-
ness of the sky at a given moment during exposure times
are modeled in Galsim and give it the power to approx-
imate real conditions; Fig 1. provides such an example.
For any single proﬁle, we specify the following parame-
ters:

• Flux (Photon Counts)
• Half-light Radius (Size)
• Ellipticity Component 1 (e1)
• Ellipticity Component 2 (e2)
• x0 of Centroid
• y0 of Centroid

with e1 and e2 such that(cid:112)e2

1 + e2

2 ≤ 1

Using Galsim gives us the distinct advantage of creat-
ing postage stamps of blended and non-blended objects
while knowing the class label. We begin our study in the
simplest scenario: no sky noise, no PSF, and maintain
each proﬁle as a Gaussian such that blends are sums of
Gaussians. Object parameters are distributed uniformly
such that the majority of ﬂux does not lie outside the
postage stamp. We generate 1000 postage stamps with

Characterizing Overlapping Galaxies
Using Machine Learning Techniques∗

Luis Alvarez

Stanford University

(Dated: December 12, 2014)

As next generation telescopes enhance our ability to see dimmer objects in outer space, the number
of optically overlapping galaxies in astronomical images increases. Measurements of galaxy shapes
must now account for blended objects. This research attempts to study the classiﬁcation of blended
objects using machine learning techniques.

I.

INTRODUCTION

II. METHODOLOGY

Gravitational lensing, the bending of light through
gravitational ﬁelds, provides insight into current prob-
lems in cosmology concerning the nature of dark matter
and dark energy, mysterious components of the universe
that do not emit light yet play a fundamental role in the
time evolution of the universe.

Gravitational lensing studies are able to estimate the
amount of dark matter and luminous matter by observ-
ing light emitted from galaxies distorted by dark matter;
galaxy shapes are the key observables. Optically overlap-
ping galaxies present a challenge to existing shape algo-
rithms therefore classifying and resolving blended proﬁles
into respective components are critical for lensing studies
that will collect information on billions of galaxies such as
the Large Synoptic Survey Telescope (LSST) beginning
in 2019.

A. Deﬁnitions

In this paper we use the following terminology:
• A postage stamp describes an image that bounds a
particular object of interest; a representative size is
about 30 x 30 pixels depending on the size of the
object.

• An object may consist of a blend of two or more

distinct proﬁles or one proﬁle.

• Each object contains a ﬂux density that describes

the number of counts per pixel.

• The ﬂux is the sum of ﬂux values over all pixels, or

the total count.

• A catalog denotes the set of all objects, with corre-

sponding postage stamps.

∗ Thank you to Patricia Burchat, Mandeep S.S. Gill, and Joshua
Evan Meyers for providing me with the wonderful opportunity to
learn about weak lensing and for providing a rich and engaging
learning environment.

A. Goal

We aim to predict whether the object in a given
postage stamp is composed of two or more proﬁles or
only one proﬁle. This corresponds to two or more galax-
ies or only one galaxy.

B. Data Collection

We use an open-source galaxy simulation package
called Galsim[3] to simulate astronomical images. We
create single or blended objects using a number of ﬂux
densities and sampling methods and can simulate a cat-
alog of postage stamps under the real conditions a future
survey is likely to encounter. The Point-Spread Function
(PSF), the model of the eﬀects of atmospheric turbulence
on images and sky-noise, the uncertainty in the bright-
ness of the sky at a given moment during exposure times
are modeled in Galsim and give it the power to approx-
imate real conditions; Fig 1. provides such an example.
For any single proﬁle, we specify the following parame-
ters:

• Flux (Photon Counts)
• Half-light Radius (Size)
• Ellipticity Component 1 (e1)
• Ellipticity Component 2 (e2)
• x0 of Centroid
• y0 of Centroid

with e1 and e2 such that(cid:112)e2

1 + e2

2 ≤ 1

Using Galsim gives us the distinct advantage of creat-
ing postage stamps of blended and non-blended objects
while knowing the class label. We begin our study in the
simplest scenario: no sky noise, no PSF, and maintain
each proﬁle as a Gaussian such that blends are sums of
Gaussians. Object parameters are distributed uniformly
such that the majority of ﬂux does not lie outside the
postage stamp. We generate 1000 postage stamps with

2

2. Asymmetry

Highly overlapping galaxies exhibit large asymmetry
due luminosity proﬁles that are rotationally variant2. If
a postage stamp of unique overlapping galaxies is rotated
180◦and then subtracted from the original non-rotated
postage stamp, many pixels from the residual image may
be non-zero. This simple procedure produces a statis-
tic that identiﬁes whether the object in a given postage
stamp is likely to be a blend. We use the following deﬁ-
nition of asymmetry2:

Aabs =

1
2

|Xorg,i − Xrot,i|

|Xorg,i|

(2)

n(cid:88)

i

FIG. 1. Example Image

Where Xorg,i is the ﬂux count in the ith pixel of the
original image, Xrot,i is the ﬂux count in the ith pixel of
the rotated image, and n is the number of pixels in the
postage stamp. We choose the center of rotation such
that Aabs is minimized by computing Aabs in all pixels
and choosing the minimal value of Aabs corresponding to
the center of rotation.

roughly half blends and half non-blends with up to 3 ob-
jects in one postage stamp.

3. The Moment of Light

n(cid:88)

n(cid:88)

The total second-order moment, Mtot, is deﬁned as the
ﬂux in each pixel fi multiplied by the squared distance
to the center of the objects summed over all the galaxy
pixels. We use the following deﬁnition1:

Mtot =

Mi =

i

i

fi((xi − xc)2 + (yi − yc)2)) (3)

Where xi and yi are the coordinates of the ith pixel and
xc and yc are chosen such that Mtot is minimized. We
then use following deﬁnition for M20 as the normalized
second order moment of the brightest 20% of the ﬂux of
the galaxy1. To compute M20, we sort the galaxy pixels
by ﬂux in decreasing order, sum Mi over the brightest
pixels until the sum of the brightest pixels equals 20% of
the total galaxy ﬂux, and then normalize by Mtot:

(cid:80)n

i Mi
Mtot

n(cid:88)

i

M20 = log

while

fi < 0.2ftot

(4)

where ftot is the total ﬂux count of all pixels. By setting
xc and yc to be minimal for the entire postage stamp,
Lotz et al. state that M20 is senstitive to overlapping
galaxies. We go on to test this by generating M20 over all
pixels for visual insight and choose the minimum value.

C. Features

We consider a number of non-parametric statistics
that identify diﬀerent properties of the object in a given
postage stamp.

1. The Gini Coeﬃcent

The Gini Coeﬃcent is a metric used more commonly
in economics to describe the distribution of wealth
in a society1.
It was adapted for galaxy morphology
classiﬁcation in 2003 to quantify the relative distribution
of ﬂux within the pixels associated with the galaxy.
Generally speaking, the Gini Coeﬃcient is zero in an
egalitarian society and unity in one individual has all
the wealth. Analogously, the Gini Coeﬃcient measures
the spread of light in the postage stamp.

For a discrete distribution, the Gini Coeﬃcient is de-

ﬁned as1:

G =

1

2 ¯Xn(n − 1)

n(cid:88)

n(cid:88)

|Xi − Xj|

(1)

i

j

4. Centroid Estimation

where ¯X is the mean over all pixel ﬂux values, n is the
number of pixels in the postage stamp and Xi is the ﬂux
in the ith pixel. We test to see if the Gini Coeﬃcient is
sensitive to overlapping proﬁles.

Since blended objects are sums of individual proﬁles
with peaked distributions, a subset of blended proﬁles
are likely to exhibit multiple peaks. Using a computer

Characterizing Overlapping Galaxies
Using Machine Learning Techniques∗

Luis Alvarez

Stanford University

(Dated: December 12, 2014)

As next generation telescopes enhance our ability to see dimmer objects in outer space, the number
of optically overlapping galaxies in astronomical images increases. Measurements of galaxy shapes
must now account for blended objects. This research attempts to study the classiﬁcation of blended
objects using machine learning techniques.

I.

INTRODUCTION

II. METHODOLOGY

Gravitational lensing, the bending of light through
gravitational ﬁelds, provides insight into current prob-
lems in cosmology concerning the nature of dark matter
and dark energy, mysterious components of the universe
that do not emit light yet play a fundamental role in the
time evolution of the universe.

Gravitational lensing studies are able to estimate the
amount of dark matter and luminous matter by observ-
ing light emitted from galaxies distorted by dark matter;
galaxy shapes are the key observables. Optically overlap-
ping galaxies present a challenge to existing shape algo-
rithms therefore classifying and resolving blended proﬁles
into respective components are critical for lensing studies
that will collect information on billions of galaxies such as
the Large Synoptic Survey Telescope (LSST) beginning
in 2019.

A. Deﬁnitions

In this paper we use the following terminology:
• A postage stamp describes an image that bounds a
particular object of interest; a representative size is
about 30 x 30 pixels depending on the size of the
object.

• An object may consist of a blend of two or more

distinct proﬁles or one proﬁle.

• Each object contains a ﬂux density that describes

the number of counts per pixel.

• The ﬂux is the sum of ﬂux values over all pixels, or

the total count.

• A catalog denotes the set of all objects, with corre-

sponding postage stamps.

∗ Thank you to Patricia Burchat, Mandeep S.S. Gill, and Joshua
Evan Meyers for providing me with the wonderful opportunity to
learn about weak lensing and for providing a rich and engaging
learning environment.

A. Goal

We aim to predict whether the object in a given
postage stamp is composed of two or more proﬁles or
only one proﬁle. This corresponds to two or more galax-
ies or only one galaxy.

B. Data Collection

We use an open-source galaxy simulation package
called Galsim[3] to simulate astronomical images. We
create single or blended objects using a number of ﬂux
densities and sampling methods and can simulate a cat-
alog of postage stamps under the real conditions a future
survey is likely to encounter. The Point-Spread Function
(PSF), the model of the eﬀects of atmospheric turbulence
on images and sky-noise, the uncertainty in the bright-
ness of the sky at a given moment during exposure times
are modeled in Galsim and give it the power to approx-
imate real conditions; Fig 1. provides such an example.
For any single proﬁle, we specify the following parame-
ters:

• Flux (Photon Counts)
• Half-light Radius (Size)
• Ellipticity Component 1 (e1)
• Ellipticity Component 2 (e2)
• x0 of Centroid
• y0 of Centroid

with e1 and e2 such that(cid:112)e2

1 + e2

2 ≤ 1

Using Galsim gives us the distinct advantage of creat-
ing postage stamps of blended and non-blended objects
while knowing the class label. We begin our study in the
simplest scenario: no sky noise, no PSF, and maintain
each proﬁle as a Gaussian such that blends are sums of
Gaussians. Object parameters are distributed uniformly
such that the majority of ﬂux does not lie outside the
postage stamp. We generate 1000 postage stamps with

2

2. Asymmetry

Highly overlapping galaxies exhibit large asymmetry
due luminosity proﬁles that are rotationally variant2. If
a postage stamp of unique overlapping galaxies is rotated
180◦and then subtracted from the original non-rotated
postage stamp, many pixels from the residual image may
be non-zero. This simple procedure produces a statis-
tic that identiﬁes whether the object in a given postage
stamp is likely to be a blend. We use the following deﬁ-
nition of asymmetry2:

Aabs =

1
2

|Xorg,i − Xrot,i|

|Xorg,i|

(2)

n(cid:88)

i

FIG. 1. Example Image

Where Xorg,i is the ﬂux count in the ith pixel of the
original image, Xrot,i is the ﬂux count in the ith pixel of
the rotated image, and n is the number of pixels in the
postage stamp. We choose the center of rotation such
that Aabs is minimized by computing Aabs in all pixels
and choosing the minimal value of Aabs corresponding to
the center of rotation.

roughly half blends and half non-blends with up to 3 ob-
jects in one postage stamp.

3. The Moment of Light

n(cid:88)

n(cid:88)

The total second-order moment, Mtot, is deﬁned as the
ﬂux in each pixel fi multiplied by the squared distance
to the center of the objects summed over all the galaxy
pixels. We use the following deﬁnition1:

Mtot =

Mi =

i

i

fi((xi − xc)2 + (yi − yc)2)) (3)

Where xi and yi are the coordinates of the ith pixel and
xc and yc are chosen such that Mtot is minimized. We
then use following deﬁnition for M20 as the normalized
second order moment of the brightest 20% of the ﬂux of
the galaxy1. To compute M20, we sort the galaxy pixels
by ﬂux in decreasing order, sum Mi over the brightest
pixels until the sum of the brightest pixels equals 20% of
the total galaxy ﬂux, and then normalize by Mtot:

(cid:80)n

i Mi
Mtot

n(cid:88)

i

M20 = log

while

fi < 0.2ftot

(4)

where ftot is the total ﬂux count of all pixels. By setting
xc and yc to be minimal for the entire postage stamp,
Lotz et al. state that M20 is senstitive to overlapping
galaxies. We go on to test this by generating M20 over all
pixels for visual insight and choose the minimum value.

C. Features

We consider a number of non-parametric statistics
that identify diﬀerent properties of the object in a given
postage stamp.

1. The Gini Coeﬃcent

The Gini Coeﬃcent is a metric used more commonly
in economics to describe the distribution of wealth
in a society1.
It was adapted for galaxy morphology
classiﬁcation in 2003 to quantify the relative distribution
of ﬂux within the pixels associated with the galaxy.
Generally speaking, the Gini Coeﬃcient is zero in an
egalitarian society and unity in one individual has all
the wealth. Analogously, the Gini Coeﬃcient measures
the spread of light in the postage stamp.

For a discrete distribution, the Gini Coeﬃcient is de-

ﬁned as1:

G =

1

2 ¯Xn(n − 1)

n(cid:88)

n(cid:88)

|Xi − Xj|

(1)

i

j

4. Centroid Estimation

where ¯X is the mean over all pixel ﬂux values, n is the
number of pixels in the postage stamp and Xi is the ﬂux
in the ith pixel. We test to see if the Gini Coeﬃcient is
sensitive to overlapping proﬁles.

Since blended objects are sums of individual proﬁles
with peaked distributions, a subset of blended proﬁles
are likely to exhibit multiple peaks. Using a computer

vision and image processing library called Mahotas[4],
we are able to identify regions in a postage stamp that
are disjoint. For this process, we run through a range of
pixel ﬂux values set by the max pixel ﬂux observed. For
each value in our range, we obtain the threshold pixel
value, zero all pixel ﬂux values lower than the threshold,
smooth the image with a gaussian ﬁlter to minimize noisy
pixels and identify if disjoint regions are present. We
then choose the max number of centroids observed in the
iteration.

3

• Linear Logistic Regression (LR)
• Support Vector Machine (SVM)
• Random Forests (RF)

Although Random Forests were not discussed in class,
current literature ranks RF above SVM’s for their
non-parametric nature, ability to deal with non-linear-
separability, and operational ease.
We ﬁrst begin optimizing parameters for MNB. Because
MNB can be bucketed diﬀerently, we ask what is the gen-
eralization error for diﬀerently discretized MNB models.

FIG. 3. Generalization Error vs Bucketing for MNB

Analysis of FIG. 3. returns 350 buckets for the lowest
estimate of the generalization error; we go on to use that
discretization for MNB.

For LR and SVM, we ask what regularization constant
provides the lowest cross-validated generalization error
translating to soft vs hard margins.

FIG. 2. Example Feature Computation For a Blend and Non-
Blend

D. Modeling

We choose the following supervised learning methods
from the Python sklearn library[5] for binary classiﬁca-
tion:

• Multinomial Naive Bayes (MNB)

FIG. 4. Generalization Error vs Regularization Constant For
LR, SVM

Characterizing Overlapping Galaxies
Using Machine Learning Techniques∗

Luis Alvarez

Stanford University

(Dated: December 12, 2014)

As next generation telescopes enhance our ability to see dimmer objects in outer space, the number
of optically overlapping galaxies in astronomical images increases. Measurements of galaxy shapes
must now account for blended objects. This research attempts to study the classiﬁcation of blended
objects using machine learning techniques.

I.

INTRODUCTION

II. METHODOLOGY

Gravitational lensing, the bending of light through
gravitational ﬁelds, provides insight into current prob-
lems in cosmology concerning the nature of dark matter
and dark energy, mysterious components of the universe
that do not emit light yet play a fundamental role in the
time evolution of the universe.

Gravitational lensing studies are able to estimate the
amount of dark matter and luminous matter by observ-
ing light emitted from galaxies distorted by dark matter;
galaxy shapes are the key observables. Optically overlap-
ping galaxies present a challenge to existing shape algo-
rithms therefore classifying and resolving blended proﬁles
into respective components are critical for lensing studies
that will collect information on billions of galaxies such as
the Large Synoptic Survey Telescope (LSST) beginning
in 2019.

A. Deﬁnitions

In this paper we use the following terminology:
• A postage stamp describes an image that bounds a
particular object of interest; a representative size is
about 30 x 30 pixels depending on the size of the
object.

• An object may consist of a blend of two or more

distinct proﬁles or one proﬁle.

• Each object contains a ﬂux density that describes

the number of counts per pixel.

• The ﬂux is the sum of ﬂux values over all pixels, or

the total count.

• A catalog denotes the set of all objects, with corre-

sponding postage stamps.

∗ Thank you to Patricia Burchat, Mandeep S.S. Gill, and Joshua
Evan Meyers for providing me with the wonderful opportunity to
learn about weak lensing and for providing a rich and engaging
learning environment.

A. Goal

We aim to predict whether the object in a given
postage stamp is composed of two or more proﬁles or
only one proﬁle. This corresponds to two or more galax-
ies or only one galaxy.

B. Data Collection

We use an open-source galaxy simulation package
called Galsim[3] to simulate astronomical images. We
create single or blended objects using a number of ﬂux
densities and sampling methods and can simulate a cat-
alog of postage stamps under the real conditions a future
survey is likely to encounter. The Point-Spread Function
(PSF), the model of the eﬀects of atmospheric turbulence
on images and sky-noise, the uncertainty in the bright-
ness of the sky at a given moment during exposure times
are modeled in Galsim and give it the power to approx-
imate real conditions; Fig 1. provides such an example.
For any single proﬁle, we specify the following parame-
ters:

• Flux (Photon Counts)
• Half-light Radius (Size)
• Ellipticity Component 1 (e1)
• Ellipticity Component 2 (e2)
• x0 of Centroid
• y0 of Centroid

with e1 and e2 such that(cid:112)e2

1 + e2

2 ≤ 1

Using Galsim gives us the distinct advantage of creat-
ing postage stamps of blended and non-blended objects
while knowing the class label. We begin our study in the
simplest scenario: no sky noise, no PSF, and maintain
each proﬁle as a Gaussian such that blends are sums of
Gaussians. Object parameters are distributed uniformly
such that the majority of ﬂux does not lie outside the
postage stamp. We generate 1000 postage stamps with

2

2. Asymmetry

Highly overlapping galaxies exhibit large asymmetry
due luminosity proﬁles that are rotationally variant2. If
a postage stamp of unique overlapping galaxies is rotated
180◦and then subtracted from the original non-rotated
postage stamp, many pixels from the residual image may
be non-zero. This simple procedure produces a statis-
tic that identiﬁes whether the object in a given postage
stamp is likely to be a blend. We use the following deﬁ-
nition of asymmetry2:

Aabs =

1
2

|Xorg,i − Xrot,i|

|Xorg,i|

(2)

n(cid:88)

i

FIG. 1. Example Image

Where Xorg,i is the ﬂux count in the ith pixel of the
original image, Xrot,i is the ﬂux count in the ith pixel of
the rotated image, and n is the number of pixels in the
postage stamp. We choose the center of rotation such
that Aabs is minimized by computing Aabs in all pixels
and choosing the minimal value of Aabs corresponding to
the center of rotation.

roughly half blends and half non-blends with up to 3 ob-
jects in one postage stamp.

3. The Moment of Light

n(cid:88)

n(cid:88)

The total second-order moment, Mtot, is deﬁned as the
ﬂux in each pixel fi multiplied by the squared distance
to the center of the objects summed over all the galaxy
pixels. We use the following deﬁnition1:

Mtot =

Mi =

i

i

fi((xi − xc)2 + (yi − yc)2)) (3)

Where xi and yi are the coordinates of the ith pixel and
xc and yc are chosen such that Mtot is minimized. We
then use following deﬁnition for M20 as the normalized
second order moment of the brightest 20% of the ﬂux of
the galaxy1. To compute M20, we sort the galaxy pixels
by ﬂux in decreasing order, sum Mi over the brightest
pixels until the sum of the brightest pixels equals 20% of
the total galaxy ﬂux, and then normalize by Mtot:

(cid:80)n

i Mi
Mtot

n(cid:88)

i

M20 = log

while

fi < 0.2ftot

(4)

where ftot is the total ﬂux count of all pixels. By setting
xc and yc to be minimal for the entire postage stamp,
Lotz et al. state that M20 is senstitive to overlapping
galaxies. We go on to test this by generating M20 over all
pixels for visual insight and choose the minimum value.

C. Features

We consider a number of non-parametric statistics
that identify diﬀerent properties of the object in a given
postage stamp.

1. The Gini Coeﬃcent

The Gini Coeﬃcent is a metric used more commonly
in economics to describe the distribution of wealth
in a society1.
It was adapted for galaxy morphology
classiﬁcation in 2003 to quantify the relative distribution
of ﬂux within the pixels associated with the galaxy.
Generally speaking, the Gini Coeﬃcient is zero in an
egalitarian society and unity in one individual has all
the wealth. Analogously, the Gini Coeﬃcient measures
the spread of light in the postage stamp.

For a discrete distribution, the Gini Coeﬃcient is de-

ﬁned as1:

G =

1

2 ¯Xn(n − 1)

n(cid:88)

n(cid:88)

|Xi − Xj|

(1)

i

j

4. Centroid Estimation

where ¯X is the mean over all pixel ﬂux values, n is the
number of pixels in the postage stamp and Xi is the ﬂux
in the ith pixel. We test to see if the Gini Coeﬃcient is
sensitive to overlapping proﬁles.

Since blended objects are sums of individual proﬁles
with peaked distributions, a subset of blended proﬁles
are likely to exhibit multiple peaks. Using a computer

vision and image processing library called Mahotas[4],
we are able to identify regions in a postage stamp that
are disjoint. For this process, we run through a range of
pixel ﬂux values set by the max pixel ﬂux observed. For
each value in our range, we obtain the threshold pixel
value, zero all pixel ﬂux values lower than the threshold,
smooth the image with a gaussian ﬁlter to minimize noisy
pixels and identify if disjoint regions are present. We
then choose the max number of centroids observed in the
iteration.

3

• Linear Logistic Regression (LR)
• Support Vector Machine (SVM)
• Random Forests (RF)

Although Random Forests were not discussed in class,
current literature ranks RF above SVM’s for their
non-parametric nature, ability to deal with non-linear-
separability, and operational ease.
We ﬁrst begin optimizing parameters for MNB. Because
MNB can be bucketed diﬀerently, we ask what is the gen-
eralization error for diﬀerently discretized MNB models.

FIG. 3. Generalization Error vs Bucketing for MNB

Analysis of FIG. 3. returns 350 buckets for the lowest
estimate of the generalization error; we go on to use that
discretization for MNB.

For LR and SVM, we ask what regularization constant
provides the lowest cross-validated generalization error
translating to soft vs hard margins.

FIG. 2. Example Feature Computation For a Blend and Non-
Blend

D. Modeling

We choose the following supervised learning methods
from the Python sklearn library[5] for binary classiﬁca-
tion:

• Multinomial Naive Bayes (MNB)

FIG. 4. Generalization Error vs Regularization Constant For
LR, SVM

We conclude that the soft margin corresponding to
C = 1 provides the lowest generalization error from FIG
4.

Finally, we ask how many decision trees will provide
the lowest cross-validated generalization error for RF es-
timation. Analysis of FIG. 5 returns 45 decision trees is
optimal. We now use the parameters set by the above
analysis to create optimal learning curves.

4

FIG. 6. CV Learning Curves For Training Set

FIG. 5. Generalization Error vs Number of Decision Trees
For RF

III. RESULTS

1. Supervised Learning

To compute learning curves, we run through a diﬀer-
ent number of training examples, increasing the num-
ber through each iteration, compute the cross-validated
training error for each model and plot. The results are
as follows:

According to FIG. 6. MNB and RF perform well
attesting to the strength of MNB in the small training
set regime as a high-bias/low-variance classiﬁer and
the strength of RF as an ensemble method with high
estimation power in any training set regime. As the
training set size increases, separability of data may
become reduced,
inﬂuencing MNB to perform worse
than at the smaller training set regime. LR and SVM
converge asymptotically and RF provides the lowest
generalization error. We now perform a similar analysis
on the test set.

Using the parameters deﬁned in our previous analysis,
we use our models on our test set to compute learning
curves.

Comparing the learning curves from our training to the
test set returns a similar pattern (FIG. 7.). RF returns
the lowest asymptotic generalization error with about

FIG. 7. CV Learning Curves For Test Set

0.05 generalization error while MNB performs well in the
low training set regime with 0.08 generalization error.

2. Unsupervised Learning

Now we ask, for binary classiﬁcation, does the data
show structure such that there exist diﬀerent modes
corresponding to the two class labels.

For each feature that is deﬁned continuously, we use
a gaussian mixture model to compute the modes in the
data. We input 2 modes corresponding to the binary
classes. We overlay the ﬁtted gaussians above the true
data corresponding to the blended and non-blended data.

Characterizing Overlapping Galaxies
Using Machine Learning Techniques∗

Luis Alvarez

Stanford University

(Dated: December 12, 2014)

As next generation telescopes enhance our ability to see dimmer objects in outer space, the number
of optically overlapping galaxies in astronomical images increases. Measurements of galaxy shapes
must now account for blended objects. This research attempts to study the classiﬁcation of blended
objects using machine learning techniques.

I.

INTRODUCTION

II. METHODOLOGY

Gravitational lensing, the bending of light through
gravitational ﬁelds, provides insight into current prob-
lems in cosmology concerning the nature of dark matter
and dark energy, mysterious components of the universe
that do not emit light yet play a fundamental role in the
time evolution of the universe.

Gravitational lensing studies are able to estimate the
amount of dark matter and luminous matter by observ-
ing light emitted from galaxies distorted by dark matter;
galaxy shapes are the key observables. Optically overlap-
ping galaxies present a challenge to existing shape algo-
rithms therefore classifying and resolving blended proﬁles
into respective components are critical for lensing studies
that will collect information on billions of galaxies such as
the Large Synoptic Survey Telescope (LSST) beginning
in 2019.

A. Deﬁnitions

In this paper we use the following terminology:
• A postage stamp describes an image that bounds a
particular object of interest; a representative size is
about 30 x 30 pixels depending on the size of the
object.

• An object may consist of a blend of two or more

distinct proﬁles or one proﬁle.

• Each object contains a ﬂux density that describes

the number of counts per pixel.

• The ﬂux is the sum of ﬂux values over all pixels, or

the total count.

• A catalog denotes the set of all objects, with corre-

sponding postage stamps.

∗ Thank you to Patricia Burchat, Mandeep S.S. Gill, and Joshua
Evan Meyers for providing me with the wonderful opportunity to
learn about weak lensing and for providing a rich and engaging
learning environment.

A. Goal

We aim to predict whether the object in a given
postage stamp is composed of two or more proﬁles or
only one proﬁle. This corresponds to two or more galax-
ies or only one galaxy.

B. Data Collection

We use an open-source galaxy simulation package
called Galsim[3] to simulate astronomical images. We
create single or blended objects using a number of ﬂux
densities and sampling methods and can simulate a cat-
alog of postage stamps under the real conditions a future
survey is likely to encounter. The Point-Spread Function
(PSF), the model of the eﬀects of atmospheric turbulence
on images and sky-noise, the uncertainty in the bright-
ness of the sky at a given moment during exposure times
are modeled in Galsim and give it the power to approx-
imate real conditions; Fig 1. provides such an example.
For any single proﬁle, we specify the following parame-
ters:

• Flux (Photon Counts)
• Half-light Radius (Size)
• Ellipticity Component 1 (e1)
• Ellipticity Component 2 (e2)
• x0 of Centroid
• y0 of Centroid

with e1 and e2 such that(cid:112)e2

1 + e2

2 ≤ 1

Using Galsim gives us the distinct advantage of creat-
ing postage stamps of blended and non-blended objects
while knowing the class label. We begin our study in the
simplest scenario: no sky noise, no PSF, and maintain
each proﬁle as a Gaussian such that blends are sums of
Gaussians. Object parameters are distributed uniformly
such that the majority of ﬂux does not lie outside the
postage stamp. We generate 1000 postage stamps with

2

2. Asymmetry

Highly overlapping galaxies exhibit large asymmetry
due luminosity proﬁles that are rotationally variant2. If
a postage stamp of unique overlapping galaxies is rotated
180◦and then subtracted from the original non-rotated
postage stamp, many pixels from the residual image may
be non-zero. This simple procedure produces a statis-
tic that identiﬁes whether the object in a given postage
stamp is likely to be a blend. We use the following deﬁ-
nition of asymmetry2:

Aabs =

1
2

|Xorg,i − Xrot,i|

|Xorg,i|

(2)

n(cid:88)

i

FIG. 1. Example Image

Where Xorg,i is the ﬂux count in the ith pixel of the
original image, Xrot,i is the ﬂux count in the ith pixel of
the rotated image, and n is the number of pixels in the
postage stamp. We choose the center of rotation such
that Aabs is minimized by computing Aabs in all pixels
and choosing the minimal value of Aabs corresponding to
the center of rotation.

roughly half blends and half non-blends with up to 3 ob-
jects in one postage stamp.

3. The Moment of Light

n(cid:88)

n(cid:88)

The total second-order moment, Mtot, is deﬁned as the
ﬂux in each pixel fi multiplied by the squared distance
to the center of the objects summed over all the galaxy
pixels. We use the following deﬁnition1:

Mtot =

Mi =

i

i

fi((xi − xc)2 + (yi − yc)2)) (3)

Where xi and yi are the coordinates of the ith pixel and
xc and yc are chosen such that Mtot is minimized. We
then use following deﬁnition for M20 as the normalized
second order moment of the brightest 20% of the ﬂux of
the galaxy1. To compute M20, we sort the galaxy pixels
by ﬂux in decreasing order, sum Mi over the brightest
pixels until the sum of the brightest pixels equals 20% of
the total galaxy ﬂux, and then normalize by Mtot:

(cid:80)n

i Mi
Mtot

n(cid:88)

i

M20 = log

while

fi < 0.2ftot

(4)

where ftot is the total ﬂux count of all pixels. By setting
xc and yc to be minimal for the entire postage stamp,
Lotz et al. state that M20 is senstitive to overlapping
galaxies. We go on to test this by generating M20 over all
pixels for visual insight and choose the minimum value.

C. Features

We consider a number of non-parametric statistics
that identify diﬀerent properties of the object in a given
postage stamp.

1. The Gini Coeﬃcent

The Gini Coeﬃcent is a metric used more commonly
in economics to describe the distribution of wealth
in a society1.
It was adapted for galaxy morphology
classiﬁcation in 2003 to quantify the relative distribution
of ﬂux within the pixels associated with the galaxy.
Generally speaking, the Gini Coeﬃcient is zero in an
egalitarian society and unity in one individual has all
the wealth. Analogously, the Gini Coeﬃcient measures
the spread of light in the postage stamp.

For a discrete distribution, the Gini Coeﬃcient is de-

ﬁned as1:

G =

1

2 ¯Xn(n − 1)

n(cid:88)

n(cid:88)

|Xi − Xj|

(1)

i

j

4. Centroid Estimation

where ¯X is the mean over all pixel ﬂux values, n is the
number of pixels in the postage stamp and Xi is the ﬂux
in the ith pixel. We test to see if the Gini Coeﬃcient is
sensitive to overlapping proﬁles.

Since blended objects are sums of individual proﬁles
with peaked distributions, a subset of blended proﬁles
are likely to exhibit multiple peaks. Using a computer

vision and image processing library called Mahotas[4],
we are able to identify regions in a postage stamp that
are disjoint. For this process, we run through a range of
pixel ﬂux values set by the max pixel ﬂux observed. For
each value in our range, we obtain the threshold pixel
value, zero all pixel ﬂux values lower than the threshold,
smooth the image with a gaussian ﬁlter to minimize noisy
pixels and identify if disjoint regions are present. We
then choose the max number of centroids observed in the
iteration.

3

• Linear Logistic Regression (LR)
• Support Vector Machine (SVM)
• Random Forests (RF)

Although Random Forests were not discussed in class,
current literature ranks RF above SVM’s for their
non-parametric nature, ability to deal with non-linear-
separability, and operational ease.
We ﬁrst begin optimizing parameters for MNB. Because
MNB can be bucketed diﬀerently, we ask what is the gen-
eralization error for diﬀerently discretized MNB models.

FIG. 3. Generalization Error vs Bucketing for MNB

Analysis of FIG. 3. returns 350 buckets for the lowest
estimate of the generalization error; we go on to use that
discretization for MNB.

For LR and SVM, we ask what regularization constant
provides the lowest cross-validated generalization error
translating to soft vs hard margins.

FIG. 2. Example Feature Computation For a Blend and Non-
Blend

D. Modeling

We choose the following supervised learning methods
from the Python sklearn library[5] for binary classiﬁca-
tion:

• Multinomial Naive Bayes (MNB)

FIG. 4. Generalization Error vs Regularization Constant For
LR, SVM

We conclude that the soft margin corresponding to
C = 1 provides the lowest generalization error from FIG
4.

Finally, we ask how many decision trees will provide
the lowest cross-validated generalization error for RF es-
timation. Analysis of FIG. 5 returns 45 decision trees is
optimal. We now use the parameters set by the above
analysis to create optimal learning curves.

4

FIG. 6. CV Learning Curves For Training Set

FIG. 5. Generalization Error vs Number of Decision Trees
For RF

III. RESULTS

1. Supervised Learning

To compute learning curves, we run through a diﬀer-
ent number of training examples, increasing the num-
ber through each iteration, compute the cross-validated
training error for each model and plot. The results are
as follows:

According to FIG. 6. MNB and RF perform well
attesting to the strength of MNB in the small training
set regime as a high-bias/low-variance classiﬁer and
the strength of RF as an ensemble method with high
estimation power in any training set regime. As the
training set size increases, separability of data may
become reduced,
inﬂuencing MNB to perform worse
than at the smaller training set regime. LR and SVM
converge asymptotically and RF provides the lowest
generalization error. We now perform a similar analysis
on the test set.

Using the parameters deﬁned in our previous analysis,
we use our models on our test set to compute learning
curves.

Comparing the learning curves from our training to the
test set returns a similar pattern (FIG. 7.). RF returns
the lowest asymptotic generalization error with about

FIG. 7. CV Learning Curves For Test Set

0.05 generalization error while MNB performs well in the
low training set regime with 0.08 generalization error.

2. Unsupervised Learning

Now we ask, for binary classiﬁcation, does the data
show structure such that there exist diﬀerent modes
corresponding to the two class labels.

For each feature that is deﬁned continuously, we use
a gaussian mixture model to compute the modes in the
data. We input 2 modes corresponding to the binary
classes. We overlay the ﬁtted gaussians above the true
data corresponding to the blended and non-blended data.

5

The same conclusion as before does not necessarily
apply for G; the GMM returns two closely overlapping
distributions mimicking the large overlap between many
of the observed values. While the separation is not
as clean as for Aabs and M20, G roughly takes on
larger values for non-blended objects. This translates
to blended objects generally spreading light more in a
given postage stamp while non-blended objects contain
more light in smaller region.

On centroid estimation, we note that the centroid es-
timates for blended objects favored number of centroids
greater than 1 with mode at 2 and conversely for non-
blended objects, the mode was 1 estimated centroid. The
shape of the distribution bolsters the accuracy of the cen-
troid estimation although further tuning of parameters
should be considered for much higher accuracy.

IV. CONCLUSION AND FUTURE DIRECTION

Using Galsim, we have simulated a number of postage
stamps, 1000 each in our training set and test set with
blended and non-blended gaussian proﬁles. For each pro-
ﬁle, we selected random parameters in order to collect
non-parametric statistics on each postage stamp. After
obtaining the features of each postage stamp, we used
cross-validation techniques to identify the parameters of
each model that provided the minimum cross-validation
generalization error on our training set. Using those
models: MNB, LR, SVM, and RF, we constructed learn-
ing curves on both the training and test set and conclude
that RF does the best asymptotically with 0.05 gener-
alization error. In the low training set regime, RF and
MNB perform well with under 0.10 generalization error.
feature analysis, we have shown that
for the continuous features, the modes in the data
corresponding to our two class labels are fully realized
and can be cleanly separated, giving insight to the
success of MNB.

In terms of

Future work consists of moving towards more realistic
modeling. Galaxies are generally modeled as a combina-
tion of two distinct proﬁles that approximate the lumi-
nous bulge and the galaxy disk.
Inclusion of sky-noise
and the PSF at signal-to-noise ratio regimes similar to
what LSST may encounter and researching more features
that may be sensitive to overlapping galaxies are also nec-
essary.

FIG. 8. GMM Models for G and Aabs

On Fig 8. and 9, we see that for Aabs and M20, the
data separates quite cleanly. For blended objects, Aabs
and M20 have much more variation while generally taking
on greater values than those of non-blended objects. Aabs
and M20 for non-blended objects have low variation with
a high peak. This translates to blends generally being
more asymmetric and blended objects are generally more
spatially extended.

FIG. 9. GMM Model for M20 and Centroid Estimate His-
togram

[1] Lotz, J., Primack,

I., Madau, P.: A New Non-
Parametric Approach to Galaxy Morphological Classiﬁ-
cation Astron.J.128:163-182, 2004

[2] Conselice, C., Bershady, M., Jangren, A.: The Asymmetry

of Galaxies: Physical Morphology for Nearby and High-
Redshift Galaxies Astrophys,J.529:886, 2000 ApJ

[3] Http://www.great3challenge.info/?q=galsim.
[4] Mahotas.readthedocs.org.
[5] Scikit-learn.org

