An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 3: OPC UA in the automation pyramid for MEGA

nologies according to the state of the art and the requirements imposed by such kind of systems. In the
water management process the equipment has to be deployed into an hostile environment (open air, bad
weather conditions, unattended or difﬁcult access equipment, etc.) Therefore it is a key issue for every
provider that their system is able to solve such difﬁculties even with speciﬁc interfaces.

3 Integrating IoT in water management

Contributing to solutions that integrate the Internet of Things paradigm into water management processes
can be beneﬁcial to address expected solutions. The rest of this Section describes the main beneﬁts of
adopting IoT and the IoT characteristics that are considered in the proposed MEGA model, considering
new advances on ICT technologies for creating feasible and commercial systems [9].

Mark Weiser deﬁned a ”Smart Environment” [10] as - the physical world that is richly and invisibly
interwoven with sensors, actuators, displays, and computational elements, embedded seamlessly in the
everyday objects of our lives, and connected through a continuous network. There are many research
works that contributes to solve various issues in Smart Environments, such as seamless access to re-
sources and devices [11], distributed service executions [12], social choice techniques [13], etc. Other
works explains how IoT is based on three paradigms - internet-oriented (middleware), things oriented
(sensors) and knowledge-oriented (semantics) [14]. Although this type of delineation is required due to
the interdisciplinary nature of the subject, the usefulness of IoT can be unleashed only in an application
domain where the three paradigms intersect.

3.1

IoT for Water Management

The provision of Internet of Things capabilities in water management scenarios can be achieved if we
consider some considerations from the business, social and technical point of view. Here we list the main
beneﬁts of providing IoT in water management scenarios:

Efﬁciency increase: water management companies and associations can use real-time operational
control to make smarter business decisions and reduce operating costs. They use real-time data from

11

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 3: OPC UA in the automation pyramid for MEGA

nologies according to the state of the art and the requirements imposed by such kind of systems. In the
water management process the equipment has to be deployed into an hostile environment (open air, bad
weather conditions, unattended or difﬁcult access equipment, etc.) Therefore it is a key issue for every
provider that their system is able to solve such difﬁculties even with speciﬁc interfaces.

3 Integrating IoT in water management

Contributing to solutions that integrate the Internet of Things paradigm into water management processes
can be beneﬁcial to address expected solutions. The rest of this Section describes the main beneﬁts of
adopting IoT and the IoT characteristics that are considered in the proposed MEGA model, considering
new advances on ICT technologies for creating feasible and commercial systems [9].

Mark Weiser deﬁned a ”Smart Environment” [10] as - the physical world that is richly and invisibly
interwoven with sensors, actuators, displays, and computational elements, embedded seamlessly in the
everyday objects of our lives, and connected through a continuous network. There are many research
works that contributes to solve various issues in Smart Environments, such as seamless access to re-
sources and devices [11], distributed service executions [12], social choice techniques [13], etc. Other
works explains how IoT is based on three paradigms - internet-oriented (middleware), things oriented
(sensors) and knowledge-oriented (semantics) [14]. Although this type of delineation is required due to
the interdisciplinary nature of the subject, the usefulness of IoT can be unleashed only in an application
domain where the three paradigms intersect.

3.1

IoT for Water Management

The provision of Internet of Things capabilities in water management scenarios can be achieved if we
consider some considerations from the business, social and technical point of view. Here we list the main
beneﬁts of providing IoT in water management scenarios:

Efﬁciency increase: water management companies and associations can use real-time operational
control to make smarter business decisions and reduce operating costs. They use real-time data from

11

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

sensors and actuators to monitor and improve water management infrastructures, making them more
efﬁcient, reducing energy costs and minimizing human intervention.

Cost savings: water management costs can be reduced through improved asset utilization, process
efﬁciencies and productivity. Customers and organizations can beneﬁt from improved asset utilization
(e.g., smart water irrigation units that eliminate manual operation) and service improvements (e.g., re-
mote monitoring of irrigation conditions)

Asset utilization: with improved tracking of assets (machinery, equipment, tools, etc.) using sensors
and connectivity, companies can beneﬁt from transparency and visibility into their assets and supply
chains. They can easily locate assets and run preventive maintenance on critical pieces of infrastructure
and machinery.

Productivity increase: Productivity is a critical parameter that affects the proﬁtability of any organi-
zation. IoT allows real-time control, new business models, process optimization, resource conservations,
service time reduction, and the capability to do all of this globally, reducing the mismatch of required vs.
available skills and improving labor efﬁciency.

Expansion of new and existing business models: IoT is beneﬁcial in any of the three deﬁned
layers. In the subsystem layer, IoT subsystems are able to execute processes and communicate using a
standard communication interface; in the coordination layer, it can be useful to enable SMEs to design
new coordination applications, with the purpose to orchestrate the management and exploitation layer
with the subsystem layers; and ﬁnally, in the management and exploitation layer, IoT identiﬁcation
capabilities contribute to provide tailored information services for an speciﬁc water distribution network
community.

As we explained before, IoT builds on three pillars [14]: Internet orientation, thing orientation, and
knowledge orientation. We link these pillars with the ability of objects to (i) be identiﬁable (anything
identiﬁes itself), (ii) communicate (anything communicates) and (iii) to interact (anything interacts),
either among themselves, building networks of interconnected objects, or with end-users or other entities
in the network. The proposed MEGA model considers these properties:

Internet-oriented: the proposed MEGA model identiﬁes three layers (see Figure. ??). These layers
are communicated with two web interfaces enabling the deﬁnition of a ﬂexible and scalable commu-
nication system for controlling the huge amount of subsystems to be required for a complete water
management system.

The Coordination and Management - Exploitation layers are deﬁned as Cloud services. IoT,
as a broader vision of the previous concept of machine-to-machine (M2M) communications, is gaining
support by current Cloud computing infrastructures, which begin to provide so called cloud-based IoT
solutions.

Furthermore, subsystem capabilities (i.e. sensing, actuating, computing and communication tech-
nologies) depend on the speciﬁc conditions of the scenarios in which they are deployed. A seamless
access to subsystems will require that the Subsystems layer includes homogenization through a large
diversity of communication paradigms and higher granularity, to deal with many communication
technologies.

Thing-oriented: Due to previous experiences of the development of systems for water management,
the most granular element to be accessible is the subsystem. It is expected higher granularity in the
coming years, as subsystems are composed by many devices and interrelations, as we describe in the
physical and process models of Section 4. These elements can be redeﬁned as Smart Objects, being
objects which are able to describe its own possible interactions. Smart Object may provide the following
information: Object properties (physical properties and a text description), behavior (different behaviors
based on state variables) and, also, interaction information (current state of dials, gauges, switches, etc.).
It is important to deﬁne how subsystems as smart object containers fulﬁlls the features identiﬁed by
[14] and [15]. Subsystems deﬁnes and provides object identiﬁcation, to do that they must incorporate

12

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 3: OPC UA in the automation pyramid for MEGA

nologies according to the state of the art and the requirements imposed by such kind of systems. In the
water management process the equipment has to be deployed into an hostile environment (open air, bad
weather conditions, unattended or difﬁcult access equipment, etc.) Therefore it is a key issue for every
provider that their system is able to solve such difﬁculties even with speciﬁc interfaces.

3 Integrating IoT in water management

Contributing to solutions that integrate the Internet of Things paradigm into water management processes
can be beneﬁcial to address expected solutions. The rest of this Section describes the main beneﬁts of
adopting IoT and the IoT characteristics that are considered in the proposed MEGA model, considering
new advances on ICT technologies for creating feasible and commercial systems [9].

Mark Weiser deﬁned a ”Smart Environment” [10] as - the physical world that is richly and invisibly
interwoven with sensors, actuators, displays, and computational elements, embedded seamlessly in the
everyday objects of our lives, and connected through a continuous network. There are many research
works that contributes to solve various issues in Smart Environments, such as seamless access to re-
sources and devices [11], distributed service executions [12], social choice techniques [13], etc. Other
works explains how IoT is based on three paradigms - internet-oriented (middleware), things oriented
(sensors) and knowledge-oriented (semantics) [14]. Although this type of delineation is required due to
the interdisciplinary nature of the subject, the usefulness of IoT can be unleashed only in an application
domain where the three paradigms intersect.

3.1

IoT for Water Management

The provision of Internet of Things capabilities in water management scenarios can be achieved if we
consider some considerations from the business, social and technical point of view. Here we list the main
beneﬁts of providing IoT in water management scenarios:

Efﬁciency increase: water management companies and associations can use real-time operational
control to make smarter business decisions and reduce operating costs. They use real-time data from

11

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

sensors and actuators to monitor and improve water management infrastructures, making them more
efﬁcient, reducing energy costs and minimizing human intervention.

Cost savings: water management costs can be reduced through improved asset utilization, process
efﬁciencies and productivity. Customers and organizations can beneﬁt from improved asset utilization
(e.g., smart water irrigation units that eliminate manual operation) and service improvements (e.g., re-
mote monitoring of irrigation conditions)

Asset utilization: with improved tracking of assets (machinery, equipment, tools, etc.) using sensors
and connectivity, companies can beneﬁt from transparency and visibility into their assets and supply
chains. They can easily locate assets and run preventive maintenance on critical pieces of infrastructure
and machinery.

Productivity increase: Productivity is a critical parameter that affects the proﬁtability of any organi-
zation. IoT allows real-time control, new business models, process optimization, resource conservations,
service time reduction, and the capability to do all of this globally, reducing the mismatch of required vs.
available skills and improving labor efﬁciency.

Expansion of new and existing business models: IoT is beneﬁcial in any of the three deﬁned
layers. In the subsystem layer, IoT subsystems are able to execute processes and communicate using a
standard communication interface; in the coordination layer, it can be useful to enable SMEs to design
new coordination applications, with the purpose to orchestrate the management and exploitation layer
with the subsystem layers; and ﬁnally, in the management and exploitation layer, IoT identiﬁcation
capabilities contribute to provide tailored information services for an speciﬁc water distribution network
community.

As we explained before, IoT builds on three pillars [14]: Internet orientation, thing orientation, and
knowledge orientation. We link these pillars with the ability of objects to (i) be identiﬁable (anything
identiﬁes itself), (ii) communicate (anything communicates) and (iii) to interact (anything interacts),
either among themselves, building networks of interconnected objects, or with end-users or other entities
in the network. The proposed MEGA model considers these properties:

Internet-oriented: the proposed MEGA model identiﬁes three layers (see Figure. ??). These layers
are communicated with two web interfaces enabling the deﬁnition of a ﬂexible and scalable commu-
nication system for controlling the huge amount of subsystems to be required for a complete water
management system.

The Coordination and Management - Exploitation layers are deﬁned as Cloud services. IoT,
as a broader vision of the previous concept of machine-to-machine (M2M) communications, is gaining
support by current Cloud computing infrastructures, which begin to provide so called cloud-based IoT
solutions.

Furthermore, subsystem capabilities (i.e. sensing, actuating, computing and communication tech-
nologies) depend on the speciﬁc conditions of the scenarios in which they are deployed. A seamless
access to subsystems will require that the Subsystems layer includes homogenization through a large
diversity of communication paradigms and higher granularity, to deal with many communication
technologies.

Thing-oriented: Due to previous experiences of the development of systems for water management,
the most granular element to be accessible is the subsystem. It is expected higher granularity in the
coming years, as subsystems are composed by many devices and interrelations, as we describe in the
physical and process models of Section 4. These elements can be redeﬁned as Smart Objects, being
objects which are able to describe its own possible interactions. Smart Object may provide the following
information: Object properties (physical properties and a text description), behavior (different behaviors
based on state variables) and, also, interaction information (current state of dials, gauges, switches, etc.).
It is important to deﬁne how subsystems as smart object containers fulﬁlls the features identiﬁed by
[14] and [15]. Subsystems deﬁnes and provides object identiﬁcation, to do that they must incorporate

12

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Unique system identiﬁcation features. Also, they publish subsystem capabilities, as a list of functions
supported by them, considering the capabilities of integrating objects.

Knowledge-oriented: due to the large heterogeneity of subsystems for water management it is im-
portant to model the characteristics that these subsystems have in common, and their behavior. In this
work we provide a physical model, deﬁning the physical elements executing water management pro-
cesses in a hierarchical way, and also a process model, organizing the execution of particular processes
in water management subsystems. Based on these models, smart execution of water management pro-
cesses is supported through collaboration between subsystems and the Coordination layer, based on the
interchange of information among them (see Figure. 3). Thanks to knowledge provision systems can be
monitored to facilitate public entities tracking the fulﬁllment of regulations. Information to be moni-
tored is autonomously provided by the subsystems based on sensor capabilities. These models can be
enriched with semantics to describe, share, and integrate information, inferring new knowledge related
to water management and irrigation processes. Semantics also helps to create machine-interpretable and
self-descriptive data in the IoT domain. Semantic descriptions can support data integration by enabling
interoperability between different data sources (sensors, devices); however, analysis and mapping be-
tween different semantic description models is still required to facilitate the IoT data integration with
other existing domain knowledge.

4 Reference model for smart water management

This Section describes the water management model that is being developed. This model consist of three
main elements, the Water Management Model, Common Communication Interface and Coordination-
Subsystems (C-S) Interface.

4.1 Water Management Model

The water management model includes the physical model and the process model.

The physical model follows standards EN 61512 [16] and EN 62264 [17]. As proposed by EN 61512
a layered structure is deﬁned and represented in Figure 4. The three upper layers (Company, Location
and Area) are modeled as in EN62264, representing companies organization. The Process Cell and Unit
represent entities in which processes are executed. Examples of process cells and units are an Irrigation
Sector and a Pump Management Station (PMS) respectively. Finally, the Equipment Module and Control
Module are elements belonging to the subsystem and can not be directly accessed by the Coordination
layer. Due to the current advance in the state of the art in IoT these elements will become Smart Elements
in a future and they will be directly identiﬁed and accessed. Hydrants, ﬁltering stations and pumping lines
are examples of equipment modules. Valves engines and meters are examples of control modules.

The process model organizes the execution of particular processes in water management subsystems,
following a predeﬁned strategy. Examples of processes are irrigation, tank ﬁlling, or water consumption
measurements. The process model identiﬁes the Procedure, as the basic element to be executed by
the Process Cell. Procedures are composed by Unit Procedures, as the basic element to be executed
by one unit, and ﬁnally, the Operations, as atomic instructions executed inside units. For example, an
atomic instruction to be executed in a pump management station can be to execute a periodic cleaning
process to optimize the performance of the station. The deﬁnitions of elements and operations in the
physical model and process model respectively enable the operation and remote management of water
management elements, as REQ #1 demands

13

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 3: OPC UA in the automation pyramid for MEGA

nologies according to the state of the art and the requirements imposed by such kind of systems. In the
water management process the equipment has to be deployed into an hostile environment (open air, bad
weather conditions, unattended or difﬁcult access equipment, etc.) Therefore it is a key issue for every
provider that their system is able to solve such difﬁculties even with speciﬁc interfaces.

3 Integrating IoT in water management

Contributing to solutions that integrate the Internet of Things paradigm into water management processes
can be beneﬁcial to address expected solutions. The rest of this Section describes the main beneﬁts of
adopting IoT and the IoT characteristics that are considered in the proposed MEGA model, considering
new advances on ICT technologies for creating feasible and commercial systems [9].

Mark Weiser deﬁned a ”Smart Environment” [10] as - the physical world that is richly and invisibly
interwoven with sensors, actuators, displays, and computational elements, embedded seamlessly in the
everyday objects of our lives, and connected through a continuous network. There are many research
works that contributes to solve various issues in Smart Environments, such as seamless access to re-
sources and devices [11], distributed service executions [12], social choice techniques [13], etc. Other
works explains how IoT is based on three paradigms - internet-oriented (middleware), things oriented
(sensors) and knowledge-oriented (semantics) [14]. Although this type of delineation is required due to
the interdisciplinary nature of the subject, the usefulness of IoT can be unleashed only in an application
domain where the three paradigms intersect.

3.1

IoT for Water Management

The provision of Internet of Things capabilities in water management scenarios can be achieved if we
consider some considerations from the business, social and technical point of view. Here we list the main
beneﬁts of providing IoT in water management scenarios:

Efﬁciency increase: water management companies and associations can use real-time operational
control to make smarter business decisions and reduce operating costs. They use real-time data from

11

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

sensors and actuators to monitor and improve water management infrastructures, making them more
efﬁcient, reducing energy costs and minimizing human intervention.

Cost savings: water management costs can be reduced through improved asset utilization, process
efﬁciencies and productivity. Customers and organizations can beneﬁt from improved asset utilization
(e.g., smart water irrigation units that eliminate manual operation) and service improvements (e.g., re-
mote monitoring of irrigation conditions)

Asset utilization: with improved tracking of assets (machinery, equipment, tools, etc.) using sensors
and connectivity, companies can beneﬁt from transparency and visibility into their assets and supply
chains. They can easily locate assets and run preventive maintenance on critical pieces of infrastructure
and machinery.

Productivity increase: Productivity is a critical parameter that affects the proﬁtability of any organi-
zation. IoT allows real-time control, new business models, process optimization, resource conservations,
service time reduction, and the capability to do all of this globally, reducing the mismatch of required vs.
available skills and improving labor efﬁciency.

Expansion of new and existing business models: IoT is beneﬁcial in any of the three deﬁned
layers. In the subsystem layer, IoT subsystems are able to execute processes and communicate using a
standard communication interface; in the coordination layer, it can be useful to enable SMEs to design
new coordination applications, with the purpose to orchestrate the management and exploitation layer
with the subsystem layers; and ﬁnally, in the management and exploitation layer, IoT identiﬁcation
capabilities contribute to provide tailored information services for an speciﬁc water distribution network
community.

As we explained before, IoT builds on three pillars [14]: Internet orientation, thing orientation, and
knowledge orientation. We link these pillars with the ability of objects to (i) be identiﬁable (anything
identiﬁes itself), (ii) communicate (anything communicates) and (iii) to interact (anything interacts),
either among themselves, building networks of interconnected objects, or with end-users or other entities
in the network. The proposed MEGA model considers these properties:

Internet-oriented: the proposed MEGA model identiﬁes three layers (see Figure. ??). These layers
are communicated with two web interfaces enabling the deﬁnition of a ﬂexible and scalable commu-
nication system for controlling the huge amount of subsystems to be required for a complete water
management system.

The Coordination and Management - Exploitation layers are deﬁned as Cloud services. IoT,
as a broader vision of the previous concept of machine-to-machine (M2M) communications, is gaining
support by current Cloud computing infrastructures, which begin to provide so called cloud-based IoT
solutions.

Furthermore, subsystem capabilities (i.e. sensing, actuating, computing and communication tech-
nologies) depend on the speciﬁc conditions of the scenarios in which they are deployed. A seamless
access to subsystems will require that the Subsystems layer includes homogenization through a large
diversity of communication paradigms and higher granularity, to deal with many communication
technologies.

Thing-oriented: Due to previous experiences of the development of systems for water management,
the most granular element to be accessible is the subsystem. It is expected higher granularity in the
coming years, as subsystems are composed by many devices and interrelations, as we describe in the
physical and process models of Section 4. These elements can be redeﬁned as Smart Objects, being
objects which are able to describe its own possible interactions. Smart Object may provide the following
information: Object properties (physical properties and a text description), behavior (different behaviors
based on state variables) and, also, interaction information (current state of dials, gauges, switches, etc.).
It is important to deﬁne how subsystems as smart object containers fulﬁlls the features identiﬁed by
[14] and [15]. Subsystems deﬁnes and provides object identiﬁcation, to do that they must incorporate

12

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Unique system identiﬁcation features. Also, they publish subsystem capabilities, as a list of functions
supported by them, considering the capabilities of integrating objects.

Knowledge-oriented: due to the large heterogeneity of subsystems for water management it is im-
portant to model the characteristics that these subsystems have in common, and their behavior. In this
work we provide a physical model, deﬁning the physical elements executing water management pro-
cesses in a hierarchical way, and also a process model, organizing the execution of particular processes
in water management subsystems. Based on these models, smart execution of water management pro-
cesses is supported through collaboration between subsystems and the Coordination layer, based on the
interchange of information among them (see Figure. 3). Thanks to knowledge provision systems can be
monitored to facilitate public entities tracking the fulﬁllment of regulations. Information to be moni-
tored is autonomously provided by the subsystems based on sensor capabilities. These models can be
enriched with semantics to describe, share, and integrate information, inferring new knowledge related
to water management and irrigation processes. Semantics also helps to create machine-interpretable and
self-descriptive data in the IoT domain. Semantic descriptions can support data integration by enabling
interoperability between different data sources (sensors, devices); however, analysis and mapping be-
tween different semantic description models is still required to facilitate the IoT data integration with
other existing domain knowledge.

4 Reference model for smart water management

This Section describes the water management model that is being developed. This model consist of three
main elements, the Water Management Model, Common Communication Interface and Coordination-
Subsystems (C-S) Interface.

4.1 Water Management Model

The water management model includes the physical model and the process model.

The physical model follows standards EN 61512 [16] and EN 62264 [17]. As proposed by EN 61512
a layered structure is deﬁned and represented in Figure 4. The three upper layers (Company, Location
and Area) are modeled as in EN62264, representing companies organization. The Process Cell and Unit
represent entities in which processes are executed. Examples of process cells and units are an Irrigation
Sector and a Pump Management Station (PMS) respectively. Finally, the Equipment Module and Control
Module are elements belonging to the subsystem and can not be directly accessed by the Coordination
layer. Due to the current advance in the state of the art in IoT these elements will become Smart Elements
in a future and they will be directly identiﬁed and accessed. Hydrants, ﬁltering stations and pumping lines
are examples of equipment modules. Valves engines and meters are examples of control modules.

The process model organizes the execution of particular processes in water management subsystems,
following a predeﬁned strategy. Examples of processes are irrigation, tank ﬁlling, or water consumption
measurements. The process model identiﬁes the Procedure, as the basic element to be executed by
the Process Cell. Procedures are composed by Unit Procedures, as the basic element to be executed
by one unit, and ﬁnally, the Operations, as atomic instructions executed inside units. For example, an
atomic instruction to be executed in a pump management station can be to execute a periodic cleaning
process to optimize the performance of the station. The deﬁnitions of elements and operations in the
physical model and process model respectively enable the operation and remote management of water
management elements, as REQ #1 demands

13

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.2 Common Communication Interface

The Common Communication interface is composed by a set of web services that are consumed by
applications belonging to the Management - Exploitation layer, in order to operate on entities deﬁned by
the physical model, identify the current state of the systems and also send water management operations
to control the water consume.

Figure 4: Layers of the physical and process models

The Common Communication interface handles messages from the business processes (GIS-based
applications, services providing information about soils, meteorology, as REQ #2 demands), in XML
format, and transforms them to ISA-95/88-compliant OPC UA information models. OPC UA (IEC
62541) is an industry driven standard which provides uniﬁed communication and interaction means for
Service Oriented Architectures and Web Services. It is often used to implement different proﬁles for
automation systems [18] such as home and industrial automation and also water management systems.
OPC UA contributes to fulﬁll REQ #3, as it enables the integration of different systems based on speciﬁc
technologies.

OPC UA deﬁnes an information model that enables the creation of device instances and device types.
We implemented the physical model in OPC UA deﬁning control messages in the Management - Ex-
ploitation layer, and enabling the execution of these messages in the Coordination layer. In order to be
compliant to ISA-9588, we deﬁne recipes, which specify the sequence of activities in the form of pro-
cedural steps. Thus, control messages contain recipes that will be executed in the subsystems, by the
physical components located inside. Using recipes becomes the solution to manage subsystem elements,
which are not directly accessible by the Coordination layer, as the sequence of activities to be performed
must be decoupled from the speciﬁc technology in the subsystems, as REQ #4 demands.

There can be some problems if more that one recipe is executed on the same entity at the same time.
To solve that we deﬁne recipes with execution restrictions, which prevent multiple recipe executions
over the same physical element. To check which elements are used by a recipe the Coordination layer
retrieves the list of operations to be done by the recipe and gets the identiﬁers of the process cells and
units which perform these operations. If any of these process cells and units are used by other recipe that
must be executed at the same time the coordination layer ﬁnds an incompatibility, which must be solved
in the Management - Exploitation layer by user intervention.

Figure 5 describes the deﬁned model for recipes. The control recipe has a RecipeID that uniquely
identiﬁes it. Also, it Header identiﬁes the procedure in which the recipe is included with the Procedu-
ralID, and the type of recipe to execute (RecipeType). The Formula includes the set of actions to be
performed over the entity EntityID. Depending on the recipe type, the formula applies to either the ac-
tive elements (monitoring recipe), irrigation elements (irrigation recipe), hydrants of the entity (hydrant

14

Location Area Process Cell Unit Equipment Module Control Module Company Physical Model Process Design Loading Monitoring Checking Validating Process Execution Operations Procedure Unit Procedure An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 3: OPC UA in the automation pyramid for MEGA

nologies according to the state of the art and the requirements imposed by such kind of systems. In the
water management process the equipment has to be deployed into an hostile environment (open air, bad
weather conditions, unattended or difﬁcult access equipment, etc.) Therefore it is a key issue for every
provider that their system is able to solve such difﬁculties even with speciﬁc interfaces.

3 Integrating IoT in water management

Contributing to solutions that integrate the Internet of Things paradigm into water management processes
can be beneﬁcial to address expected solutions. The rest of this Section describes the main beneﬁts of
adopting IoT and the IoT characteristics that are considered in the proposed MEGA model, considering
new advances on ICT technologies for creating feasible and commercial systems [9].

Mark Weiser deﬁned a ”Smart Environment” [10] as - the physical world that is richly and invisibly
interwoven with sensors, actuators, displays, and computational elements, embedded seamlessly in the
everyday objects of our lives, and connected through a continuous network. There are many research
works that contributes to solve various issues in Smart Environments, such as seamless access to re-
sources and devices [11], distributed service executions [12], social choice techniques [13], etc. Other
works explains how IoT is based on three paradigms - internet-oriented (middleware), things oriented
(sensors) and knowledge-oriented (semantics) [14]. Although this type of delineation is required due to
the interdisciplinary nature of the subject, the usefulness of IoT can be unleashed only in an application
domain where the three paradigms intersect.

3.1

IoT for Water Management

The provision of Internet of Things capabilities in water management scenarios can be achieved if we
consider some considerations from the business, social and technical point of view. Here we list the main
beneﬁts of providing IoT in water management scenarios:

Efﬁciency increase: water management companies and associations can use real-time operational
control to make smarter business decisions and reduce operating costs. They use real-time data from

11

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

sensors and actuators to monitor and improve water management infrastructures, making them more
efﬁcient, reducing energy costs and minimizing human intervention.

Cost savings: water management costs can be reduced through improved asset utilization, process
efﬁciencies and productivity. Customers and organizations can beneﬁt from improved asset utilization
(e.g., smart water irrigation units that eliminate manual operation) and service improvements (e.g., re-
mote monitoring of irrigation conditions)

Asset utilization: with improved tracking of assets (machinery, equipment, tools, etc.) using sensors
and connectivity, companies can beneﬁt from transparency and visibility into their assets and supply
chains. They can easily locate assets and run preventive maintenance on critical pieces of infrastructure
and machinery.

Productivity increase: Productivity is a critical parameter that affects the proﬁtability of any organi-
zation. IoT allows real-time control, new business models, process optimization, resource conservations,
service time reduction, and the capability to do all of this globally, reducing the mismatch of required vs.
available skills and improving labor efﬁciency.

Expansion of new and existing business models: IoT is beneﬁcial in any of the three deﬁned
layers. In the subsystem layer, IoT subsystems are able to execute processes and communicate using a
standard communication interface; in the coordination layer, it can be useful to enable SMEs to design
new coordination applications, with the purpose to orchestrate the management and exploitation layer
with the subsystem layers; and ﬁnally, in the management and exploitation layer, IoT identiﬁcation
capabilities contribute to provide tailored information services for an speciﬁc water distribution network
community.

As we explained before, IoT builds on three pillars [14]: Internet orientation, thing orientation, and
knowledge orientation. We link these pillars with the ability of objects to (i) be identiﬁable (anything
identiﬁes itself), (ii) communicate (anything communicates) and (iii) to interact (anything interacts),
either among themselves, building networks of interconnected objects, or with end-users or other entities
in the network. The proposed MEGA model considers these properties:

Internet-oriented: the proposed MEGA model identiﬁes three layers (see Figure. ??). These layers
are communicated with two web interfaces enabling the deﬁnition of a ﬂexible and scalable commu-
nication system for controlling the huge amount of subsystems to be required for a complete water
management system.

The Coordination and Management - Exploitation layers are deﬁned as Cloud services. IoT,
as a broader vision of the previous concept of machine-to-machine (M2M) communications, is gaining
support by current Cloud computing infrastructures, which begin to provide so called cloud-based IoT
solutions.

Furthermore, subsystem capabilities (i.e. sensing, actuating, computing and communication tech-
nologies) depend on the speciﬁc conditions of the scenarios in which they are deployed. A seamless
access to subsystems will require that the Subsystems layer includes homogenization through a large
diversity of communication paradigms and higher granularity, to deal with many communication
technologies.

Thing-oriented: Due to previous experiences of the development of systems for water management,
the most granular element to be accessible is the subsystem. It is expected higher granularity in the
coming years, as subsystems are composed by many devices and interrelations, as we describe in the
physical and process models of Section 4. These elements can be redeﬁned as Smart Objects, being
objects which are able to describe its own possible interactions. Smart Object may provide the following
information: Object properties (physical properties and a text description), behavior (different behaviors
based on state variables) and, also, interaction information (current state of dials, gauges, switches, etc.).
It is important to deﬁne how subsystems as smart object containers fulﬁlls the features identiﬁed by
[14] and [15]. Subsystems deﬁnes and provides object identiﬁcation, to do that they must incorporate

12

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Unique system identiﬁcation features. Also, they publish subsystem capabilities, as a list of functions
supported by them, considering the capabilities of integrating objects.

Knowledge-oriented: due to the large heterogeneity of subsystems for water management it is im-
portant to model the characteristics that these subsystems have in common, and their behavior. In this
work we provide a physical model, deﬁning the physical elements executing water management pro-
cesses in a hierarchical way, and also a process model, organizing the execution of particular processes
in water management subsystems. Based on these models, smart execution of water management pro-
cesses is supported through collaboration between subsystems and the Coordination layer, based on the
interchange of information among them (see Figure. 3). Thanks to knowledge provision systems can be
monitored to facilitate public entities tracking the fulﬁllment of regulations. Information to be moni-
tored is autonomously provided by the subsystems based on sensor capabilities. These models can be
enriched with semantics to describe, share, and integrate information, inferring new knowledge related
to water management and irrigation processes. Semantics also helps to create machine-interpretable and
self-descriptive data in the IoT domain. Semantic descriptions can support data integration by enabling
interoperability between different data sources (sensors, devices); however, analysis and mapping be-
tween different semantic description models is still required to facilitate the IoT data integration with
other existing domain knowledge.

4 Reference model for smart water management

This Section describes the water management model that is being developed. This model consist of three
main elements, the Water Management Model, Common Communication Interface and Coordination-
Subsystems (C-S) Interface.

4.1 Water Management Model

The water management model includes the physical model and the process model.

The physical model follows standards EN 61512 [16] and EN 62264 [17]. As proposed by EN 61512
a layered structure is deﬁned and represented in Figure 4. The three upper layers (Company, Location
and Area) are modeled as in EN62264, representing companies organization. The Process Cell and Unit
represent entities in which processes are executed. Examples of process cells and units are an Irrigation
Sector and a Pump Management Station (PMS) respectively. Finally, the Equipment Module and Control
Module are elements belonging to the subsystem and can not be directly accessed by the Coordination
layer. Due to the current advance in the state of the art in IoT these elements will become Smart Elements
in a future and they will be directly identiﬁed and accessed. Hydrants, ﬁltering stations and pumping lines
are examples of equipment modules. Valves engines and meters are examples of control modules.

The process model organizes the execution of particular processes in water management subsystems,
following a predeﬁned strategy. Examples of processes are irrigation, tank ﬁlling, or water consumption
measurements. The process model identiﬁes the Procedure, as the basic element to be executed by
the Process Cell. Procedures are composed by Unit Procedures, as the basic element to be executed
by one unit, and ﬁnally, the Operations, as atomic instructions executed inside units. For example, an
atomic instruction to be executed in a pump management station can be to execute a periodic cleaning
process to optimize the performance of the station. The deﬁnitions of elements and operations in the
physical model and process model respectively enable the operation and remote management of water
management elements, as REQ #1 demands

13

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.2 Common Communication Interface

The Common Communication interface is composed by a set of web services that are consumed by
applications belonging to the Management - Exploitation layer, in order to operate on entities deﬁned by
the physical model, identify the current state of the systems and also send water management operations
to control the water consume.

Figure 4: Layers of the physical and process models

The Common Communication interface handles messages from the business processes (GIS-based
applications, services providing information about soils, meteorology, as REQ #2 demands), in XML
format, and transforms them to ISA-95/88-compliant OPC UA information models. OPC UA (IEC
62541) is an industry driven standard which provides uniﬁed communication and interaction means for
Service Oriented Architectures and Web Services. It is often used to implement different proﬁles for
automation systems [18] such as home and industrial automation and also water management systems.
OPC UA contributes to fulﬁll REQ #3, as it enables the integration of different systems based on speciﬁc
technologies.

OPC UA deﬁnes an information model that enables the creation of device instances and device types.
We implemented the physical model in OPC UA deﬁning control messages in the Management - Ex-
ploitation layer, and enabling the execution of these messages in the Coordination layer. In order to be
compliant to ISA-9588, we deﬁne recipes, which specify the sequence of activities in the form of pro-
cedural steps. Thus, control messages contain recipes that will be executed in the subsystems, by the
physical components located inside. Using recipes becomes the solution to manage subsystem elements,
which are not directly accessible by the Coordination layer, as the sequence of activities to be performed
must be decoupled from the speciﬁc technology in the subsystems, as REQ #4 demands.

There can be some problems if more that one recipe is executed on the same entity at the same time.
To solve that we deﬁne recipes with execution restrictions, which prevent multiple recipe executions
over the same physical element. To check which elements are used by a recipe the Coordination layer
retrieves the list of operations to be done by the recipe and gets the identiﬁers of the process cells and
units which perform these operations. If any of these process cells and units are used by other recipe that
must be executed at the same time the coordination layer ﬁnds an incompatibility, which must be solved
in the Management - Exploitation layer by user intervention.

Figure 5 describes the deﬁned model for recipes. The control recipe has a RecipeID that uniquely
identiﬁes it. Also, it Header identiﬁes the procedure in which the recipe is included with the Procedu-
ralID, and the type of recipe to execute (RecipeType). The Formula includes the set of actions to be
performed over the entity EntityID. Depending on the recipe type, the formula applies to either the ac-
tive elements (monitoring recipe), irrigation elements (irrigation recipe), hydrants of the entity (hydrant

14

Location Area Process Cell Unit Equipment Module Control Module Company Physical Model Process Design Loading Monitoring Checking Validating Process Execution Operations Procedure Unit Procedure An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 5: Control recipe model

recipe), etc.

4.3 Coordination-Subsystems interface

The Coordination-Subsystems (C-S) interface exchanges OPC-UA messages between the Coordination
layer and the Subsystems.

Figure 6: Invoking a simple control recipe

This interface considers the water management elements (Units, Process Cells, etc) as a set of nodes,
which can be monitored and accessed by OPC-UA clients. A modiﬁcation of these nodes, due to the
execution of a recipe formula, results in changes in the behavior of physical elements. Recipe formulas
are transfered from the coordination layer to subsystems that can execute them. To do that, the coordi-
nation layer must know the subsystem capabilities. OPC-UA supports the deﬁnition of Proﬁles, which
describes the supported features by an OPC-UA compliant product. Mandatory features that must be
supported by clients and servers are deﬁned in proﬁles, along with other non-required functionalities that
are negotiated between entities. Currently, the OPC Foundation has published more than 60 OPC-UA
proﬁles [19].

Figure 6 describes an interaction diagram of the use case ’Invoking a simple control recipe’. The
diagram reﬂects the interaction between Coordination layer and Subsystems, which includes an OPC-
UA server and an OPC-UA client respectively. Subsystems must discover supported proﬁles by getting
the server endpoints. Then, a secure communication channel is created with the server. A modiﬁcation
of a property in a subsystem device (such as opening a valve) is transmitted through the C-S interface
using the OPC Get Node Attributes command, to retrieve the name, type, description and permissions
(read and/or write) of the node, and ﬁnally, using the OPC write command to change the node value.

15

ControlRecipeRecipeIDHeaderRecipeTypeProceduralIDEntityIDFormulaStartDateMonitoringIrrigationHydrant	  CoordinationOPC-UA ServerOPC-UA ClientSubsystem controllerinvoke ControlRecipediscovery: getEndpointsCreateSecureChannel()Coordination-Subsystems interfaceEndpointDescription[]Get Node AttributesSet S1.valve1 to OPENWrite (nodepath,value)Set valve#1 to OPENSubsystem 1resultdataChange(nodepath,value,status)DONEAn IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 3: OPC UA in the automation pyramid for MEGA

nologies according to the state of the art and the requirements imposed by such kind of systems. In the
water management process the equipment has to be deployed into an hostile environment (open air, bad
weather conditions, unattended or difﬁcult access equipment, etc.) Therefore it is a key issue for every
provider that their system is able to solve such difﬁculties even with speciﬁc interfaces.

3 Integrating IoT in water management

Contributing to solutions that integrate the Internet of Things paradigm into water management processes
can be beneﬁcial to address expected solutions. The rest of this Section describes the main beneﬁts of
adopting IoT and the IoT characteristics that are considered in the proposed MEGA model, considering
new advances on ICT technologies for creating feasible and commercial systems [9].

Mark Weiser deﬁned a ”Smart Environment” [10] as - the physical world that is richly and invisibly
interwoven with sensors, actuators, displays, and computational elements, embedded seamlessly in the
everyday objects of our lives, and connected through a continuous network. There are many research
works that contributes to solve various issues in Smart Environments, such as seamless access to re-
sources and devices [11], distributed service executions [12], social choice techniques [13], etc. Other
works explains how IoT is based on three paradigms - internet-oriented (middleware), things oriented
(sensors) and knowledge-oriented (semantics) [14]. Although this type of delineation is required due to
the interdisciplinary nature of the subject, the usefulness of IoT can be unleashed only in an application
domain where the three paradigms intersect.

3.1

IoT for Water Management

The provision of Internet of Things capabilities in water management scenarios can be achieved if we
consider some considerations from the business, social and technical point of view. Here we list the main
beneﬁts of providing IoT in water management scenarios:

Efﬁciency increase: water management companies and associations can use real-time operational
control to make smarter business decisions and reduce operating costs. They use real-time data from

11

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

sensors and actuators to monitor and improve water management infrastructures, making them more
efﬁcient, reducing energy costs and minimizing human intervention.

Cost savings: water management costs can be reduced through improved asset utilization, process
efﬁciencies and productivity. Customers and organizations can beneﬁt from improved asset utilization
(e.g., smart water irrigation units that eliminate manual operation) and service improvements (e.g., re-
mote monitoring of irrigation conditions)

Asset utilization: with improved tracking of assets (machinery, equipment, tools, etc.) using sensors
and connectivity, companies can beneﬁt from transparency and visibility into their assets and supply
chains. They can easily locate assets and run preventive maintenance on critical pieces of infrastructure
and machinery.

Productivity increase: Productivity is a critical parameter that affects the proﬁtability of any organi-
zation. IoT allows real-time control, new business models, process optimization, resource conservations,
service time reduction, and the capability to do all of this globally, reducing the mismatch of required vs.
available skills and improving labor efﬁciency.

Expansion of new and existing business models: IoT is beneﬁcial in any of the three deﬁned
layers. In the subsystem layer, IoT subsystems are able to execute processes and communicate using a
standard communication interface; in the coordination layer, it can be useful to enable SMEs to design
new coordination applications, with the purpose to orchestrate the management and exploitation layer
with the subsystem layers; and ﬁnally, in the management and exploitation layer, IoT identiﬁcation
capabilities contribute to provide tailored information services for an speciﬁc water distribution network
community.

As we explained before, IoT builds on three pillars [14]: Internet orientation, thing orientation, and
knowledge orientation. We link these pillars with the ability of objects to (i) be identiﬁable (anything
identiﬁes itself), (ii) communicate (anything communicates) and (iii) to interact (anything interacts),
either among themselves, building networks of interconnected objects, or with end-users or other entities
in the network. The proposed MEGA model considers these properties:

Internet-oriented: the proposed MEGA model identiﬁes three layers (see Figure. ??). These layers
are communicated with two web interfaces enabling the deﬁnition of a ﬂexible and scalable commu-
nication system for controlling the huge amount of subsystems to be required for a complete water
management system.

The Coordination and Management - Exploitation layers are deﬁned as Cloud services. IoT,
as a broader vision of the previous concept of machine-to-machine (M2M) communications, is gaining
support by current Cloud computing infrastructures, which begin to provide so called cloud-based IoT
solutions.

Furthermore, subsystem capabilities (i.e. sensing, actuating, computing and communication tech-
nologies) depend on the speciﬁc conditions of the scenarios in which they are deployed. A seamless
access to subsystems will require that the Subsystems layer includes homogenization through a large
diversity of communication paradigms and higher granularity, to deal with many communication
technologies.

Thing-oriented: Due to previous experiences of the development of systems for water management,
the most granular element to be accessible is the subsystem. It is expected higher granularity in the
coming years, as subsystems are composed by many devices and interrelations, as we describe in the
physical and process models of Section 4. These elements can be redeﬁned as Smart Objects, being
objects which are able to describe its own possible interactions. Smart Object may provide the following
information: Object properties (physical properties and a text description), behavior (different behaviors
based on state variables) and, also, interaction information (current state of dials, gauges, switches, etc.).
It is important to deﬁne how subsystems as smart object containers fulﬁlls the features identiﬁed by
[14] and [15]. Subsystems deﬁnes and provides object identiﬁcation, to do that they must incorporate

12

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Unique system identiﬁcation features. Also, they publish subsystem capabilities, as a list of functions
supported by them, considering the capabilities of integrating objects.

Knowledge-oriented: due to the large heterogeneity of subsystems for water management it is im-
portant to model the characteristics that these subsystems have in common, and their behavior. In this
work we provide a physical model, deﬁning the physical elements executing water management pro-
cesses in a hierarchical way, and also a process model, organizing the execution of particular processes
in water management subsystems. Based on these models, smart execution of water management pro-
cesses is supported through collaboration between subsystems and the Coordination layer, based on the
interchange of information among them (see Figure. 3). Thanks to knowledge provision systems can be
monitored to facilitate public entities tracking the fulﬁllment of regulations. Information to be moni-
tored is autonomously provided by the subsystems based on sensor capabilities. These models can be
enriched with semantics to describe, share, and integrate information, inferring new knowledge related
to water management and irrigation processes. Semantics also helps to create machine-interpretable and
self-descriptive data in the IoT domain. Semantic descriptions can support data integration by enabling
interoperability between different data sources (sensors, devices); however, analysis and mapping be-
tween different semantic description models is still required to facilitate the IoT data integration with
other existing domain knowledge.

4 Reference model for smart water management

This Section describes the water management model that is being developed. This model consist of three
main elements, the Water Management Model, Common Communication Interface and Coordination-
Subsystems (C-S) Interface.

4.1 Water Management Model

The water management model includes the physical model and the process model.

The physical model follows standards EN 61512 [16] and EN 62264 [17]. As proposed by EN 61512
a layered structure is deﬁned and represented in Figure 4. The three upper layers (Company, Location
and Area) are modeled as in EN62264, representing companies organization. The Process Cell and Unit
represent entities in which processes are executed. Examples of process cells and units are an Irrigation
Sector and a Pump Management Station (PMS) respectively. Finally, the Equipment Module and Control
Module are elements belonging to the subsystem and can not be directly accessed by the Coordination
layer. Due to the current advance in the state of the art in IoT these elements will become Smart Elements
in a future and they will be directly identiﬁed and accessed. Hydrants, ﬁltering stations and pumping lines
are examples of equipment modules. Valves engines and meters are examples of control modules.

The process model organizes the execution of particular processes in water management subsystems,
following a predeﬁned strategy. Examples of processes are irrigation, tank ﬁlling, or water consumption
measurements. The process model identiﬁes the Procedure, as the basic element to be executed by
the Process Cell. Procedures are composed by Unit Procedures, as the basic element to be executed
by one unit, and ﬁnally, the Operations, as atomic instructions executed inside units. For example, an
atomic instruction to be executed in a pump management station can be to execute a periodic cleaning
process to optimize the performance of the station. The deﬁnitions of elements and operations in the
physical model and process model respectively enable the operation and remote management of water
management elements, as REQ #1 demands

13

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.2 Common Communication Interface

The Common Communication interface is composed by a set of web services that are consumed by
applications belonging to the Management - Exploitation layer, in order to operate on entities deﬁned by
the physical model, identify the current state of the systems and also send water management operations
to control the water consume.

Figure 4: Layers of the physical and process models

The Common Communication interface handles messages from the business processes (GIS-based
applications, services providing information about soils, meteorology, as REQ #2 demands), in XML
format, and transforms them to ISA-95/88-compliant OPC UA information models. OPC UA (IEC
62541) is an industry driven standard which provides uniﬁed communication and interaction means for
Service Oriented Architectures and Web Services. It is often used to implement different proﬁles for
automation systems [18] such as home and industrial automation and also water management systems.
OPC UA contributes to fulﬁll REQ #3, as it enables the integration of different systems based on speciﬁc
technologies.

OPC UA deﬁnes an information model that enables the creation of device instances and device types.
We implemented the physical model in OPC UA deﬁning control messages in the Management - Ex-
ploitation layer, and enabling the execution of these messages in the Coordination layer. In order to be
compliant to ISA-9588, we deﬁne recipes, which specify the sequence of activities in the form of pro-
cedural steps. Thus, control messages contain recipes that will be executed in the subsystems, by the
physical components located inside. Using recipes becomes the solution to manage subsystem elements,
which are not directly accessible by the Coordination layer, as the sequence of activities to be performed
must be decoupled from the speciﬁc technology in the subsystems, as REQ #4 demands.

There can be some problems if more that one recipe is executed on the same entity at the same time.
To solve that we deﬁne recipes with execution restrictions, which prevent multiple recipe executions
over the same physical element. To check which elements are used by a recipe the Coordination layer
retrieves the list of operations to be done by the recipe and gets the identiﬁers of the process cells and
units which perform these operations. If any of these process cells and units are used by other recipe that
must be executed at the same time the coordination layer ﬁnds an incompatibility, which must be solved
in the Management - Exploitation layer by user intervention.

Figure 5 describes the deﬁned model for recipes. The control recipe has a RecipeID that uniquely
identiﬁes it. Also, it Header identiﬁes the procedure in which the recipe is included with the Procedu-
ralID, and the type of recipe to execute (RecipeType). The Formula includes the set of actions to be
performed over the entity EntityID. Depending on the recipe type, the formula applies to either the ac-
tive elements (monitoring recipe), irrigation elements (irrigation recipe), hydrants of the entity (hydrant

14

Location Area Process Cell Unit Equipment Module Control Module Company Physical Model Process Design Loading Monitoring Checking Validating Process Execution Operations Procedure Unit Procedure An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 5: Control recipe model

recipe), etc.

4.3 Coordination-Subsystems interface

The Coordination-Subsystems (C-S) interface exchanges OPC-UA messages between the Coordination
layer and the Subsystems.

Figure 6: Invoking a simple control recipe

This interface considers the water management elements (Units, Process Cells, etc) as a set of nodes,
which can be monitored and accessed by OPC-UA clients. A modiﬁcation of these nodes, due to the
execution of a recipe formula, results in changes in the behavior of physical elements. Recipe formulas
are transfered from the coordination layer to subsystems that can execute them. To do that, the coordi-
nation layer must know the subsystem capabilities. OPC-UA supports the deﬁnition of Proﬁles, which
describes the supported features by an OPC-UA compliant product. Mandatory features that must be
supported by clients and servers are deﬁned in proﬁles, along with other non-required functionalities that
are negotiated between entities. Currently, the OPC Foundation has published more than 60 OPC-UA
proﬁles [19].

Figure 6 describes an interaction diagram of the use case ’Invoking a simple control recipe’. The
diagram reﬂects the interaction between Coordination layer and Subsystems, which includes an OPC-
UA server and an OPC-UA client respectively. Subsystems must discover supported proﬁles by getting
the server endpoints. Then, a secure communication channel is created with the server. A modiﬁcation
of a property in a subsystem device (such as opening a valve) is transmitted through the C-S interface
using the OPC Get Node Attributes command, to retrieve the name, type, description and permissions
(read and/or write) of the node, and ﬁnally, using the OPC write command to change the node value.

15

ControlRecipeRecipeIDHeaderRecipeTypeProceduralIDEntityIDFormulaStartDateMonitoringIrrigationHydrant	  CoordinationOPC-UA ServerOPC-UA ClientSubsystem controllerinvoke ControlRecipediscovery: getEndpointsCreateSecureChannel()Coordination-Subsystems interfaceEndpointDescription[]Get Node AttributesSet S1.valve1 to OPENWrite (nodepath,value)Set valve#1 to OPENSubsystem 1resultdataChange(nodepath,value,status)DONEAn IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

When the change is performed in the physical system (e.g. a valve is opened), the element responds with
a dataChange event that is delivered to the Coordination layer, with the result of the action.

4.4 A simple Use Case

In this Section we illustrate by the use of a simple example how MEGA can be used. We describe a
simple but realistic scenario, we show how the data are deﬁned for loading into MEGA, and ﬁnally we
outline how MEGA performs the process control.

1. Scenario description

The proposed scenario contains “a single subsystem with a hydrant and a water deposit that pro-
vides water to the system”. Figure 7.A shows the scenario schema.

Figure 7: Physical Model

For such Hydraulic Network we want to deﬁne the next process, direct expressed by the farmer:
“to irrigate the 27th of September at 12.00 ﬁnishing at 12:30 and using 800 liters as maximum
volume”.

2. Deﬁnition of the Physical Model

Based on the real equipment described on Figure 7.A the next step is the deﬁnition of the Physical
Model according to MEGA speciﬁcations. Figure 7.B depicts the component identiﬁcation, and
Figure 7.C describes the physical model for this use case. MEGA does not deﬁne any standard
procedure for loading the physical model into MEGA System. The table of Figure 8 is elaborated
from Figure 7.C and loaded into the Coordination Layer.

Figure 8: Physical Model loaded into the Coordination Layer

16

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 3: OPC UA in the automation pyramid for MEGA

nologies according to the state of the art and the requirements imposed by such kind of systems. In the
water management process the equipment has to be deployed into an hostile environment (open air, bad
weather conditions, unattended or difﬁcult access equipment, etc.) Therefore it is a key issue for every
provider that their system is able to solve such difﬁculties even with speciﬁc interfaces.

3 Integrating IoT in water management

Contributing to solutions that integrate the Internet of Things paradigm into water management processes
can be beneﬁcial to address expected solutions. The rest of this Section describes the main beneﬁts of
adopting IoT and the IoT characteristics that are considered in the proposed MEGA model, considering
new advances on ICT technologies for creating feasible and commercial systems [9].

Mark Weiser deﬁned a ”Smart Environment” [10] as - the physical world that is richly and invisibly
interwoven with sensors, actuators, displays, and computational elements, embedded seamlessly in the
everyday objects of our lives, and connected through a continuous network. There are many research
works that contributes to solve various issues in Smart Environments, such as seamless access to re-
sources and devices [11], distributed service executions [12], social choice techniques [13], etc. Other
works explains how IoT is based on three paradigms - internet-oriented (middleware), things oriented
(sensors) and knowledge-oriented (semantics) [14]. Although this type of delineation is required due to
the interdisciplinary nature of the subject, the usefulness of IoT can be unleashed only in an application
domain where the three paradigms intersect.

3.1

IoT for Water Management

The provision of Internet of Things capabilities in water management scenarios can be achieved if we
consider some considerations from the business, social and technical point of view. Here we list the main
beneﬁts of providing IoT in water management scenarios:

Efﬁciency increase: water management companies and associations can use real-time operational
control to make smarter business decisions and reduce operating costs. They use real-time data from

11

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

sensors and actuators to monitor and improve water management infrastructures, making them more
efﬁcient, reducing energy costs and minimizing human intervention.

Cost savings: water management costs can be reduced through improved asset utilization, process
efﬁciencies and productivity. Customers and organizations can beneﬁt from improved asset utilization
(e.g., smart water irrigation units that eliminate manual operation) and service improvements (e.g., re-
mote monitoring of irrigation conditions)

Asset utilization: with improved tracking of assets (machinery, equipment, tools, etc.) using sensors
and connectivity, companies can beneﬁt from transparency and visibility into their assets and supply
chains. They can easily locate assets and run preventive maintenance on critical pieces of infrastructure
and machinery.

Productivity increase: Productivity is a critical parameter that affects the proﬁtability of any organi-
zation. IoT allows real-time control, new business models, process optimization, resource conservations,
service time reduction, and the capability to do all of this globally, reducing the mismatch of required vs.
available skills and improving labor efﬁciency.

Expansion of new and existing business models: IoT is beneﬁcial in any of the three deﬁned
layers. In the subsystem layer, IoT subsystems are able to execute processes and communicate using a
standard communication interface; in the coordination layer, it can be useful to enable SMEs to design
new coordination applications, with the purpose to orchestrate the management and exploitation layer
with the subsystem layers; and ﬁnally, in the management and exploitation layer, IoT identiﬁcation
capabilities contribute to provide tailored information services for an speciﬁc water distribution network
community.

As we explained before, IoT builds on three pillars [14]: Internet orientation, thing orientation, and
knowledge orientation. We link these pillars with the ability of objects to (i) be identiﬁable (anything
identiﬁes itself), (ii) communicate (anything communicates) and (iii) to interact (anything interacts),
either among themselves, building networks of interconnected objects, or with end-users or other entities
in the network. The proposed MEGA model considers these properties:

Internet-oriented: the proposed MEGA model identiﬁes three layers (see Figure. ??). These layers
are communicated with two web interfaces enabling the deﬁnition of a ﬂexible and scalable commu-
nication system for controlling the huge amount of subsystems to be required for a complete water
management system.

The Coordination and Management - Exploitation layers are deﬁned as Cloud services. IoT,
as a broader vision of the previous concept of machine-to-machine (M2M) communications, is gaining
support by current Cloud computing infrastructures, which begin to provide so called cloud-based IoT
solutions.

Furthermore, subsystem capabilities (i.e. sensing, actuating, computing and communication tech-
nologies) depend on the speciﬁc conditions of the scenarios in which they are deployed. A seamless
access to subsystems will require that the Subsystems layer includes homogenization through a large
diversity of communication paradigms and higher granularity, to deal with many communication
technologies.

Thing-oriented: Due to previous experiences of the development of systems for water management,
the most granular element to be accessible is the subsystem. It is expected higher granularity in the
coming years, as subsystems are composed by many devices and interrelations, as we describe in the
physical and process models of Section 4. These elements can be redeﬁned as Smart Objects, being
objects which are able to describe its own possible interactions. Smart Object may provide the following
information: Object properties (physical properties and a text description), behavior (different behaviors
based on state variables) and, also, interaction information (current state of dials, gauges, switches, etc.).
It is important to deﬁne how subsystems as smart object containers fulﬁlls the features identiﬁed by
[14] and [15]. Subsystems deﬁnes and provides object identiﬁcation, to do that they must incorporate

12

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Unique system identiﬁcation features. Also, they publish subsystem capabilities, as a list of functions
supported by them, considering the capabilities of integrating objects.

Knowledge-oriented: due to the large heterogeneity of subsystems for water management it is im-
portant to model the characteristics that these subsystems have in common, and their behavior. In this
work we provide a physical model, deﬁning the physical elements executing water management pro-
cesses in a hierarchical way, and also a process model, organizing the execution of particular processes
in water management subsystems. Based on these models, smart execution of water management pro-
cesses is supported through collaboration between subsystems and the Coordination layer, based on the
interchange of information among them (see Figure. 3). Thanks to knowledge provision systems can be
monitored to facilitate public entities tracking the fulﬁllment of regulations. Information to be moni-
tored is autonomously provided by the subsystems based on sensor capabilities. These models can be
enriched with semantics to describe, share, and integrate information, inferring new knowledge related
to water management and irrigation processes. Semantics also helps to create machine-interpretable and
self-descriptive data in the IoT domain. Semantic descriptions can support data integration by enabling
interoperability between different data sources (sensors, devices); however, analysis and mapping be-
tween different semantic description models is still required to facilitate the IoT data integration with
other existing domain knowledge.

4 Reference model for smart water management

This Section describes the water management model that is being developed. This model consist of three
main elements, the Water Management Model, Common Communication Interface and Coordination-
Subsystems (C-S) Interface.

4.1 Water Management Model

The water management model includes the physical model and the process model.

The physical model follows standards EN 61512 [16] and EN 62264 [17]. As proposed by EN 61512
a layered structure is deﬁned and represented in Figure 4. The three upper layers (Company, Location
and Area) are modeled as in EN62264, representing companies organization. The Process Cell and Unit
represent entities in which processes are executed. Examples of process cells and units are an Irrigation
Sector and a Pump Management Station (PMS) respectively. Finally, the Equipment Module and Control
Module are elements belonging to the subsystem and can not be directly accessed by the Coordination
layer. Due to the current advance in the state of the art in IoT these elements will become Smart Elements
in a future and they will be directly identiﬁed and accessed. Hydrants, ﬁltering stations and pumping lines
are examples of equipment modules. Valves engines and meters are examples of control modules.

The process model organizes the execution of particular processes in water management subsystems,
following a predeﬁned strategy. Examples of processes are irrigation, tank ﬁlling, or water consumption
measurements. The process model identiﬁes the Procedure, as the basic element to be executed by
the Process Cell. Procedures are composed by Unit Procedures, as the basic element to be executed
by one unit, and ﬁnally, the Operations, as atomic instructions executed inside units. For example, an
atomic instruction to be executed in a pump management station can be to execute a periodic cleaning
process to optimize the performance of the station. The deﬁnitions of elements and operations in the
physical model and process model respectively enable the operation and remote management of water
management elements, as REQ #1 demands

13

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.2 Common Communication Interface

The Common Communication interface is composed by a set of web services that are consumed by
applications belonging to the Management - Exploitation layer, in order to operate on entities deﬁned by
the physical model, identify the current state of the systems and also send water management operations
to control the water consume.

Figure 4: Layers of the physical and process models

The Common Communication interface handles messages from the business processes (GIS-based
applications, services providing information about soils, meteorology, as REQ #2 demands), in XML
format, and transforms them to ISA-95/88-compliant OPC UA information models. OPC UA (IEC
62541) is an industry driven standard which provides uniﬁed communication and interaction means for
Service Oriented Architectures and Web Services. It is often used to implement different proﬁles for
automation systems [18] such as home and industrial automation and also water management systems.
OPC UA contributes to fulﬁll REQ #3, as it enables the integration of different systems based on speciﬁc
technologies.

OPC UA deﬁnes an information model that enables the creation of device instances and device types.
We implemented the physical model in OPC UA deﬁning control messages in the Management - Ex-
ploitation layer, and enabling the execution of these messages in the Coordination layer. In order to be
compliant to ISA-9588, we deﬁne recipes, which specify the sequence of activities in the form of pro-
cedural steps. Thus, control messages contain recipes that will be executed in the subsystems, by the
physical components located inside. Using recipes becomes the solution to manage subsystem elements,
which are not directly accessible by the Coordination layer, as the sequence of activities to be performed
must be decoupled from the speciﬁc technology in the subsystems, as REQ #4 demands.

There can be some problems if more that one recipe is executed on the same entity at the same time.
To solve that we deﬁne recipes with execution restrictions, which prevent multiple recipe executions
over the same physical element. To check which elements are used by a recipe the Coordination layer
retrieves the list of operations to be done by the recipe and gets the identiﬁers of the process cells and
units which perform these operations. If any of these process cells and units are used by other recipe that
must be executed at the same time the coordination layer ﬁnds an incompatibility, which must be solved
in the Management - Exploitation layer by user intervention.

Figure 5 describes the deﬁned model for recipes. The control recipe has a RecipeID that uniquely
identiﬁes it. Also, it Header identiﬁes the procedure in which the recipe is included with the Procedu-
ralID, and the type of recipe to execute (RecipeType). The Formula includes the set of actions to be
performed over the entity EntityID. Depending on the recipe type, the formula applies to either the ac-
tive elements (monitoring recipe), irrigation elements (irrigation recipe), hydrants of the entity (hydrant

14

Location Area Process Cell Unit Equipment Module Control Module Company Physical Model Process Design Loading Monitoring Checking Validating Process Execution Operations Procedure Unit Procedure An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 5: Control recipe model

recipe), etc.

4.3 Coordination-Subsystems interface

The Coordination-Subsystems (C-S) interface exchanges OPC-UA messages between the Coordination
layer and the Subsystems.

Figure 6: Invoking a simple control recipe

This interface considers the water management elements (Units, Process Cells, etc) as a set of nodes,
which can be monitored and accessed by OPC-UA clients. A modiﬁcation of these nodes, due to the
execution of a recipe formula, results in changes in the behavior of physical elements. Recipe formulas
are transfered from the coordination layer to subsystems that can execute them. To do that, the coordi-
nation layer must know the subsystem capabilities. OPC-UA supports the deﬁnition of Proﬁles, which
describes the supported features by an OPC-UA compliant product. Mandatory features that must be
supported by clients and servers are deﬁned in proﬁles, along with other non-required functionalities that
are negotiated between entities. Currently, the OPC Foundation has published more than 60 OPC-UA
proﬁles [19].

Figure 6 describes an interaction diagram of the use case ’Invoking a simple control recipe’. The
diagram reﬂects the interaction between Coordination layer and Subsystems, which includes an OPC-
UA server and an OPC-UA client respectively. Subsystems must discover supported proﬁles by getting
the server endpoints. Then, a secure communication channel is created with the server. A modiﬁcation
of a property in a subsystem device (such as opening a valve) is transmitted through the C-S interface
using the OPC Get Node Attributes command, to retrieve the name, type, description and permissions
(read and/or write) of the node, and ﬁnally, using the OPC write command to change the node value.

15

ControlRecipeRecipeIDHeaderRecipeTypeProceduralIDEntityIDFormulaStartDateMonitoringIrrigationHydrant	  CoordinationOPC-UA ServerOPC-UA ClientSubsystem controllerinvoke ControlRecipediscovery: getEndpointsCreateSecureChannel()Coordination-Subsystems interfaceEndpointDescription[]Get Node AttributesSet S1.valve1 to OPENWrite (nodepath,value)Set valve#1 to OPENSubsystem 1resultdataChange(nodepath,value,status)DONEAn IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

When the change is performed in the physical system (e.g. a valve is opened), the element responds with
a dataChange event that is delivered to the Coordination layer, with the result of the action.

4.4 A simple Use Case

In this Section we illustrate by the use of a simple example how MEGA can be used. We describe a
simple but realistic scenario, we show how the data are deﬁned for loading into MEGA, and ﬁnally we
outline how MEGA performs the process control.

1. Scenario description

The proposed scenario contains “a single subsystem with a hydrant and a water deposit that pro-
vides water to the system”. Figure 7.A shows the scenario schema.

Figure 7: Physical Model

For such Hydraulic Network we want to deﬁne the next process, direct expressed by the farmer:
“to irrigate the 27th of September at 12.00 ﬁnishing at 12:30 and using 800 liters as maximum
volume”.

2. Deﬁnition of the Physical Model

Based on the real equipment described on Figure 7.A the next step is the deﬁnition of the Physical
Model according to MEGA speciﬁcations. Figure 7.B depicts the component identiﬁcation, and
Figure 7.C describes the physical model for this use case. MEGA does not deﬁne any standard
procedure for loading the physical model into MEGA System. The table of Figure 8 is elaborated
from Figure 7.C and loaded into the Coordination Layer.

Figure 8: Physical Model loaded into the Coordination Layer

16

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.5 Deﬁnition of the Master recipe
As described in Section 4.2 MEGA requires the deﬁnition of a Master recipe. The translation of the
informal process to a semi-formal recipe is as follows:

• It is required to execute the process Irrigation recipe 1 over the simple hydrant HYS01
• Starting time for initiating the execution of the recipe: 27th of October of 2013, at 12:00
• End of the execution of the recipe: 27th of October of 2013, at 12:30
• Max water used for irrigation: 800 liters
MEGA does not specify how to deﬁne the recipes. In our case, the following elements apply:
• The target entity for the recipe is: WMD01.IRS01.DNT01.NBU01.HYS02
• The conditions that apply to this recipe are:

– StartDate (201312011200) according to ISO8601
– Two conditions for ﬁnishing:
∗ MaxVolume − > 0.8(m3)
∗ MaxDuration − > 1800(seg.)

In order to illustrate how a water management procedure recipe looks like Figure 9 presents the XML

description of the example of Master recipe given above.

Figure 9: Operation Process over a single Entity

The ﬁnal element to be loaded into the MEGA system is the Master Recipe, which encloses the
process deﬁned in Figure 9 into several “administrative” envelops, which detailed description is beyond
the scope of this paper.

The Master recipe is transferred to the Coordination Level, where the following functions are per-

formed:

17

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 3: OPC UA in the automation pyramid for MEGA

nologies according to the state of the art and the requirements imposed by such kind of systems. In the
water management process the equipment has to be deployed into an hostile environment (open air, bad
weather conditions, unattended or difﬁcult access equipment, etc.) Therefore it is a key issue for every
provider that their system is able to solve such difﬁculties even with speciﬁc interfaces.

3 Integrating IoT in water management

Contributing to solutions that integrate the Internet of Things paradigm into water management processes
can be beneﬁcial to address expected solutions. The rest of this Section describes the main beneﬁts of
adopting IoT and the IoT characteristics that are considered in the proposed MEGA model, considering
new advances on ICT technologies for creating feasible and commercial systems [9].

Mark Weiser deﬁned a ”Smart Environment” [10] as - the physical world that is richly and invisibly
interwoven with sensors, actuators, displays, and computational elements, embedded seamlessly in the
everyday objects of our lives, and connected through a continuous network. There are many research
works that contributes to solve various issues in Smart Environments, such as seamless access to re-
sources and devices [11], distributed service executions [12], social choice techniques [13], etc. Other
works explains how IoT is based on three paradigms - internet-oriented (middleware), things oriented
(sensors) and knowledge-oriented (semantics) [14]. Although this type of delineation is required due to
the interdisciplinary nature of the subject, the usefulness of IoT can be unleashed only in an application
domain where the three paradigms intersect.

3.1

IoT for Water Management

The provision of Internet of Things capabilities in water management scenarios can be achieved if we
consider some considerations from the business, social and technical point of view. Here we list the main
beneﬁts of providing IoT in water management scenarios:

Efﬁciency increase: water management companies and associations can use real-time operational
control to make smarter business decisions and reduce operating costs. They use real-time data from

11

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

sensors and actuators to monitor and improve water management infrastructures, making them more
efﬁcient, reducing energy costs and minimizing human intervention.

Cost savings: water management costs can be reduced through improved asset utilization, process
efﬁciencies and productivity. Customers and organizations can beneﬁt from improved asset utilization
(e.g., smart water irrigation units that eliminate manual operation) and service improvements (e.g., re-
mote monitoring of irrigation conditions)

Asset utilization: with improved tracking of assets (machinery, equipment, tools, etc.) using sensors
and connectivity, companies can beneﬁt from transparency and visibility into their assets and supply
chains. They can easily locate assets and run preventive maintenance on critical pieces of infrastructure
and machinery.

Productivity increase: Productivity is a critical parameter that affects the proﬁtability of any organi-
zation. IoT allows real-time control, new business models, process optimization, resource conservations,
service time reduction, and the capability to do all of this globally, reducing the mismatch of required vs.
available skills and improving labor efﬁciency.

Expansion of new and existing business models: IoT is beneﬁcial in any of the three deﬁned
layers. In the subsystem layer, IoT subsystems are able to execute processes and communicate using a
standard communication interface; in the coordination layer, it can be useful to enable SMEs to design
new coordination applications, with the purpose to orchestrate the management and exploitation layer
with the subsystem layers; and ﬁnally, in the management and exploitation layer, IoT identiﬁcation
capabilities contribute to provide tailored information services for an speciﬁc water distribution network
community.

As we explained before, IoT builds on three pillars [14]: Internet orientation, thing orientation, and
knowledge orientation. We link these pillars with the ability of objects to (i) be identiﬁable (anything
identiﬁes itself), (ii) communicate (anything communicates) and (iii) to interact (anything interacts),
either among themselves, building networks of interconnected objects, or with end-users or other entities
in the network. The proposed MEGA model considers these properties:

Internet-oriented: the proposed MEGA model identiﬁes three layers (see Figure. ??). These layers
are communicated with two web interfaces enabling the deﬁnition of a ﬂexible and scalable commu-
nication system for controlling the huge amount of subsystems to be required for a complete water
management system.

The Coordination and Management - Exploitation layers are deﬁned as Cloud services. IoT,
as a broader vision of the previous concept of machine-to-machine (M2M) communications, is gaining
support by current Cloud computing infrastructures, which begin to provide so called cloud-based IoT
solutions.

Furthermore, subsystem capabilities (i.e. sensing, actuating, computing and communication tech-
nologies) depend on the speciﬁc conditions of the scenarios in which they are deployed. A seamless
access to subsystems will require that the Subsystems layer includes homogenization through a large
diversity of communication paradigms and higher granularity, to deal with many communication
technologies.

Thing-oriented: Due to previous experiences of the development of systems for water management,
the most granular element to be accessible is the subsystem. It is expected higher granularity in the
coming years, as subsystems are composed by many devices and interrelations, as we describe in the
physical and process models of Section 4. These elements can be redeﬁned as Smart Objects, being
objects which are able to describe its own possible interactions. Smart Object may provide the following
information: Object properties (physical properties and a text description), behavior (different behaviors
based on state variables) and, also, interaction information (current state of dials, gauges, switches, etc.).
It is important to deﬁne how subsystems as smart object containers fulﬁlls the features identiﬁed by
[14] and [15]. Subsystems deﬁnes and provides object identiﬁcation, to do that they must incorporate

12

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Unique system identiﬁcation features. Also, they publish subsystem capabilities, as a list of functions
supported by them, considering the capabilities of integrating objects.

Knowledge-oriented: due to the large heterogeneity of subsystems for water management it is im-
portant to model the characteristics that these subsystems have in common, and their behavior. In this
work we provide a physical model, deﬁning the physical elements executing water management pro-
cesses in a hierarchical way, and also a process model, organizing the execution of particular processes
in water management subsystems. Based on these models, smart execution of water management pro-
cesses is supported through collaboration between subsystems and the Coordination layer, based on the
interchange of information among them (see Figure. 3). Thanks to knowledge provision systems can be
monitored to facilitate public entities tracking the fulﬁllment of regulations. Information to be moni-
tored is autonomously provided by the subsystems based on sensor capabilities. These models can be
enriched with semantics to describe, share, and integrate information, inferring new knowledge related
to water management and irrigation processes. Semantics also helps to create machine-interpretable and
self-descriptive data in the IoT domain. Semantic descriptions can support data integration by enabling
interoperability between different data sources (sensors, devices); however, analysis and mapping be-
tween different semantic description models is still required to facilitate the IoT data integration with
other existing domain knowledge.

4 Reference model for smart water management

This Section describes the water management model that is being developed. This model consist of three
main elements, the Water Management Model, Common Communication Interface and Coordination-
Subsystems (C-S) Interface.

4.1 Water Management Model

The water management model includes the physical model and the process model.

The physical model follows standards EN 61512 [16] and EN 62264 [17]. As proposed by EN 61512
a layered structure is deﬁned and represented in Figure 4. The three upper layers (Company, Location
and Area) are modeled as in EN62264, representing companies organization. The Process Cell and Unit
represent entities in which processes are executed. Examples of process cells and units are an Irrigation
Sector and a Pump Management Station (PMS) respectively. Finally, the Equipment Module and Control
Module are elements belonging to the subsystem and can not be directly accessed by the Coordination
layer. Due to the current advance in the state of the art in IoT these elements will become Smart Elements
in a future and they will be directly identiﬁed and accessed. Hydrants, ﬁltering stations and pumping lines
are examples of equipment modules. Valves engines and meters are examples of control modules.

The process model organizes the execution of particular processes in water management subsystems,
following a predeﬁned strategy. Examples of processes are irrigation, tank ﬁlling, or water consumption
measurements. The process model identiﬁes the Procedure, as the basic element to be executed by
the Process Cell. Procedures are composed by Unit Procedures, as the basic element to be executed
by one unit, and ﬁnally, the Operations, as atomic instructions executed inside units. For example, an
atomic instruction to be executed in a pump management station can be to execute a periodic cleaning
process to optimize the performance of the station. The deﬁnitions of elements and operations in the
physical model and process model respectively enable the operation and remote management of water
management elements, as REQ #1 demands

13

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.2 Common Communication Interface

The Common Communication interface is composed by a set of web services that are consumed by
applications belonging to the Management - Exploitation layer, in order to operate on entities deﬁned by
the physical model, identify the current state of the systems and also send water management operations
to control the water consume.

Figure 4: Layers of the physical and process models

The Common Communication interface handles messages from the business processes (GIS-based
applications, services providing information about soils, meteorology, as REQ #2 demands), in XML
format, and transforms them to ISA-95/88-compliant OPC UA information models. OPC UA (IEC
62541) is an industry driven standard which provides uniﬁed communication and interaction means for
Service Oriented Architectures and Web Services. It is often used to implement different proﬁles for
automation systems [18] such as home and industrial automation and also water management systems.
OPC UA contributes to fulﬁll REQ #3, as it enables the integration of different systems based on speciﬁc
technologies.

OPC UA deﬁnes an information model that enables the creation of device instances and device types.
We implemented the physical model in OPC UA deﬁning control messages in the Management - Ex-
ploitation layer, and enabling the execution of these messages in the Coordination layer. In order to be
compliant to ISA-9588, we deﬁne recipes, which specify the sequence of activities in the form of pro-
cedural steps. Thus, control messages contain recipes that will be executed in the subsystems, by the
physical components located inside. Using recipes becomes the solution to manage subsystem elements,
which are not directly accessible by the Coordination layer, as the sequence of activities to be performed
must be decoupled from the speciﬁc technology in the subsystems, as REQ #4 demands.

There can be some problems if more that one recipe is executed on the same entity at the same time.
To solve that we deﬁne recipes with execution restrictions, which prevent multiple recipe executions
over the same physical element. To check which elements are used by a recipe the Coordination layer
retrieves the list of operations to be done by the recipe and gets the identiﬁers of the process cells and
units which perform these operations. If any of these process cells and units are used by other recipe that
must be executed at the same time the coordination layer ﬁnds an incompatibility, which must be solved
in the Management - Exploitation layer by user intervention.

Figure 5 describes the deﬁned model for recipes. The control recipe has a RecipeID that uniquely
identiﬁes it. Also, it Header identiﬁes the procedure in which the recipe is included with the Procedu-
ralID, and the type of recipe to execute (RecipeType). The Formula includes the set of actions to be
performed over the entity EntityID. Depending on the recipe type, the formula applies to either the ac-
tive elements (monitoring recipe), irrigation elements (irrigation recipe), hydrants of the entity (hydrant

14

Location Area Process Cell Unit Equipment Module Control Module Company Physical Model Process Design Loading Monitoring Checking Validating Process Execution Operations Procedure Unit Procedure An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 5: Control recipe model

recipe), etc.

4.3 Coordination-Subsystems interface

The Coordination-Subsystems (C-S) interface exchanges OPC-UA messages between the Coordination
layer and the Subsystems.

Figure 6: Invoking a simple control recipe

This interface considers the water management elements (Units, Process Cells, etc) as a set of nodes,
which can be monitored and accessed by OPC-UA clients. A modiﬁcation of these nodes, due to the
execution of a recipe formula, results in changes in the behavior of physical elements. Recipe formulas
are transfered from the coordination layer to subsystems that can execute them. To do that, the coordi-
nation layer must know the subsystem capabilities. OPC-UA supports the deﬁnition of Proﬁles, which
describes the supported features by an OPC-UA compliant product. Mandatory features that must be
supported by clients and servers are deﬁned in proﬁles, along with other non-required functionalities that
are negotiated between entities. Currently, the OPC Foundation has published more than 60 OPC-UA
proﬁles [19].

Figure 6 describes an interaction diagram of the use case ’Invoking a simple control recipe’. The
diagram reﬂects the interaction between Coordination layer and Subsystems, which includes an OPC-
UA server and an OPC-UA client respectively. Subsystems must discover supported proﬁles by getting
the server endpoints. Then, a secure communication channel is created with the server. A modiﬁcation
of a property in a subsystem device (such as opening a valve) is transmitted through the C-S interface
using the OPC Get Node Attributes command, to retrieve the name, type, description and permissions
(read and/or write) of the node, and ﬁnally, using the OPC write command to change the node value.

15

ControlRecipeRecipeIDHeaderRecipeTypeProceduralIDEntityIDFormulaStartDateMonitoringIrrigationHydrant	  CoordinationOPC-UA ServerOPC-UA ClientSubsystem controllerinvoke ControlRecipediscovery: getEndpointsCreateSecureChannel()Coordination-Subsystems interfaceEndpointDescription[]Get Node AttributesSet S1.valve1 to OPENWrite (nodepath,value)Set valve#1 to OPENSubsystem 1resultdataChange(nodepath,value,status)DONEAn IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

When the change is performed in the physical system (e.g. a valve is opened), the element responds with
a dataChange event that is delivered to the Coordination layer, with the result of the action.

4.4 A simple Use Case

In this Section we illustrate by the use of a simple example how MEGA can be used. We describe a
simple but realistic scenario, we show how the data are deﬁned for loading into MEGA, and ﬁnally we
outline how MEGA performs the process control.

1. Scenario description

The proposed scenario contains “a single subsystem with a hydrant and a water deposit that pro-
vides water to the system”. Figure 7.A shows the scenario schema.

Figure 7: Physical Model

For such Hydraulic Network we want to deﬁne the next process, direct expressed by the farmer:
“to irrigate the 27th of September at 12.00 ﬁnishing at 12:30 and using 800 liters as maximum
volume”.

2. Deﬁnition of the Physical Model

Based on the real equipment described on Figure 7.A the next step is the deﬁnition of the Physical
Model according to MEGA speciﬁcations. Figure 7.B depicts the component identiﬁcation, and
Figure 7.C describes the physical model for this use case. MEGA does not deﬁne any standard
procedure for loading the physical model into MEGA System. The table of Figure 8 is elaborated
from Figure 7.C and loaded into the Coordination Layer.

Figure 8: Physical Model loaded into the Coordination Layer

16

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.5 Deﬁnition of the Master recipe
As described in Section 4.2 MEGA requires the deﬁnition of a Master recipe. The translation of the
informal process to a semi-formal recipe is as follows:

• It is required to execute the process Irrigation recipe 1 over the simple hydrant HYS01
• Starting time for initiating the execution of the recipe: 27th of October of 2013, at 12:00
• End of the execution of the recipe: 27th of October of 2013, at 12:30
• Max water used for irrigation: 800 liters
MEGA does not specify how to deﬁne the recipes. In our case, the following elements apply:
• The target entity for the recipe is: WMD01.IRS01.DNT01.NBU01.HYS02
• The conditions that apply to this recipe are:

– StartDate (201312011200) according to ISO8601
– Two conditions for ﬁnishing:
∗ MaxVolume − > 0.8(m3)
∗ MaxDuration − > 1800(seg.)

In order to illustrate how a water management procedure recipe looks like Figure 9 presents the XML

description of the example of Master recipe given above.

Figure 9: Operation Process over a single Entity

The ﬁnal element to be loaded into the MEGA system is the Master Recipe, which encloses the
process deﬁned in Figure 9 into several “administrative” envelops, which detailed description is beyond
the scope of this paper.

The Master recipe is transferred to the Coordination Level, where the following functions are per-

formed:

17

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

1. Identiﬁers Mapping: Identiﬁers of the Master recipe are mapped into identiﬁer of the subsys-
tems. The identiﬁers mapping algorithm is not deﬁned by MEGA, neither current version of OPC
UA. In MEGA this functionality is left for manual or semiautomatic implementation according to
developer’s preferences. Currently there is an initiative of OPC UA standardization in order to be
able to support automatic identiﬁcation of entities with OPC UA, we expect that next version of
MEGA can incorporate this enhancement.

2. Recipe validation: The validation of the recipe sent by the Management and Exploitation Layer
requires to check that the corresponding subsystem is able to execute the process contained in this
Recipe. MEGA deﬁnes a procedure for deciding when it is not going to be concurrency problems
related to the assignation of more than one process to the same entity at the same time period. In
our simple scenario HYSO1 does not have any other process assigned for execution, so there is
not any scheduling problem.

3. Process transfer to the suitable subsystem: The process to be executed for each entity is going to
be transferred to the subsystem where the entity is located, and alarms and values can be monitored
from the Control Application using standard mechanisms of OPC UA. In this case there is no
alarms or values to be monitored.

4. Control and monitoring of the process execution: The transferred process is monitored from
the Control application, while the process is autonomously executed at the subsystem level. The
Coordination Layer provides information to the Management and Exploitation Layer about the
execution of each Recipe.

4.6 Water management scenario description

Scenarios for water management consider natural environments, cities and rural regions. Systems de-
ployed in these scenarios are controlled by applications that access to subsystems. It is necessary to
consider various conditions, ranging from the number of subsystems to be deployed to the business mod-
els that must be considered for subsystem control, exploitation services and information exchange. This
Section describes the deployment scenario we have deﬁned for validating the MEGA model, that is de-
veloped in Aula Dei, an experimental station in Zaragoza, Spain. We also enumerate the list of functions
that we are going to test in this station.

The Aula Dei experimental station is focused in the water management cycle, speciﬁcally in irri-
gation. A complete irrigation system is modeled, from the water intake to the distribution to the latest
elements (i.e. hydrants). One irrigation system works by gravity and the other one works by artiﬁcial
pressure, to cover all the situations that can be presented in a real setting. From the point of view of the
automation and control elements, the execution of various procedures is allowed in the same hydraulic
element. Speciﬁcally, the installation is divided into:

1. Upper network with two water tanks at different levels and a lifting station with two pumps in

parallel and level control function.

2. Pressure network with automatic pumping station, three pumps in parallel. Two of them with
variable speed drive. The network is composed by 20 hydrants, grouped into 4 lines that return
water to the tank, closing the cycle.

3. Control center with the necessary computer equipment for proper control and installation, as well

as for conducting some tests over the management applications.

18

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 3: OPC UA in the automation pyramid for MEGA

nologies according to the state of the art and the requirements imposed by such kind of systems. In the
water management process the equipment has to be deployed into an hostile environment (open air, bad
weather conditions, unattended or difﬁcult access equipment, etc.) Therefore it is a key issue for every
provider that their system is able to solve such difﬁculties even with speciﬁc interfaces.

3 Integrating IoT in water management

Contributing to solutions that integrate the Internet of Things paradigm into water management processes
can be beneﬁcial to address expected solutions. The rest of this Section describes the main beneﬁts of
adopting IoT and the IoT characteristics that are considered in the proposed MEGA model, considering
new advances on ICT technologies for creating feasible and commercial systems [9].

Mark Weiser deﬁned a ”Smart Environment” [10] as - the physical world that is richly and invisibly
interwoven with sensors, actuators, displays, and computational elements, embedded seamlessly in the
everyday objects of our lives, and connected through a continuous network. There are many research
works that contributes to solve various issues in Smart Environments, such as seamless access to re-
sources and devices [11], distributed service executions [12], social choice techniques [13], etc. Other
works explains how IoT is based on three paradigms - internet-oriented (middleware), things oriented
(sensors) and knowledge-oriented (semantics) [14]. Although this type of delineation is required due to
the interdisciplinary nature of the subject, the usefulness of IoT can be unleashed only in an application
domain where the three paradigms intersect.

3.1

IoT for Water Management

The provision of Internet of Things capabilities in water management scenarios can be achieved if we
consider some considerations from the business, social and technical point of view. Here we list the main
beneﬁts of providing IoT in water management scenarios:

Efﬁciency increase: water management companies and associations can use real-time operational
control to make smarter business decisions and reduce operating costs. They use real-time data from

11

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

sensors and actuators to monitor and improve water management infrastructures, making them more
efﬁcient, reducing energy costs and minimizing human intervention.

Cost savings: water management costs can be reduced through improved asset utilization, process
efﬁciencies and productivity. Customers and organizations can beneﬁt from improved asset utilization
(e.g., smart water irrigation units that eliminate manual operation) and service improvements (e.g., re-
mote monitoring of irrigation conditions)

Asset utilization: with improved tracking of assets (machinery, equipment, tools, etc.) using sensors
and connectivity, companies can beneﬁt from transparency and visibility into their assets and supply
chains. They can easily locate assets and run preventive maintenance on critical pieces of infrastructure
and machinery.

Productivity increase: Productivity is a critical parameter that affects the proﬁtability of any organi-
zation. IoT allows real-time control, new business models, process optimization, resource conservations,
service time reduction, and the capability to do all of this globally, reducing the mismatch of required vs.
available skills and improving labor efﬁciency.

Expansion of new and existing business models: IoT is beneﬁcial in any of the three deﬁned
layers. In the subsystem layer, IoT subsystems are able to execute processes and communicate using a
standard communication interface; in the coordination layer, it can be useful to enable SMEs to design
new coordination applications, with the purpose to orchestrate the management and exploitation layer
with the subsystem layers; and ﬁnally, in the management and exploitation layer, IoT identiﬁcation
capabilities contribute to provide tailored information services for an speciﬁc water distribution network
community.

As we explained before, IoT builds on three pillars [14]: Internet orientation, thing orientation, and
knowledge orientation. We link these pillars with the ability of objects to (i) be identiﬁable (anything
identiﬁes itself), (ii) communicate (anything communicates) and (iii) to interact (anything interacts),
either among themselves, building networks of interconnected objects, or with end-users or other entities
in the network. The proposed MEGA model considers these properties:

Internet-oriented: the proposed MEGA model identiﬁes three layers (see Figure. ??). These layers
are communicated with two web interfaces enabling the deﬁnition of a ﬂexible and scalable commu-
nication system for controlling the huge amount of subsystems to be required for a complete water
management system.

The Coordination and Management - Exploitation layers are deﬁned as Cloud services. IoT,
as a broader vision of the previous concept of machine-to-machine (M2M) communications, is gaining
support by current Cloud computing infrastructures, which begin to provide so called cloud-based IoT
solutions.

Furthermore, subsystem capabilities (i.e. sensing, actuating, computing and communication tech-
nologies) depend on the speciﬁc conditions of the scenarios in which they are deployed. A seamless
access to subsystems will require that the Subsystems layer includes homogenization through a large
diversity of communication paradigms and higher granularity, to deal with many communication
technologies.

Thing-oriented: Due to previous experiences of the development of systems for water management,
the most granular element to be accessible is the subsystem. It is expected higher granularity in the
coming years, as subsystems are composed by many devices and interrelations, as we describe in the
physical and process models of Section 4. These elements can be redeﬁned as Smart Objects, being
objects which are able to describe its own possible interactions. Smart Object may provide the following
information: Object properties (physical properties and a text description), behavior (different behaviors
based on state variables) and, also, interaction information (current state of dials, gauges, switches, etc.).
It is important to deﬁne how subsystems as smart object containers fulﬁlls the features identiﬁed by
[14] and [15]. Subsystems deﬁnes and provides object identiﬁcation, to do that they must incorporate

12

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Unique system identiﬁcation features. Also, they publish subsystem capabilities, as a list of functions
supported by them, considering the capabilities of integrating objects.

Knowledge-oriented: due to the large heterogeneity of subsystems for water management it is im-
portant to model the characteristics that these subsystems have in common, and their behavior. In this
work we provide a physical model, deﬁning the physical elements executing water management pro-
cesses in a hierarchical way, and also a process model, organizing the execution of particular processes
in water management subsystems. Based on these models, smart execution of water management pro-
cesses is supported through collaboration between subsystems and the Coordination layer, based on the
interchange of information among them (see Figure. 3). Thanks to knowledge provision systems can be
monitored to facilitate public entities tracking the fulﬁllment of regulations. Information to be moni-
tored is autonomously provided by the subsystems based on sensor capabilities. These models can be
enriched with semantics to describe, share, and integrate information, inferring new knowledge related
to water management and irrigation processes. Semantics also helps to create machine-interpretable and
self-descriptive data in the IoT domain. Semantic descriptions can support data integration by enabling
interoperability between different data sources (sensors, devices); however, analysis and mapping be-
tween different semantic description models is still required to facilitate the IoT data integration with
other existing domain knowledge.

4 Reference model for smart water management

This Section describes the water management model that is being developed. This model consist of three
main elements, the Water Management Model, Common Communication Interface and Coordination-
Subsystems (C-S) Interface.

4.1 Water Management Model

The water management model includes the physical model and the process model.

The physical model follows standards EN 61512 [16] and EN 62264 [17]. As proposed by EN 61512
a layered structure is deﬁned and represented in Figure 4. The three upper layers (Company, Location
and Area) are modeled as in EN62264, representing companies organization. The Process Cell and Unit
represent entities in which processes are executed. Examples of process cells and units are an Irrigation
Sector and a Pump Management Station (PMS) respectively. Finally, the Equipment Module and Control
Module are elements belonging to the subsystem and can not be directly accessed by the Coordination
layer. Due to the current advance in the state of the art in IoT these elements will become Smart Elements
in a future and they will be directly identiﬁed and accessed. Hydrants, ﬁltering stations and pumping lines
are examples of equipment modules. Valves engines and meters are examples of control modules.

The process model organizes the execution of particular processes in water management subsystems,
following a predeﬁned strategy. Examples of processes are irrigation, tank ﬁlling, or water consumption
measurements. The process model identiﬁes the Procedure, as the basic element to be executed by
the Process Cell. Procedures are composed by Unit Procedures, as the basic element to be executed
by one unit, and ﬁnally, the Operations, as atomic instructions executed inside units. For example, an
atomic instruction to be executed in a pump management station can be to execute a periodic cleaning
process to optimize the performance of the station. The deﬁnitions of elements and operations in the
physical model and process model respectively enable the operation and remote management of water
management elements, as REQ #1 demands

13

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.2 Common Communication Interface

The Common Communication interface is composed by a set of web services that are consumed by
applications belonging to the Management - Exploitation layer, in order to operate on entities deﬁned by
the physical model, identify the current state of the systems and also send water management operations
to control the water consume.

Figure 4: Layers of the physical and process models

The Common Communication interface handles messages from the business processes (GIS-based
applications, services providing information about soils, meteorology, as REQ #2 demands), in XML
format, and transforms them to ISA-95/88-compliant OPC UA information models. OPC UA (IEC
62541) is an industry driven standard which provides uniﬁed communication and interaction means for
Service Oriented Architectures and Web Services. It is often used to implement different proﬁles for
automation systems [18] such as home and industrial automation and also water management systems.
OPC UA contributes to fulﬁll REQ #3, as it enables the integration of different systems based on speciﬁc
technologies.

OPC UA deﬁnes an information model that enables the creation of device instances and device types.
We implemented the physical model in OPC UA deﬁning control messages in the Management - Ex-
ploitation layer, and enabling the execution of these messages in the Coordination layer. In order to be
compliant to ISA-9588, we deﬁne recipes, which specify the sequence of activities in the form of pro-
cedural steps. Thus, control messages contain recipes that will be executed in the subsystems, by the
physical components located inside. Using recipes becomes the solution to manage subsystem elements,
which are not directly accessible by the Coordination layer, as the sequence of activities to be performed
must be decoupled from the speciﬁc technology in the subsystems, as REQ #4 demands.

There can be some problems if more that one recipe is executed on the same entity at the same time.
To solve that we deﬁne recipes with execution restrictions, which prevent multiple recipe executions
over the same physical element. To check which elements are used by a recipe the Coordination layer
retrieves the list of operations to be done by the recipe and gets the identiﬁers of the process cells and
units which perform these operations. If any of these process cells and units are used by other recipe that
must be executed at the same time the coordination layer ﬁnds an incompatibility, which must be solved
in the Management - Exploitation layer by user intervention.

Figure 5 describes the deﬁned model for recipes. The control recipe has a RecipeID that uniquely
identiﬁes it. Also, it Header identiﬁes the procedure in which the recipe is included with the Procedu-
ralID, and the type of recipe to execute (RecipeType). The Formula includes the set of actions to be
performed over the entity EntityID. Depending on the recipe type, the formula applies to either the ac-
tive elements (monitoring recipe), irrigation elements (irrigation recipe), hydrants of the entity (hydrant

14

Location Area Process Cell Unit Equipment Module Control Module Company Physical Model Process Design Loading Monitoring Checking Validating Process Execution Operations Procedure Unit Procedure An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 5: Control recipe model

recipe), etc.

4.3 Coordination-Subsystems interface

The Coordination-Subsystems (C-S) interface exchanges OPC-UA messages between the Coordination
layer and the Subsystems.

Figure 6: Invoking a simple control recipe

This interface considers the water management elements (Units, Process Cells, etc) as a set of nodes,
which can be monitored and accessed by OPC-UA clients. A modiﬁcation of these nodes, due to the
execution of a recipe formula, results in changes in the behavior of physical elements. Recipe formulas
are transfered from the coordination layer to subsystems that can execute them. To do that, the coordi-
nation layer must know the subsystem capabilities. OPC-UA supports the deﬁnition of Proﬁles, which
describes the supported features by an OPC-UA compliant product. Mandatory features that must be
supported by clients and servers are deﬁned in proﬁles, along with other non-required functionalities that
are negotiated between entities. Currently, the OPC Foundation has published more than 60 OPC-UA
proﬁles [19].

Figure 6 describes an interaction diagram of the use case ’Invoking a simple control recipe’. The
diagram reﬂects the interaction between Coordination layer and Subsystems, which includes an OPC-
UA server and an OPC-UA client respectively. Subsystems must discover supported proﬁles by getting
the server endpoints. Then, a secure communication channel is created with the server. A modiﬁcation
of a property in a subsystem device (such as opening a valve) is transmitted through the C-S interface
using the OPC Get Node Attributes command, to retrieve the name, type, description and permissions
(read and/or write) of the node, and ﬁnally, using the OPC write command to change the node value.

15

ControlRecipeRecipeIDHeaderRecipeTypeProceduralIDEntityIDFormulaStartDateMonitoringIrrigationHydrant	  CoordinationOPC-UA ServerOPC-UA ClientSubsystem controllerinvoke ControlRecipediscovery: getEndpointsCreateSecureChannel()Coordination-Subsystems interfaceEndpointDescription[]Get Node AttributesSet S1.valve1 to OPENWrite (nodepath,value)Set valve#1 to OPENSubsystem 1resultdataChange(nodepath,value,status)DONEAn IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

When the change is performed in the physical system (e.g. a valve is opened), the element responds with
a dataChange event that is delivered to the Coordination layer, with the result of the action.

4.4 A simple Use Case

In this Section we illustrate by the use of a simple example how MEGA can be used. We describe a
simple but realistic scenario, we show how the data are deﬁned for loading into MEGA, and ﬁnally we
outline how MEGA performs the process control.

1. Scenario description

The proposed scenario contains “a single subsystem with a hydrant and a water deposit that pro-
vides water to the system”. Figure 7.A shows the scenario schema.

Figure 7: Physical Model

For such Hydraulic Network we want to deﬁne the next process, direct expressed by the farmer:
“to irrigate the 27th of September at 12.00 ﬁnishing at 12:30 and using 800 liters as maximum
volume”.

2. Deﬁnition of the Physical Model

Based on the real equipment described on Figure 7.A the next step is the deﬁnition of the Physical
Model according to MEGA speciﬁcations. Figure 7.B depicts the component identiﬁcation, and
Figure 7.C describes the physical model for this use case. MEGA does not deﬁne any standard
procedure for loading the physical model into MEGA System. The table of Figure 8 is elaborated
from Figure 7.C and loaded into the Coordination Layer.

Figure 8: Physical Model loaded into the Coordination Layer

16

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.5 Deﬁnition of the Master recipe
As described in Section 4.2 MEGA requires the deﬁnition of a Master recipe. The translation of the
informal process to a semi-formal recipe is as follows:

• It is required to execute the process Irrigation recipe 1 over the simple hydrant HYS01
• Starting time for initiating the execution of the recipe: 27th of October of 2013, at 12:00
• End of the execution of the recipe: 27th of October of 2013, at 12:30
• Max water used for irrigation: 800 liters
MEGA does not specify how to deﬁne the recipes. In our case, the following elements apply:
• The target entity for the recipe is: WMD01.IRS01.DNT01.NBU01.HYS02
• The conditions that apply to this recipe are:

– StartDate (201312011200) according to ISO8601
– Two conditions for ﬁnishing:
∗ MaxVolume − > 0.8(m3)
∗ MaxDuration − > 1800(seg.)

In order to illustrate how a water management procedure recipe looks like Figure 9 presents the XML

description of the example of Master recipe given above.

Figure 9: Operation Process over a single Entity

The ﬁnal element to be loaded into the MEGA system is the Master Recipe, which encloses the
process deﬁned in Figure 9 into several “administrative” envelops, which detailed description is beyond
the scope of this paper.

The Master recipe is transferred to the Coordination Level, where the following functions are per-

formed:

17

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

1. Identiﬁers Mapping: Identiﬁers of the Master recipe are mapped into identiﬁer of the subsys-
tems. The identiﬁers mapping algorithm is not deﬁned by MEGA, neither current version of OPC
UA. In MEGA this functionality is left for manual or semiautomatic implementation according to
developer’s preferences. Currently there is an initiative of OPC UA standardization in order to be
able to support automatic identiﬁcation of entities with OPC UA, we expect that next version of
MEGA can incorporate this enhancement.

2. Recipe validation: The validation of the recipe sent by the Management and Exploitation Layer
requires to check that the corresponding subsystem is able to execute the process contained in this
Recipe. MEGA deﬁnes a procedure for deciding when it is not going to be concurrency problems
related to the assignation of more than one process to the same entity at the same time period. In
our simple scenario HYSO1 does not have any other process assigned for execution, so there is
not any scheduling problem.

3. Process transfer to the suitable subsystem: The process to be executed for each entity is going to
be transferred to the subsystem where the entity is located, and alarms and values can be monitored
from the Control Application using standard mechanisms of OPC UA. In this case there is no
alarms or values to be monitored.

4. Control and monitoring of the process execution: The transferred process is monitored from
the Control application, while the process is autonomously executed at the subsystem level. The
Coordination Layer provides information to the Management and Exploitation Layer about the
execution of each Recipe.

4.6 Water management scenario description

Scenarios for water management consider natural environments, cities and rural regions. Systems de-
ployed in these scenarios are controlled by applications that access to subsystems. It is necessary to
consider various conditions, ranging from the number of subsystems to be deployed to the business mod-
els that must be considered for subsystem control, exploitation services and information exchange. This
Section describes the deployment scenario we have deﬁned for validating the MEGA model, that is de-
veloped in Aula Dei, an experimental station in Zaragoza, Spain. We also enumerate the list of functions
that we are going to test in this station.

The Aula Dei experimental station is focused in the water management cycle, speciﬁcally in irri-
gation. A complete irrigation system is modeled, from the water intake to the distribution to the latest
elements (i.e. hydrants). One irrigation system works by gravity and the other one works by artiﬁcial
pressure, to cover all the situations that can be presented in a real setting. From the point of view of the
automation and control elements, the execution of various procedures is allowed in the same hydraulic
element. Speciﬁcally, the installation is divided into:

1. Upper network with two water tanks at different levels and a lifting station with two pumps in

parallel and level control function.

2. Pressure network with automatic pumping station, three pumps in parallel. Two of them with
variable speed drive. The network is composed by 20 hydrants, grouped into 4 lines that return
water to the tank, closing the cycle.

3. Control center with the necessary computer equipment for proper control and installation, as well

as for conducting some tests over the management applications.

18

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4. Channel with regulation elements for downstream water, regulation gate for upstream water, mixed

regulation gate and ﬂow controlled regulation gate.

Figure 10: Deposit and three pumping stations in Aula Dei

Figure 11: Irrigation system in Aula Dei

Figure 10 shows the deposit and the three pumping stations that are installed in Aula Dei. Figure 11

shows the irrigation system composed by 20 hydrants and the corresponding regulation elements.
The following tests were performed to verify the proper operation of the installed equipment:
• Tests on remote systems, checking the correct operation of the installed equipment based on re-

quired settings. Also checking the interoperability between equipment and the control center.

19

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 3: OPC UA in the automation pyramid for MEGA

nologies according to the state of the art and the requirements imposed by such kind of systems. In the
water management process the equipment has to be deployed into an hostile environment (open air, bad
weather conditions, unattended or difﬁcult access equipment, etc.) Therefore it is a key issue for every
provider that their system is able to solve such difﬁculties even with speciﬁc interfaces.

3 Integrating IoT in water management

Contributing to solutions that integrate the Internet of Things paradigm into water management processes
can be beneﬁcial to address expected solutions. The rest of this Section describes the main beneﬁts of
adopting IoT and the IoT characteristics that are considered in the proposed MEGA model, considering
new advances on ICT technologies for creating feasible and commercial systems [9].

Mark Weiser deﬁned a ”Smart Environment” [10] as - the physical world that is richly and invisibly
interwoven with sensors, actuators, displays, and computational elements, embedded seamlessly in the
everyday objects of our lives, and connected through a continuous network. There are many research
works that contributes to solve various issues in Smart Environments, such as seamless access to re-
sources and devices [11], distributed service executions [12], social choice techniques [13], etc. Other
works explains how IoT is based on three paradigms - internet-oriented (middleware), things oriented
(sensors) and knowledge-oriented (semantics) [14]. Although this type of delineation is required due to
the interdisciplinary nature of the subject, the usefulness of IoT can be unleashed only in an application
domain where the three paradigms intersect.

3.1

IoT for Water Management

The provision of Internet of Things capabilities in water management scenarios can be achieved if we
consider some considerations from the business, social and technical point of view. Here we list the main
beneﬁts of providing IoT in water management scenarios:

Efﬁciency increase: water management companies and associations can use real-time operational
control to make smarter business decisions and reduce operating costs. They use real-time data from

11

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

sensors and actuators to monitor and improve water management infrastructures, making them more
efﬁcient, reducing energy costs and minimizing human intervention.

Cost savings: water management costs can be reduced through improved asset utilization, process
efﬁciencies and productivity. Customers and organizations can beneﬁt from improved asset utilization
(e.g., smart water irrigation units that eliminate manual operation) and service improvements (e.g., re-
mote monitoring of irrigation conditions)

Asset utilization: with improved tracking of assets (machinery, equipment, tools, etc.) using sensors
and connectivity, companies can beneﬁt from transparency and visibility into their assets and supply
chains. They can easily locate assets and run preventive maintenance on critical pieces of infrastructure
and machinery.

Productivity increase: Productivity is a critical parameter that affects the proﬁtability of any organi-
zation. IoT allows real-time control, new business models, process optimization, resource conservations,
service time reduction, and the capability to do all of this globally, reducing the mismatch of required vs.
available skills and improving labor efﬁciency.

Expansion of new and existing business models: IoT is beneﬁcial in any of the three deﬁned
layers. In the subsystem layer, IoT subsystems are able to execute processes and communicate using a
standard communication interface; in the coordination layer, it can be useful to enable SMEs to design
new coordination applications, with the purpose to orchestrate the management and exploitation layer
with the subsystem layers; and ﬁnally, in the management and exploitation layer, IoT identiﬁcation
capabilities contribute to provide tailored information services for an speciﬁc water distribution network
community.

As we explained before, IoT builds on three pillars [14]: Internet orientation, thing orientation, and
knowledge orientation. We link these pillars with the ability of objects to (i) be identiﬁable (anything
identiﬁes itself), (ii) communicate (anything communicates) and (iii) to interact (anything interacts),
either among themselves, building networks of interconnected objects, or with end-users or other entities
in the network. The proposed MEGA model considers these properties:

Internet-oriented: the proposed MEGA model identiﬁes three layers (see Figure. ??). These layers
are communicated with two web interfaces enabling the deﬁnition of a ﬂexible and scalable commu-
nication system for controlling the huge amount of subsystems to be required for a complete water
management system.

The Coordination and Management - Exploitation layers are deﬁned as Cloud services. IoT,
as a broader vision of the previous concept of machine-to-machine (M2M) communications, is gaining
support by current Cloud computing infrastructures, which begin to provide so called cloud-based IoT
solutions.

Furthermore, subsystem capabilities (i.e. sensing, actuating, computing and communication tech-
nologies) depend on the speciﬁc conditions of the scenarios in which they are deployed. A seamless
access to subsystems will require that the Subsystems layer includes homogenization through a large
diversity of communication paradigms and higher granularity, to deal with many communication
technologies.

Thing-oriented: Due to previous experiences of the development of systems for water management,
the most granular element to be accessible is the subsystem. It is expected higher granularity in the
coming years, as subsystems are composed by many devices and interrelations, as we describe in the
physical and process models of Section 4. These elements can be redeﬁned as Smart Objects, being
objects which are able to describe its own possible interactions. Smart Object may provide the following
information: Object properties (physical properties and a text description), behavior (different behaviors
based on state variables) and, also, interaction information (current state of dials, gauges, switches, etc.).
It is important to deﬁne how subsystems as smart object containers fulﬁlls the features identiﬁed by
[14] and [15]. Subsystems deﬁnes and provides object identiﬁcation, to do that they must incorporate

12

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Unique system identiﬁcation features. Also, they publish subsystem capabilities, as a list of functions
supported by them, considering the capabilities of integrating objects.

Knowledge-oriented: due to the large heterogeneity of subsystems for water management it is im-
portant to model the characteristics that these subsystems have in common, and their behavior. In this
work we provide a physical model, deﬁning the physical elements executing water management pro-
cesses in a hierarchical way, and also a process model, organizing the execution of particular processes
in water management subsystems. Based on these models, smart execution of water management pro-
cesses is supported through collaboration between subsystems and the Coordination layer, based on the
interchange of information among them (see Figure. 3). Thanks to knowledge provision systems can be
monitored to facilitate public entities tracking the fulﬁllment of regulations. Information to be moni-
tored is autonomously provided by the subsystems based on sensor capabilities. These models can be
enriched with semantics to describe, share, and integrate information, inferring new knowledge related
to water management and irrigation processes. Semantics also helps to create machine-interpretable and
self-descriptive data in the IoT domain. Semantic descriptions can support data integration by enabling
interoperability between different data sources (sensors, devices); however, analysis and mapping be-
tween different semantic description models is still required to facilitate the IoT data integration with
other existing domain knowledge.

4 Reference model for smart water management

This Section describes the water management model that is being developed. This model consist of three
main elements, the Water Management Model, Common Communication Interface and Coordination-
Subsystems (C-S) Interface.

4.1 Water Management Model

The water management model includes the physical model and the process model.

The physical model follows standards EN 61512 [16] and EN 62264 [17]. As proposed by EN 61512
a layered structure is deﬁned and represented in Figure 4. The three upper layers (Company, Location
and Area) are modeled as in EN62264, representing companies organization. The Process Cell and Unit
represent entities in which processes are executed. Examples of process cells and units are an Irrigation
Sector and a Pump Management Station (PMS) respectively. Finally, the Equipment Module and Control
Module are elements belonging to the subsystem and can not be directly accessed by the Coordination
layer. Due to the current advance in the state of the art in IoT these elements will become Smart Elements
in a future and they will be directly identiﬁed and accessed. Hydrants, ﬁltering stations and pumping lines
are examples of equipment modules. Valves engines and meters are examples of control modules.

The process model organizes the execution of particular processes in water management subsystems,
following a predeﬁned strategy. Examples of processes are irrigation, tank ﬁlling, or water consumption
measurements. The process model identiﬁes the Procedure, as the basic element to be executed by
the Process Cell. Procedures are composed by Unit Procedures, as the basic element to be executed
by one unit, and ﬁnally, the Operations, as atomic instructions executed inside units. For example, an
atomic instruction to be executed in a pump management station can be to execute a periodic cleaning
process to optimize the performance of the station. The deﬁnitions of elements and operations in the
physical model and process model respectively enable the operation and remote management of water
management elements, as REQ #1 demands

13

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.2 Common Communication Interface

The Common Communication interface is composed by a set of web services that are consumed by
applications belonging to the Management - Exploitation layer, in order to operate on entities deﬁned by
the physical model, identify the current state of the systems and also send water management operations
to control the water consume.

Figure 4: Layers of the physical and process models

The Common Communication interface handles messages from the business processes (GIS-based
applications, services providing information about soils, meteorology, as REQ #2 demands), in XML
format, and transforms them to ISA-95/88-compliant OPC UA information models. OPC UA (IEC
62541) is an industry driven standard which provides uniﬁed communication and interaction means for
Service Oriented Architectures and Web Services. It is often used to implement different proﬁles for
automation systems [18] such as home and industrial automation and also water management systems.
OPC UA contributes to fulﬁll REQ #3, as it enables the integration of different systems based on speciﬁc
technologies.

OPC UA deﬁnes an information model that enables the creation of device instances and device types.
We implemented the physical model in OPC UA deﬁning control messages in the Management - Ex-
ploitation layer, and enabling the execution of these messages in the Coordination layer. In order to be
compliant to ISA-9588, we deﬁne recipes, which specify the sequence of activities in the form of pro-
cedural steps. Thus, control messages contain recipes that will be executed in the subsystems, by the
physical components located inside. Using recipes becomes the solution to manage subsystem elements,
which are not directly accessible by the Coordination layer, as the sequence of activities to be performed
must be decoupled from the speciﬁc technology in the subsystems, as REQ #4 demands.

There can be some problems if more that one recipe is executed on the same entity at the same time.
To solve that we deﬁne recipes with execution restrictions, which prevent multiple recipe executions
over the same physical element. To check which elements are used by a recipe the Coordination layer
retrieves the list of operations to be done by the recipe and gets the identiﬁers of the process cells and
units which perform these operations. If any of these process cells and units are used by other recipe that
must be executed at the same time the coordination layer ﬁnds an incompatibility, which must be solved
in the Management - Exploitation layer by user intervention.

Figure 5 describes the deﬁned model for recipes. The control recipe has a RecipeID that uniquely
identiﬁes it. Also, it Header identiﬁes the procedure in which the recipe is included with the Procedu-
ralID, and the type of recipe to execute (RecipeType). The Formula includes the set of actions to be
performed over the entity EntityID. Depending on the recipe type, the formula applies to either the ac-
tive elements (monitoring recipe), irrigation elements (irrigation recipe), hydrants of the entity (hydrant

14

Location Area Process Cell Unit Equipment Module Control Module Company Physical Model Process Design Loading Monitoring Checking Validating Process Execution Operations Procedure Unit Procedure An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 5: Control recipe model

recipe), etc.

4.3 Coordination-Subsystems interface

The Coordination-Subsystems (C-S) interface exchanges OPC-UA messages between the Coordination
layer and the Subsystems.

Figure 6: Invoking a simple control recipe

This interface considers the water management elements (Units, Process Cells, etc) as a set of nodes,
which can be monitored and accessed by OPC-UA clients. A modiﬁcation of these nodes, due to the
execution of a recipe formula, results in changes in the behavior of physical elements. Recipe formulas
are transfered from the coordination layer to subsystems that can execute them. To do that, the coordi-
nation layer must know the subsystem capabilities. OPC-UA supports the deﬁnition of Proﬁles, which
describes the supported features by an OPC-UA compliant product. Mandatory features that must be
supported by clients and servers are deﬁned in proﬁles, along with other non-required functionalities that
are negotiated between entities. Currently, the OPC Foundation has published more than 60 OPC-UA
proﬁles [19].

Figure 6 describes an interaction diagram of the use case ’Invoking a simple control recipe’. The
diagram reﬂects the interaction between Coordination layer and Subsystems, which includes an OPC-
UA server and an OPC-UA client respectively. Subsystems must discover supported proﬁles by getting
the server endpoints. Then, a secure communication channel is created with the server. A modiﬁcation
of a property in a subsystem device (such as opening a valve) is transmitted through the C-S interface
using the OPC Get Node Attributes command, to retrieve the name, type, description and permissions
(read and/or write) of the node, and ﬁnally, using the OPC write command to change the node value.

15

ControlRecipeRecipeIDHeaderRecipeTypeProceduralIDEntityIDFormulaStartDateMonitoringIrrigationHydrant	  CoordinationOPC-UA ServerOPC-UA ClientSubsystem controllerinvoke ControlRecipediscovery: getEndpointsCreateSecureChannel()Coordination-Subsystems interfaceEndpointDescription[]Get Node AttributesSet S1.valve1 to OPENWrite (nodepath,value)Set valve#1 to OPENSubsystem 1resultdataChange(nodepath,value,status)DONEAn IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

When the change is performed in the physical system (e.g. a valve is opened), the element responds with
a dataChange event that is delivered to the Coordination layer, with the result of the action.

4.4 A simple Use Case

In this Section we illustrate by the use of a simple example how MEGA can be used. We describe a
simple but realistic scenario, we show how the data are deﬁned for loading into MEGA, and ﬁnally we
outline how MEGA performs the process control.

1. Scenario description

The proposed scenario contains “a single subsystem with a hydrant and a water deposit that pro-
vides water to the system”. Figure 7.A shows the scenario schema.

Figure 7: Physical Model

For such Hydraulic Network we want to deﬁne the next process, direct expressed by the farmer:
“to irrigate the 27th of September at 12.00 ﬁnishing at 12:30 and using 800 liters as maximum
volume”.

2. Deﬁnition of the Physical Model

Based on the real equipment described on Figure 7.A the next step is the deﬁnition of the Physical
Model according to MEGA speciﬁcations. Figure 7.B depicts the component identiﬁcation, and
Figure 7.C describes the physical model for this use case. MEGA does not deﬁne any standard
procedure for loading the physical model into MEGA System. The table of Figure 8 is elaborated
from Figure 7.C and loaded into the Coordination Layer.

Figure 8: Physical Model loaded into the Coordination Layer

16

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.5 Deﬁnition of the Master recipe
As described in Section 4.2 MEGA requires the deﬁnition of a Master recipe. The translation of the
informal process to a semi-formal recipe is as follows:

• It is required to execute the process Irrigation recipe 1 over the simple hydrant HYS01
• Starting time for initiating the execution of the recipe: 27th of October of 2013, at 12:00
• End of the execution of the recipe: 27th of October of 2013, at 12:30
• Max water used for irrigation: 800 liters
MEGA does not specify how to deﬁne the recipes. In our case, the following elements apply:
• The target entity for the recipe is: WMD01.IRS01.DNT01.NBU01.HYS02
• The conditions that apply to this recipe are:

– StartDate (201312011200) according to ISO8601
– Two conditions for ﬁnishing:
∗ MaxVolume − > 0.8(m3)
∗ MaxDuration − > 1800(seg.)

In order to illustrate how a water management procedure recipe looks like Figure 9 presents the XML

description of the example of Master recipe given above.

Figure 9: Operation Process over a single Entity

The ﬁnal element to be loaded into the MEGA system is the Master Recipe, which encloses the
process deﬁned in Figure 9 into several “administrative” envelops, which detailed description is beyond
the scope of this paper.

The Master recipe is transferred to the Coordination Level, where the following functions are per-

formed:

17

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

1. Identiﬁers Mapping: Identiﬁers of the Master recipe are mapped into identiﬁer of the subsys-
tems. The identiﬁers mapping algorithm is not deﬁned by MEGA, neither current version of OPC
UA. In MEGA this functionality is left for manual or semiautomatic implementation according to
developer’s preferences. Currently there is an initiative of OPC UA standardization in order to be
able to support automatic identiﬁcation of entities with OPC UA, we expect that next version of
MEGA can incorporate this enhancement.

2. Recipe validation: The validation of the recipe sent by the Management and Exploitation Layer
requires to check that the corresponding subsystem is able to execute the process contained in this
Recipe. MEGA deﬁnes a procedure for deciding when it is not going to be concurrency problems
related to the assignation of more than one process to the same entity at the same time period. In
our simple scenario HYSO1 does not have any other process assigned for execution, so there is
not any scheduling problem.

3. Process transfer to the suitable subsystem: The process to be executed for each entity is going to
be transferred to the subsystem where the entity is located, and alarms and values can be monitored
from the Control Application using standard mechanisms of OPC UA. In this case there is no
alarms or values to be monitored.

4. Control and monitoring of the process execution: The transferred process is monitored from
the Control application, while the process is autonomously executed at the subsystem level. The
Coordination Layer provides information to the Management and Exploitation Layer about the
execution of each Recipe.

4.6 Water management scenario description

Scenarios for water management consider natural environments, cities and rural regions. Systems de-
ployed in these scenarios are controlled by applications that access to subsystems. It is necessary to
consider various conditions, ranging from the number of subsystems to be deployed to the business mod-
els that must be considered for subsystem control, exploitation services and information exchange. This
Section describes the deployment scenario we have deﬁned for validating the MEGA model, that is de-
veloped in Aula Dei, an experimental station in Zaragoza, Spain. We also enumerate the list of functions
that we are going to test in this station.

The Aula Dei experimental station is focused in the water management cycle, speciﬁcally in irri-
gation. A complete irrigation system is modeled, from the water intake to the distribution to the latest
elements (i.e. hydrants). One irrigation system works by gravity and the other one works by artiﬁcial
pressure, to cover all the situations that can be presented in a real setting. From the point of view of the
automation and control elements, the execution of various procedures is allowed in the same hydraulic
element. Speciﬁcally, the installation is divided into:

1. Upper network with two water tanks at different levels and a lifting station with two pumps in

parallel and level control function.

2. Pressure network with automatic pumping station, three pumps in parallel. Two of them with
variable speed drive. The network is composed by 20 hydrants, grouped into 4 lines that return
water to the tank, closing the cycle.

3. Control center with the necessary computer equipment for proper control and installation, as well

as for conducting some tests over the management applications.

18

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4. Channel with regulation elements for downstream water, regulation gate for upstream water, mixed

regulation gate and ﬂow controlled regulation gate.

Figure 10: Deposit and three pumping stations in Aula Dei

Figure 11: Irrigation system in Aula Dei

Figure 10 shows the deposit and the three pumping stations that are installed in Aula Dei. Figure 11

shows the irrigation system composed by 20 hydrants and the corresponding regulation elements.
The following tests were performed to verify the proper operation of the installed equipment:
• Tests on remote systems, checking the correct operation of the installed equipment based on re-

quired settings. Also checking the interoperability between equipment and the control center.

19

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

• Water regulation ﬂow tests, checking the optimal functioning of various control algorithms, both in
pumping stations operating in conjunction with tanks and in regulation control points for hydrants.
• Tests on management applications, checking the correct operation and interoperability with the
installed systems. Multiple computers are installed in order to perform parallel tests to check
equipment coordination and detect interferences.

We enumerate a list of functions that we are going to test in the described scenario:
• Loading and conﬁguration of the elements of the physical model. Mapping of hydraulic entities
and association to subsystem controllers. Monitoring and listing of the elements of the physical
model registered in the Coordination layer.

• Collection and consolidation of data from subsystems. Subsystem coordination and data integra-

tion, i.e. integration of hydrants’ aggregated data for branch surveillance.

• Execution of control recipes in virtual entities, assigning to associated subsystem the correspond-

ing actions. Creation of normalized history registries for virtual entities.

• Reception, interpretation, allocation and delivery of elements from the process model. Monitoring

and listing of these elements.

• Storage, publication, and distribution of the hydraulic topology to applications that require it.
Storage and publication of sensor data (weather conditions, humidity, temperature) collected by
legacy subsystems, adapted to the MEGA model.

5 Conclusions and Future Work

Water management impacts on several key matters of human lives and several scenarios, such as cities,
natural areas, agriculture, etc. Some works focus in the lack of ICT services and tools for water manage-
ment, which would enable information reuse (goal of the PSI Directive [20]), easier fulﬁllment of policy
regulations and resource monitoring.

In this paper we presented the MEGA initiative for deﬁning a reference architecture for water man-
agement based on integrating IoT capabilities to achieve a scalable and feasible industrial system. We
deﬁne the management exploitation layer, coordination layer, subsystems layer and administration layer
and the interfaces that enable layer interaction. We also consider the physical model, which deﬁnes the
physical elements executing water management processes in a hierarchical way, and also, the process
model, which organizes the execution of particular processes in water management subsystems.

Processes are deﬁned based on automation principles and using the widely used standard OPC UA.
We illustrate how such architecture can be used for controlling real water management systems, but still
we need to clearly deﬁne operation procedures for dealing with many real problems such as physical
network deﬁnition or identiﬁers mapping.

Finally, we describe the deployment scenario we have deﬁned for validation the MEGA model,
developed in Aula Dei, an experimental station on Zaragoza, enumerating the list of functions that we
are going to test in this station.

We can conclude that the adoption of IoT and OPC UA facilitates water management companies the
access to a wider global market and incorporates new beneﬁts to decisions support systems, monitoring,
water governance and also water-energy nexus. Future work will describe the performed test and will
focus on the contribution to solve coordination problems when executing multiple recipes over the same
physical resources, considering priority and conditional executions and also process optimization.

20

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 3: OPC UA in the automation pyramid for MEGA

nologies according to the state of the art and the requirements imposed by such kind of systems. In the
water management process the equipment has to be deployed into an hostile environment (open air, bad
weather conditions, unattended or difﬁcult access equipment, etc.) Therefore it is a key issue for every
provider that their system is able to solve such difﬁculties even with speciﬁc interfaces.

3 Integrating IoT in water management

Contributing to solutions that integrate the Internet of Things paradigm into water management processes
can be beneﬁcial to address expected solutions. The rest of this Section describes the main beneﬁts of
adopting IoT and the IoT characteristics that are considered in the proposed MEGA model, considering
new advances on ICT technologies for creating feasible and commercial systems [9].

Mark Weiser deﬁned a ”Smart Environment” [10] as - the physical world that is richly and invisibly
interwoven with sensors, actuators, displays, and computational elements, embedded seamlessly in the
everyday objects of our lives, and connected through a continuous network. There are many research
works that contributes to solve various issues in Smart Environments, such as seamless access to re-
sources and devices [11], distributed service executions [12], social choice techniques [13], etc. Other
works explains how IoT is based on three paradigms - internet-oriented (middleware), things oriented
(sensors) and knowledge-oriented (semantics) [14]. Although this type of delineation is required due to
the interdisciplinary nature of the subject, the usefulness of IoT can be unleashed only in an application
domain where the three paradigms intersect.

3.1

IoT for Water Management

The provision of Internet of Things capabilities in water management scenarios can be achieved if we
consider some considerations from the business, social and technical point of view. Here we list the main
beneﬁts of providing IoT in water management scenarios:

Efﬁciency increase: water management companies and associations can use real-time operational
control to make smarter business decisions and reduce operating costs. They use real-time data from

11

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

sensors and actuators to monitor and improve water management infrastructures, making them more
efﬁcient, reducing energy costs and minimizing human intervention.

Cost savings: water management costs can be reduced through improved asset utilization, process
efﬁciencies and productivity. Customers and organizations can beneﬁt from improved asset utilization
(e.g., smart water irrigation units that eliminate manual operation) and service improvements (e.g., re-
mote monitoring of irrigation conditions)

Asset utilization: with improved tracking of assets (machinery, equipment, tools, etc.) using sensors
and connectivity, companies can beneﬁt from transparency and visibility into their assets and supply
chains. They can easily locate assets and run preventive maintenance on critical pieces of infrastructure
and machinery.

Productivity increase: Productivity is a critical parameter that affects the proﬁtability of any organi-
zation. IoT allows real-time control, new business models, process optimization, resource conservations,
service time reduction, and the capability to do all of this globally, reducing the mismatch of required vs.
available skills and improving labor efﬁciency.

Expansion of new and existing business models: IoT is beneﬁcial in any of the three deﬁned
layers. In the subsystem layer, IoT subsystems are able to execute processes and communicate using a
standard communication interface; in the coordination layer, it can be useful to enable SMEs to design
new coordination applications, with the purpose to orchestrate the management and exploitation layer
with the subsystem layers; and ﬁnally, in the management and exploitation layer, IoT identiﬁcation
capabilities contribute to provide tailored information services for an speciﬁc water distribution network
community.

As we explained before, IoT builds on three pillars [14]: Internet orientation, thing orientation, and
knowledge orientation. We link these pillars with the ability of objects to (i) be identiﬁable (anything
identiﬁes itself), (ii) communicate (anything communicates) and (iii) to interact (anything interacts),
either among themselves, building networks of interconnected objects, or with end-users or other entities
in the network. The proposed MEGA model considers these properties:

Internet-oriented: the proposed MEGA model identiﬁes three layers (see Figure. ??). These layers
are communicated with two web interfaces enabling the deﬁnition of a ﬂexible and scalable commu-
nication system for controlling the huge amount of subsystems to be required for a complete water
management system.

The Coordination and Management - Exploitation layers are deﬁned as Cloud services. IoT,
as a broader vision of the previous concept of machine-to-machine (M2M) communications, is gaining
support by current Cloud computing infrastructures, which begin to provide so called cloud-based IoT
solutions.

Furthermore, subsystem capabilities (i.e. sensing, actuating, computing and communication tech-
nologies) depend on the speciﬁc conditions of the scenarios in which they are deployed. A seamless
access to subsystems will require that the Subsystems layer includes homogenization through a large
diversity of communication paradigms and higher granularity, to deal with many communication
technologies.

Thing-oriented: Due to previous experiences of the development of systems for water management,
the most granular element to be accessible is the subsystem. It is expected higher granularity in the
coming years, as subsystems are composed by many devices and interrelations, as we describe in the
physical and process models of Section 4. These elements can be redeﬁned as Smart Objects, being
objects which are able to describe its own possible interactions. Smart Object may provide the following
information: Object properties (physical properties and a text description), behavior (different behaviors
based on state variables) and, also, interaction information (current state of dials, gauges, switches, etc.).
It is important to deﬁne how subsystems as smart object containers fulﬁlls the features identiﬁed by
[14] and [15]. Subsystems deﬁnes and provides object identiﬁcation, to do that they must incorporate

12

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Unique system identiﬁcation features. Also, they publish subsystem capabilities, as a list of functions
supported by them, considering the capabilities of integrating objects.

Knowledge-oriented: due to the large heterogeneity of subsystems for water management it is im-
portant to model the characteristics that these subsystems have in common, and their behavior. In this
work we provide a physical model, deﬁning the physical elements executing water management pro-
cesses in a hierarchical way, and also a process model, organizing the execution of particular processes
in water management subsystems. Based on these models, smart execution of water management pro-
cesses is supported through collaboration between subsystems and the Coordination layer, based on the
interchange of information among them (see Figure. 3). Thanks to knowledge provision systems can be
monitored to facilitate public entities tracking the fulﬁllment of regulations. Information to be moni-
tored is autonomously provided by the subsystems based on sensor capabilities. These models can be
enriched with semantics to describe, share, and integrate information, inferring new knowledge related
to water management and irrigation processes. Semantics also helps to create machine-interpretable and
self-descriptive data in the IoT domain. Semantic descriptions can support data integration by enabling
interoperability between different data sources (sensors, devices); however, analysis and mapping be-
tween different semantic description models is still required to facilitate the IoT data integration with
other existing domain knowledge.

4 Reference model for smart water management

This Section describes the water management model that is being developed. This model consist of three
main elements, the Water Management Model, Common Communication Interface and Coordination-
Subsystems (C-S) Interface.

4.1 Water Management Model

The water management model includes the physical model and the process model.

The physical model follows standards EN 61512 [16] and EN 62264 [17]. As proposed by EN 61512
a layered structure is deﬁned and represented in Figure 4. The three upper layers (Company, Location
and Area) are modeled as in EN62264, representing companies organization. The Process Cell and Unit
represent entities in which processes are executed. Examples of process cells and units are an Irrigation
Sector and a Pump Management Station (PMS) respectively. Finally, the Equipment Module and Control
Module are elements belonging to the subsystem and can not be directly accessed by the Coordination
layer. Due to the current advance in the state of the art in IoT these elements will become Smart Elements
in a future and they will be directly identiﬁed and accessed. Hydrants, ﬁltering stations and pumping lines
are examples of equipment modules. Valves engines and meters are examples of control modules.

The process model organizes the execution of particular processes in water management subsystems,
following a predeﬁned strategy. Examples of processes are irrigation, tank ﬁlling, or water consumption
measurements. The process model identiﬁes the Procedure, as the basic element to be executed by
the Process Cell. Procedures are composed by Unit Procedures, as the basic element to be executed
by one unit, and ﬁnally, the Operations, as atomic instructions executed inside units. For example, an
atomic instruction to be executed in a pump management station can be to execute a periodic cleaning
process to optimize the performance of the station. The deﬁnitions of elements and operations in the
physical model and process model respectively enable the operation and remote management of water
management elements, as REQ #1 demands

13

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.2 Common Communication Interface

The Common Communication interface is composed by a set of web services that are consumed by
applications belonging to the Management - Exploitation layer, in order to operate on entities deﬁned by
the physical model, identify the current state of the systems and also send water management operations
to control the water consume.

Figure 4: Layers of the physical and process models

The Common Communication interface handles messages from the business processes (GIS-based
applications, services providing information about soils, meteorology, as REQ #2 demands), in XML
format, and transforms them to ISA-95/88-compliant OPC UA information models. OPC UA (IEC
62541) is an industry driven standard which provides uniﬁed communication and interaction means for
Service Oriented Architectures and Web Services. It is often used to implement different proﬁles for
automation systems [18] such as home and industrial automation and also water management systems.
OPC UA contributes to fulﬁll REQ #3, as it enables the integration of different systems based on speciﬁc
technologies.

OPC UA deﬁnes an information model that enables the creation of device instances and device types.
We implemented the physical model in OPC UA deﬁning control messages in the Management - Ex-
ploitation layer, and enabling the execution of these messages in the Coordination layer. In order to be
compliant to ISA-9588, we deﬁne recipes, which specify the sequence of activities in the form of pro-
cedural steps. Thus, control messages contain recipes that will be executed in the subsystems, by the
physical components located inside. Using recipes becomes the solution to manage subsystem elements,
which are not directly accessible by the Coordination layer, as the sequence of activities to be performed
must be decoupled from the speciﬁc technology in the subsystems, as REQ #4 demands.

There can be some problems if more that one recipe is executed on the same entity at the same time.
To solve that we deﬁne recipes with execution restrictions, which prevent multiple recipe executions
over the same physical element. To check which elements are used by a recipe the Coordination layer
retrieves the list of operations to be done by the recipe and gets the identiﬁers of the process cells and
units which perform these operations. If any of these process cells and units are used by other recipe that
must be executed at the same time the coordination layer ﬁnds an incompatibility, which must be solved
in the Management - Exploitation layer by user intervention.

Figure 5 describes the deﬁned model for recipes. The control recipe has a RecipeID that uniquely
identiﬁes it. Also, it Header identiﬁes the procedure in which the recipe is included with the Procedu-
ralID, and the type of recipe to execute (RecipeType). The Formula includes the set of actions to be
performed over the entity EntityID. Depending on the recipe type, the formula applies to either the ac-
tive elements (monitoring recipe), irrigation elements (irrigation recipe), hydrants of the entity (hydrant

14

Location Area Process Cell Unit Equipment Module Control Module Company Physical Model Process Design Loading Monitoring Checking Validating Process Execution Operations Procedure Unit Procedure An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 5: Control recipe model

recipe), etc.

4.3 Coordination-Subsystems interface

The Coordination-Subsystems (C-S) interface exchanges OPC-UA messages between the Coordination
layer and the Subsystems.

Figure 6: Invoking a simple control recipe

This interface considers the water management elements (Units, Process Cells, etc) as a set of nodes,
which can be monitored and accessed by OPC-UA clients. A modiﬁcation of these nodes, due to the
execution of a recipe formula, results in changes in the behavior of physical elements. Recipe formulas
are transfered from the coordination layer to subsystems that can execute them. To do that, the coordi-
nation layer must know the subsystem capabilities. OPC-UA supports the deﬁnition of Proﬁles, which
describes the supported features by an OPC-UA compliant product. Mandatory features that must be
supported by clients and servers are deﬁned in proﬁles, along with other non-required functionalities that
are negotiated between entities. Currently, the OPC Foundation has published more than 60 OPC-UA
proﬁles [19].

Figure 6 describes an interaction diagram of the use case ’Invoking a simple control recipe’. The
diagram reﬂects the interaction between Coordination layer and Subsystems, which includes an OPC-
UA server and an OPC-UA client respectively. Subsystems must discover supported proﬁles by getting
the server endpoints. Then, a secure communication channel is created with the server. A modiﬁcation
of a property in a subsystem device (such as opening a valve) is transmitted through the C-S interface
using the OPC Get Node Attributes command, to retrieve the name, type, description and permissions
(read and/or write) of the node, and ﬁnally, using the OPC write command to change the node value.

15

ControlRecipeRecipeIDHeaderRecipeTypeProceduralIDEntityIDFormulaStartDateMonitoringIrrigationHydrant	  CoordinationOPC-UA ServerOPC-UA ClientSubsystem controllerinvoke ControlRecipediscovery: getEndpointsCreateSecureChannel()Coordination-Subsystems interfaceEndpointDescription[]Get Node AttributesSet S1.valve1 to OPENWrite (nodepath,value)Set valve#1 to OPENSubsystem 1resultdataChange(nodepath,value,status)DONEAn IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

When the change is performed in the physical system (e.g. a valve is opened), the element responds with
a dataChange event that is delivered to the Coordination layer, with the result of the action.

4.4 A simple Use Case

In this Section we illustrate by the use of a simple example how MEGA can be used. We describe a
simple but realistic scenario, we show how the data are deﬁned for loading into MEGA, and ﬁnally we
outline how MEGA performs the process control.

1. Scenario description

The proposed scenario contains “a single subsystem with a hydrant and a water deposit that pro-
vides water to the system”. Figure 7.A shows the scenario schema.

Figure 7: Physical Model

For such Hydraulic Network we want to deﬁne the next process, direct expressed by the farmer:
“to irrigate the 27th of September at 12.00 ﬁnishing at 12:30 and using 800 liters as maximum
volume”.

2. Deﬁnition of the Physical Model

Based on the real equipment described on Figure 7.A the next step is the deﬁnition of the Physical
Model according to MEGA speciﬁcations. Figure 7.B depicts the component identiﬁcation, and
Figure 7.C describes the physical model for this use case. MEGA does not deﬁne any standard
procedure for loading the physical model into MEGA System. The table of Figure 8 is elaborated
from Figure 7.C and loaded into the Coordination Layer.

Figure 8: Physical Model loaded into the Coordination Layer

16

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.5 Deﬁnition of the Master recipe
As described in Section 4.2 MEGA requires the deﬁnition of a Master recipe. The translation of the
informal process to a semi-formal recipe is as follows:

• It is required to execute the process Irrigation recipe 1 over the simple hydrant HYS01
• Starting time for initiating the execution of the recipe: 27th of October of 2013, at 12:00
• End of the execution of the recipe: 27th of October of 2013, at 12:30
• Max water used for irrigation: 800 liters
MEGA does not specify how to deﬁne the recipes. In our case, the following elements apply:
• The target entity for the recipe is: WMD01.IRS01.DNT01.NBU01.HYS02
• The conditions that apply to this recipe are:

– StartDate (201312011200) according to ISO8601
– Two conditions for ﬁnishing:
∗ MaxVolume − > 0.8(m3)
∗ MaxDuration − > 1800(seg.)

In order to illustrate how a water management procedure recipe looks like Figure 9 presents the XML

description of the example of Master recipe given above.

Figure 9: Operation Process over a single Entity

The ﬁnal element to be loaded into the MEGA system is the Master Recipe, which encloses the
process deﬁned in Figure 9 into several “administrative” envelops, which detailed description is beyond
the scope of this paper.

The Master recipe is transferred to the Coordination Level, where the following functions are per-

formed:

17

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

1. Identiﬁers Mapping: Identiﬁers of the Master recipe are mapped into identiﬁer of the subsys-
tems. The identiﬁers mapping algorithm is not deﬁned by MEGA, neither current version of OPC
UA. In MEGA this functionality is left for manual or semiautomatic implementation according to
developer’s preferences. Currently there is an initiative of OPC UA standardization in order to be
able to support automatic identiﬁcation of entities with OPC UA, we expect that next version of
MEGA can incorporate this enhancement.

2. Recipe validation: The validation of the recipe sent by the Management and Exploitation Layer
requires to check that the corresponding subsystem is able to execute the process contained in this
Recipe. MEGA deﬁnes a procedure for deciding when it is not going to be concurrency problems
related to the assignation of more than one process to the same entity at the same time period. In
our simple scenario HYSO1 does not have any other process assigned for execution, so there is
not any scheduling problem.

3. Process transfer to the suitable subsystem: The process to be executed for each entity is going to
be transferred to the subsystem where the entity is located, and alarms and values can be monitored
from the Control Application using standard mechanisms of OPC UA. In this case there is no
alarms or values to be monitored.

4. Control and monitoring of the process execution: The transferred process is monitored from
the Control application, while the process is autonomously executed at the subsystem level. The
Coordination Layer provides information to the Management and Exploitation Layer about the
execution of each Recipe.

4.6 Water management scenario description

Scenarios for water management consider natural environments, cities and rural regions. Systems de-
ployed in these scenarios are controlled by applications that access to subsystems. It is necessary to
consider various conditions, ranging from the number of subsystems to be deployed to the business mod-
els that must be considered for subsystem control, exploitation services and information exchange. This
Section describes the deployment scenario we have deﬁned for validating the MEGA model, that is de-
veloped in Aula Dei, an experimental station in Zaragoza, Spain. We also enumerate the list of functions
that we are going to test in this station.

The Aula Dei experimental station is focused in the water management cycle, speciﬁcally in irri-
gation. A complete irrigation system is modeled, from the water intake to the distribution to the latest
elements (i.e. hydrants). One irrigation system works by gravity and the other one works by artiﬁcial
pressure, to cover all the situations that can be presented in a real setting. From the point of view of the
automation and control elements, the execution of various procedures is allowed in the same hydraulic
element. Speciﬁcally, the installation is divided into:

1. Upper network with two water tanks at different levels and a lifting station with two pumps in

parallel and level control function.

2. Pressure network with automatic pumping station, three pumps in parallel. Two of them with
variable speed drive. The network is composed by 20 hydrants, grouped into 4 lines that return
water to the tank, closing the cycle.

3. Control center with the necessary computer equipment for proper control and installation, as well

as for conducting some tests over the management applications.

18

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4. Channel with regulation elements for downstream water, regulation gate for upstream water, mixed

regulation gate and ﬂow controlled regulation gate.

Figure 10: Deposit and three pumping stations in Aula Dei

Figure 11: Irrigation system in Aula Dei

Figure 10 shows the deposit and the three pumping stations that are installed in Aula Dei. Figure 11

shows the irrigation system composed by 20 hydrants and the corresponding regulation elements.
The following tests were performed to verify the proper operation of the installed equipment:
• Tests on remote systems, checking the correct operation of the installed equipment based on re-

quired settings. Also checking the interoperability between equipment and the control center.

19

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

• Water regulation ﬂow tests, checking the optimal functioning of various control algorithms, both in
pumping stations operating in conjunction with tanks and in regulation control points for hydrants.
• Tests on management applications, checking the correct operation and interoperability with the
installed systems. Multiple computers are installed in order to perform parallel tests to check
equipment coordination and detect interferences.

We enumerate a list of functions that we are going to test in the described scenario:
• Loading and conﬁguration of the elements of the physical model. Mapping of hydraulic entities
and association to subsystem controllers. Monitoring and listing of the elements of the physical
model registered in the Coordination layer.

• Collection and consolidation of data from subsystems. Subsystem coordination and data integra-

tion, i.e. integration of hydrants’ aggregated data for branch surveillance.

• Execution of control recipes in virtual entities, assigning to associated subsystem the correspond-

ing actions. Creation of normalized history registries for virtual entities.

• Reception, interpretation, allocation and delivery of elements from the process model. Monitoring

and listing of these elements.

• Storage, publication, and distribution of the hydraulic topology to applications that require it.
Storage and publication of sensor data (weather conditions, humidity, temperature) collected by
legacy subsystems, adapted to the MEGA model.

5 Conclusions and Future Work

Water management impacts on several key matters of human lives and several scenarios, such as cities,
natural areas, agriculture, etc. Some works focus in the lack of ICT services and tools for water manage-
ment, which would enable information reuse (goal of the PSI Directive [20]), easier fulﬁllment of policy
regulations and resource monitoring.

In this paper we presented the MEGA initiative for deﬁning a reference architecture for water man-
agement based on integrating IoT capabilities to achieve a scalable and feasible industrial system. We
deﬁne the management exploitation layer, coordination layer, subsystems layer and administration layer
and the interfaces that enable layer interaction. We also consider the physical model, which deﬁnes the
physical elements executing water management processes in a hierarchical way, and also, the process
model, which organizes the execution of particular processes in water management subsystems.

Processes are deﬁned based on automation principles and using the widely used standard OPC UA.
We illustrate how such architecture can be used for controlling real water management systems, but still
we need to clearly deﬁne operation procedures for dealing with many real problems such as physical
network deﬁnition or identiﬁers mapping.

Finally, we describe the deployment scenario we have deﬁned for validation the MEGA model,
developed in Aula Dei, an experimental station on Zaragoza, enumerating the list of functions that we
are going to test in this station.

We can conclude that the adoption of IoT and OPC UA facilitates water management companies the
access to a wider global market and incorporates new beneﬁts to decisions support systems, monitoring,
water governance and also water-energy nexus. Future work will describe the performed test and will
focus on the contribution to solve coordination problems when executing multiple recipes over the same
physical resources, considering priority and conditional executions and also process optimization.

20

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Acknowledgments

This work is partially supported by MEGA, a join research effort of Tragsa and UPM. It is also supported
by CALISTA project, TEC2012-32457, awarded by the Ministry of Economy and Competitiveness in
Spain.

References

[1] United Nations. Global Sustainable Development Report – Executive Summary: Building the Common Fu-
ture We Want. New York: United Nations Department of Economic and Social Affairs, Division for Sustain-
able Development. 2013. http://sustainabledevelopment.un.org/globalsdreport/, last viewed November 2014.
[2] T. Robles, R. Alcarria, D. Mart´ın, and A. Morales, “An Internet of Things-based model for smart water
management,” in Proc. of the 8th International Conference on Advanced Information Networking and Appli-
cations Workshops (WAINA’14), Victoria, Canada.

IEEE, May 2014, pp. 821–826.

[3] HollandTrade, homepage: http://www.hollandtrade.com/, last viewed November 2014, 2014.
[4] Association of Water Technologies, homepage: http://www.awt.org/, last viewed November 2014, 2014.
[5] EU Water Framework Directive (Directive 2000/60/EC), 2000.
[6] TRAGSA group home page: http://www.tragsa.es/en/, last viewed November 2014.
[7] MEGA project homepage: http://www.gestiondelagua.es/en/, last viewed November 2014.
[8] OPC homepage: https://opcfoundation.org, last viewed November 2014.
[9] J. Gubbi, R. Buyya, S. Marusic, and M. Palaniswami, “Building the common future we want,” United Nations

Department of Economic and Social Affairs, 2013.

[10] M. Weiser, R. Gold, and J. S. Brown, “The Origins of Ubiquitous Computing Research at PARC in the Late

1980s,” IBM Systems Journal, vol. 38, no. 4, pp. 693–696, December 1999.

[11] R. Alcarria, T. Robles, A. Morales, D. L. de Ipi˜na, and U. Aguilera, “Enabling ﬂexible and continuous
capability invocation in mobile prosumer environments,” Sensors, vol. 12, no. 7, pp. 8930–8954, June 2012.
[12] R. Alcarria, T. Robles, A. Morales, and E. Cede˜no, “Resolving coordination challenges in distributed mobile
service executions,” International Journal of Web and Grid Services, vol. 10, no. 2, pp. 168–191, January
2014.

[13] E. Serrano, P. Moncada, M. Garijo, and C. Iglesias, “Evaluating social choice techniques into intelligent
environments by agent based social simulation,” Information Sciences, vol. 286, pp. 102–124, December
2014.

[14] L. Atzori, A. Iera, and G. Morabito, “The Internet of Things: A survey,” Computer Networks, vol. 54, no. 15,

pp. 2787–2805, October 2010.

[15] D. Miorandi, S. Sicari, F. D. Pellegrini, and I. Chlamtac, “Internet of things: Vision, applications and research

challenges,” Ad Hoc Networks, vol. 10, no. 7, pp. 1497–1516, September 2012.

[16] AENOR EN 61512: Batch control – Part 2: Data structures and guidelines for languages, 2002.
[17] AENOR EN 62264: Enterprise-control system integration - Part 1: Models and terminology, 2013.
[18] M. Melik-Merkumians, T. Baier, M. Steinegger, W. Lepuschitz, I. Hegny, and A. Zoitl, “Towards OPC UA
as portable SOA middleware between control software and external added value applications,” in Proc. of
the 17th IEEE Conference on Emerging Technologies and Factory Automation (ETFA’12), Krak´ow, Poland.
IEEE, September 2012, pp. 1–8.

[19] J. Imtiaz and J. Jasperneite, “Scalability of OPC-UA down to the chip level enables Internet of Things,” in
Proc. of the 11th IEEE International Conference on Industrial Informatics (INDIN’13), Bochum, Germany.
IEEE, July 2013, pp. 500–505.

[20] PSI Directive (2003/98/EC). Directive on the re-use of public sector information entered into force on 31

December 2003, European Commission.

——————————————————————————

21

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 3: OPC UA in the automation pyramid for MEGA

nologies according to the state of the art and the requirements imposed by such kind of systems. In the
water management process the equipment has to be deployed into an hostile environment (open air, bad
weather conditions, unattended or difﬁcult access equipment, etc.) Therefore it is a key issue for every
provider that their system is able to solve such difﬁculties even with speciﬁc interfaces.

3 Integrating IoT in water management

Contributing to solutions that integrate the Internet of Things paradigm into water management processes
can be beneﬁcial to address expected solutions. The rest of this Section describes the main beneﬁts of
adopting IoT and the IoT characteristics that are considered in the proposed MEGA model, considering
new advances on ICT technologies for creating feasible and commercial systems [9].

Mark Weiser deﬁned a ”Smart Environment” [10] as - the physical world that is richly and invisibly
interwoven with sensors, actuators, displays, and computational elements, embedded seamlessly in the
everyday objects of our lives, and connected through a continuous network. There are many research
works that contributes to solve various issues in Smart Environments, such as seamless access to re-
sources and devices [11], distributed service executions [12], social choice techniques [13], etc. Other
works explains how IoT is based on three paradigms - internet-oriented (middleware), things oriented
(sensors) and knowledge-oriented (semantics) [14]. Although this type of delineation is required due to
the interdisciplinary nature of the subject, the usefulness of IoT can be unleashed only in an application
domain where the three paradigms intersect.

3.1

IoT for Water Management

The provision of Internet of Things capabilities in water management scenarios can be achieved if we
consider some considerations from the business, social and technical point of view. Here we list the main
beneﬁts of providing IoT in water management scenarios:

Efﬁciency increase: water management companies and associations can use real-time operational
control to make smarter business decisions and reduce operating costs. They use real-time data from

11

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

sensors and actuators to monitor and improve water management infrastructures, making them more
efﬁcient, reducing energy costs and minimizing human intervention.

Cost savings: water management costs can be reduced through improved asset utilization, process
efﬁciencies and productivity. Customers and organizations can beneﬁt from improved asset utilization
(e.g., smart water irrigation units that eliminate manual operation) and service improvements (e.g., re-
mote monitoring of irrigation conditions)

Asset utilization: with improved tracking of assets (machinery, equipment, tools, etc.) using sensors
and connectivity, companies can beneﬁt from transparency and visibility into their assets and supply
chains. They can easily locate assets and run preventive maintenance on critical pieces of infrastructure
and machinery.

Productivity increase: Productivity is a critical parameter that affects the proﬁtability of any organi-
zation. IoT allows real-time control, new business models, process optimization, resource conservations,
service time reduction, and the capability to do all of this globally, reducing the mismatch of required vs.
available skills and improving labor efﬁciency.

Expansion of new and existing business models: IoT is beneﬁcial in any of the three deﬁned
layers. In the subsystem layer, IoT subsystems are able to execute processes and communicate using a
standard communication interface; in the coordination layer, it can be useful to enable SMEs to design
new coordination applications, with the purpose to orchestrate the management and exploitation layer
with the subsystem layers; and ﬁnally, in the management and exploitation layer, IoT identiﬁcation
capabilities contribute to provide tailored information services for an speciﬁc water distribution network
community.

As we explained before, IoT builds on three pillars [14]: Internet orientation, thing orientation, and
knowledge orientation. We link these pillars with the ability of objects to (i) be identiﬁable (anything
identiﬁes itself), (ii) communicate (anything communicates) and (iii) to interact (anything interacts),
either among themselves, building networks of interconnected objects, or with end-users or other entities
in the network. The proposed MEGA model considers these properties:

Internet-oriented: the proposed MEGA model identiﬁes three layers (see Figure. ??). These layers
are communicated with two web interfaces enabling the deﬁnition of a ﬂexible and scalable commu-
nication system for controlling the huge amount of subsystems to be required for a complete water
management system.

The Coordination and Management - Exploitation layers are deﬁned as Cloud services. IoT,
as a broader vision of the previous concept of machine-to-machine (M2M) communications, is gaining
support by current Cloud computing infrastructures, which begin to provide so called cloud-based IoT
solutions.

Furthermore, subsystem capabilities (i.e. sensing, actuating, computing and communication tech-
nologies) depend on the speciﬁc conditions of the scenarios in which they are deployed. A seamless
access to subsystems will require that the Subsystems layer includes homogenization through a large
diversity of communication paradigms and higher granularity, to deal with many communication
technologies.

Thing-oriented: Due to previous experiences of the development of systems for water management,
the most granular element to be accessible is the subsystem. It is expected higher granularity in the
coming years, as subsystems are composed by many devices and interrelations, as we describe in the
physical and process models of Section 4. These elements can be redeﬁned as Smart Objects, being
objects which are able to describe its own possible interactions. Smart Object may provide the following
information: Object properties (physical properties and a text description), behavior (different behaviors
based on state variables) and, also, interaction information (current state of dials, gauges, switches, etc.).
It is important to deﬁne how subsystems as smart object containers fulﬁlls the features identiﬁed by
[14] and [15]. Subsystems deﬁnes and provides object identiﬁcation, to do that they must incorporate

12

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Unique system identiﬁcation features. Also, they publish subsystem capabilities, as a list of functions
supported by them, considering the capabilities of integrating objects.

Knowledge-oriented: due to the large heterogeneity of subsystems for water management it is im-
portant to model the characteristics that these subsystems have in common, and their behavior. In this
work we provide a physical model, deﬁning the physical elements executing water management pro-
cesses in a hierarchical way, and also a process model, organizing the execution of particular processes
in water management subsystems. Based on these models, smart execution of water management pro-
cesses is supported through collaboration between subsystems and the Coordination layer, based on the
interchange of information among them (see Figure. 3). Thanks to knowledge provision systems can be
monitored to facilitate public entities tracking the fulﬁllment of regulations. Information to be moni-
tored is autonomously provided by the subsystems based on sensor capabilities. These models can be
enriched with semantics to describe, share, and integrate information, inferring new knowledge related
to water management and irrigation processes. Semantics also helps to create machine-interpretable and
self-descriptive data in the IoT domain. Semantic descriptions can support data integration by enabling
interoperability between different data sources (sensors, devices); however, analysis and mapping be-
tween different semantic description models is still required to facilitate the IoT data integration with
other existing domain knowledge.

4 Reference model for smart water management

This Section describes the water management model that is being developed. This model consist of three
main elements, the Water Management Model, Common Communication Interface and Coordination-
Subsystems (C-S) Interface.

4.1 Water Management Model

The water management model includes the physical model and the process model.

The physical model follows standards EN 61512 [16] and EN 62264 [17]. As proposed by EN 61512
a layered structure is deﬁned and represented in Figure 4. The three upper layers (Company, Location
and Area) are modeled as in EN62264, representing companies organization. The Process Cell and Unit
represent entities in which processes are executed. Examples of process cells and units are an Irrigation
Sector and a Pump Management Station (PMS) respectively. Finally, the Equipment Module and Control
Module are elements belonging to the subsystem and can not be directly accessed by the Coordination
layer. Due to the current advance in the state of the art in IoT these elements will become Smart Elements
in a future and they will be directly identiﬁed and accessed. Hydrants, ﬁltering stations and pumping lines
are examples of equipment modules. Valves engines and meters are examples of control modules.

The process model organizes the execution of particular processes in water management subsystems,
following a predeﬁned strategy. Examples of processes are irrigation, tank ﬁlling, or water consumption
measurements. The process model identiﬁes the Procedure, as the basic element to be executed by
the Process Cell. Procedures are composed by Unit Procedures, as the basic element to be executed
by one unit, and ﬁnally, the Operations, as atomic instructions executed inside units. For example, an
atomic instruction to be executed in a pump management station can be to execute a periodic cleaning
process to optimize the performance of the station. The deﬁnitions of elements and operations in the
physical model and process model respectively enable the operation and remote management of water
management elements, as REQ #1 demands

13

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.2 Common Communication Interface

The Common Communication interface is composed by a set of web services that are consumed by
applications belonging to the Management - Exploitation layer, in order to operate on entities deﬁned by
the physical model, identify the current state of the systems and also send water management operations
to control the water consume.

Figure 4: Layers of the physical and process models

The Common Communication interface handles messages from the business processes (GIS-based
applications, services providing information about soils, meteorology, as REQ #2 demands), in XML
format, and transforms them to ISA-95/88-compliant OPC UA information models. OPC UA (IEC
62541) is an industry driven standard which provides uniﬁed communication and interaction means for
Service Oriented Architectures and Web Services. It is often used to implement different proﬁles for
automation systems [18] such as home and industrial automation and also water management systems.
OPC UA contributes to fulﬁll REQ #3, as it enables the integration of different systems based on speciﬁc
technologies.

OPC UA deﬁnes an information model that enables the creation of device instances and device types.
We implemented the physical model in OPC UA deﬁning control messages in the Management - Ex-
ploitation layer, and enabling the execution of these messages in the Coordination layer. In order to be
compliant to ISA-9588, we deﬁne recipes, which specify the sequence of activities in the form of pro-
cedural steps. Thus, control messages contain recipes that will be executed in the subsystems, by the
physical components located inside. Using recipes becomes the solution to manage subsystem elements,
which are not directly accessible by the Coordination layer, as the sequence of activities to be performed
must be decoupled from the speciﬁc technology in the subsystems, as REQ #4 demands.

There can be some problems if more that one recipe is executed on the same entity at the same time.
To solve that we deﬁne recipes with execution restrictions, which prevent multiple recipe executions
over the same physical element. To check which elements are used by a recipe the Coordination layer
retrieves the list of operations to be done by the recipe and gets the identiﬁers of the process cells and
units which perform these operations. If any of these process cells and units are used by other recipe that
must be executed at the same time the coordination layer ﬁnds an incompatibility, which must be solved
in the Management - Exploitation layer by user intervention.

Figure 5 describes the deﬁned model for recipes. The control recipe has a RecipeID that uniquely
identiﬁes it. Also, it Header identiﬁes the procedure in which the recipe is included with the Procedu-
ralID, and the type of recipe to execute (RecipeType). The Formula includes the set of actions to be
performed over the entity EntityID. Depending on the recipe type, the formula applies to either the ac-
tive elements (monitoring recipe), irrigation elements (irrigation recipe), hydrants of the entity (hydrant

14

Location Area Process Cell Unit Equipment Module Control Module Company Physical Model Process Design Loading Monitoring Checking Validating Process Execution Operations Procedure Unit Procedure An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 5: Control recipe model

recipe), etc.

4.3 Coordination-Subsystems interface

The Coordination-Subsystems (C-S) interface exchanges OPC-UA messages between the Coordination
layer and the Subsystems.

Figure 6: Invoking a simple control recipe

This interface considers the water management elements (Units, Process Cells, etc) as a set of nodes,
which can be monitored and accessed by OPC-UA clients. A modiﬁcation of these nodes, due to the
execution of a recipe formula, results in changes in the behavior of physical elements. Recipe formulas
are transfered from the coordination layer to subsystems that can execute them. To do that, the coordi-
nation layer must know the subsystem capabilities. OPC-UA supports the deﬁnition of Proﬁles, which
describes the supported features by an OPC-UA compliant product. Mandatory features that must be
supported by clients and servers are deﬁned in proﬁles, along with other non-required functionalities that
are negotiated between entities. Currently, the OPC Foundation has published more than 60 OPC-UA
proﬁles [19].

Figure 6 describes an interaction diagram of the use case ’Invoking a simple control recipe’. The
diagram reﬂects the interaction between Coordination layer and Subsystems, which includes an OPC-
UA server and an OPC-UA client respectively. Subsystems must discover supported proﬁles by getting
the server endpoints. Then, a secure communication channel is created with the server. A modiﬁcation
of a property in a subsystem device (such as opening a valve) is transmitted through the C-S interface
using the OPC Get Node Attributes command, to retrieve the name, type, description and permissions
(read and/or write) of the node, and ﬁnally, using the OPC write command to change the node value.

15

ControlRecipeRecipeIDHeaderRecipeTypeProceduralIDEntityIDFormulaStartDateMonitoringIrrigationHydrant	  CoordinationOPC-UA ServerOPC-UA ClientSubsystem controllerinvoke ControlRecipediscovery: getEndpointsCreateSecureChannel()Coordination-Subsystems interfaceEndpointDescription[]Get Node AttributesSet S1.valve1 to OPENWrite (nodepath,value)Set valve#1 to OPENSubsystem 1resultdataChange(nodepath,value,status)DONEAn IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

When the change is performed in the physical system (e.g. a valve is opened), the element responds with
a dataChange event that is delivered to the Coordination layer, with the result of the action.

4.4 A simple Use Case

In this Section we illustrate by the use of a simple example how MEGA can be used. We describe a
simple but realistic scenario, we show how the data are deﬁned for loading into MEGA, and ﬁnally we
outline how MEGA performs the process control.

1. Scenario description

The proposed scenario contains “a single subsystem with a hydrant and a water deposit that pro-
vides water to the system”. Figure 7.A shows the scenario schema.

Figure 7: Physical Model

For such Hydraulic Network we want to deﬁne the next process, direct expressed by the farmer:
“to irrigate the 27th of September at 12.00 ﬁnishing at 12:30 and using 800 liters as maximum
volume”.

2. Deﬁnition of the Physical Model

Based on the real equipment described on Figure 7.A the next step is the deﬁnition of the Physical
Model according to MEGA speciﬁcations. Figure 7.B depicts the component identiﬁcation, and
Figure 7.C describes the physical model for this use case. MEGA does not deﬁne any standard
procedure for loading the physical model into MEGA System. The table of Figure 8 is elaborated
from Figure 7.C and loaded into the Coordination Layer.

Figure 8: Physical Model loaded into the Coordination Layer

16

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.5 Deﬁnition of the Master recipe
As described in Section 4.2 MEGA requires the deﬁnition of a Master recipe. The translation of the
informal process to a semi-formal recipe is as follows:

• It is required to execute the process Irrigation recipe 1 over the simple hydrant HYS01
• Starting time for initiating the execution of the recipe: 27th of October of 2013, at 12:00
• End of the execution of the recipe: 27th of October of 2013, at 12:30
• Max water used for irrigation: 800 liters
MEGA does not specify how to deﬁne the recipes. In our case, the following elements apply:
• The target entity for the recipe is: WMD01.IRS01.DNT01.NBU01.HYS02
• The conditions that apply to this recipe are:

– StartDate (201312011200) according to ISO8601
– Two conditions for ﬁnishing:
∗ MaxVolume − > 0.8(m3)
∗ MaxDuration − > 1800(seg.)

In order to illustrate how a water management procedure recipe looks like Figure 9 presents the XML

description of the example of Master recipe given above.

Figure 9: Operation Process over a single Entity

The ﬁnal element to be loaded into the MEGA system is the Master Recipe, which encloses the
process deﬁned in Figure 9 into several “administrative” envelops, which detailed description is beyond
the scope of this paper.

The Master recipe is transferred to the Coordination Level, where the following functions are per-

formed:

17

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

1. Identiﬁers Mapping: Identiﬁers of the Master recipe are mapped into identiﬁer of the subsys-
tems. The identiﬁers mapping algorithm is not deﬁned by MEGA, neither current version of OPC
UA. In MEGA this functionality is left for manual or semiautomatic implementation according to
developer’s preferences. Currently there is an initiative of OPC UA standardization in order to be
able to support automatic identiﬁcation of entities with OPC UA, we expect that next version of
MEGA can incorporate this enhancement.

2. Recipe validation: The validation of the recipe sent by the Management and Exploitation Layer
requires to check that the corresponding subsystem is able to execute the process contained in this
Recipe. MEGA deﬁnes a procedure for deciding when it is not going to be concurrency problems
related to the assignation of more than one process to the same entity at the same time period. In
our simple scenario HYSO1 does not have any other process assigned for execution, so there is
not any scheduling problem.

3. Process transfer to the suitable subsystem: The process to be executed for each entity is going to
be transferred to the subsystem where the entity is located, and alarms and values can be monitored
from the Control Application using standard mechanisms of OPC UA. In this case there is no
alarms or values to be monitored.

4. Control and monitoring of the process execution: The transferred process is monitored from
the Control application, while the process is autonomously executed at the subsystem level. The
Coordination Layer provides information to the Management and Exploitation Layer about the
execution of each Recipe.

4.6 Water management scenario description

Scenarios for water management consider natural environments, cities and rural regions. Systems de-
ployed in these scenarios are controlled by applications that access to subsystems. It is necessary to
consider various conditions, ranging from the number of subsystems to be deployed to the business mod-
els that must be considered for subsystem control, exploitation services and information exchange. This
Section describes the deployment scenario we have deﬁned for validating the MEGA model, that is de-
veloped in Aula Dei, an experimental station in Zaragoza, Spain. We also enumerate the list of functions
that we are going to test in this station.

The Aula Dei experimental station is focused in the water management cycle, speciﬁcally in irri-
gation. A complete irrigation system is modeled, from the water intake to the distribution to the latest
elements (i.e. hydrants). One irrigation system works by gravity and the other one works by artiﬁcial
pressure, to cover all the situations that can be presented in a real setting. From the point of view of the
automation and control elements, the execution of various procedures is allowed in the same hydraulic
element. Speciﬁcally, the installation is divided into:

1. Upper network with two water tanks at different levels and a lifting station with two pumps in

parallel and level control function.

2. Pressure network with automatic pumping station, three pumps in parallel. Two of them with
variable speed drive. The network is composed by 20 hydrants, grouped into 4 lines that return
water to the tank, closing the cycle.

3. Control center with the necessary computer equipment for proper control and installation, as well

as for conducting some tests over the management applications.

18

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4. Channel with regulation elements for downstream water, regulation gate for upstream water, mixed

regulation gate and ﬂow controlled regulation gate.

Figure 10: Deposit and three pumping stations in Aula Dei

Figure 11: Irrigation system in Aula Dei

Figure 10 shows the deposit and the three pumping stations that are installed in Aula Dei. Figure 11

shows the irrigation system composed by 20 hydrants and the corresponding regulation elements.
The following tests were performed to verify the proper operation of the installed equipment:
• Tests on remote systems, checking the correct operation of the installed equipment based on re-

quired settings. Also checking the interoperability between equipment and the control center.

19

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

• Water regulation ﬂow tests, checking the optimal functioning of various control algorithms, both in
pumping stations operating in conjunction with tanks and in regulation control points for hydrants.
• Tests on management applications, checking the correct operation and interoperability with the
installed systems. Multiple computers are installed in order to perform parallel tests to check
equipment coordination and detect interferences.

We enumerate a list of functions that we are going to test in the described scenario:
• Loading and conﬁguration of the elements of the physical model. Mapping of hydraulic entities
and association to subsystem controllers. Monitoring and listing of the elements of the physical
model registered in the Coordination layer.

• Collection and consolidation of data from subsystems. Subsystem coordination and data integra-

tion, i.e. integration of hydrants’ aggregated data for branch surveillance.

• Execution of control recipes in virtual entities, assigning to associated subsystem the correspond-

ing actions. Creation of normalized history registries for virtual entities.

• Reception, interpretation, allocation and delivery of elements from the process model. Monitoring

and listing of these elements.

• Storage, publication, and distribution of the hydraulic topology to applications that require it.
Storage and publication of sensor data (weather conditions, humidity, temperature) collected by
legacy subsystems, adapted to the MEGA model.

5 Conclusions and Future Work

Water management impacts on several key matters of human lives and several scenarios, such as cities,
natural areas, agriculture, etc. Some works focus in the lack of ICT services and tools for water manage-
ment, which would enable information reuse (goal of the PSI Directive [20]), easier fulﬁllment of policy
regulations and resource monitoring.

In this paper we presented the MEGA initiative for deﬁning a reference architecture for water man-
agement based on integrating IoT capabilities to achieve a scalable and feasible industrial system. We
deﬁne the management exploitation layer, coordination layer, subsystems layer and administration layer
and the interfaces that enable layer interaction. We also consider the physical model, which deﬁnes the
physical elements executing water management processes in a hierarchical way, and also, the process
model, which organizes the execution of particular processes in water management subsystems.

Processes are deﬁned based on automation principles and using the widely used standard OPC UA.
We illustrate how such architecture can be used for controlling real water management systems, but still
we need to clearly deﬁne operation procedures for dealing with many real problems such as physical
network deﬁnition or identiﬁers mapping.

Finally, we describe the deployment scenario we have deﬁned for validation the MEGA model,
developed in Aula Dei, an experimental station on Zaragoza, enumerating the list of functions that we
are going to test in this station.

We can conclude that the adoption of IoT and OPC UA facilitates water management companies the
access to a wider global market and incorporates new beneﬁts to decisions support systems, monitoring,
water governance and also water-energy nexus. Future work will describe the performed test and will
focus on the contribution to solve coordination problems when executing multiple recipes over the same
physical resources, considering priority and conditional executions and also process optimization.

20

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Acknowledgments

This work is partially supported by MEGA, a join research effort of Tragsa and UPM. It is also supported
by CALISTA project, TEC2012-32457, awarded by the Ministry of Economy and Competitiveness in
Spain.

References

[1] United Nations. Global Sustainable Development Report – Executive Summary: Building the Common Fu-
ture We Want. New York: United Nations Department of Economic and Social Affairs, Division for Sustain-
able Development. 2013. http://sustainabledevelopment.un.org/globalsdreport/, last viewed November 2014.
[2] T. Robles, R. Alcarria, D. Mart´ın, and A. Morales, “An Internet of Things-based model for smart water
management,” in Proc. of the 8th International Conference on Advanced Information Networking and Appli-
cations Workshops (WAINA’14), Victoria, Canada.

IEEE, May 2014, pp. 821–826.

[3] HollandTrade, homepage: http://www.hollandtrade.com/, last viewed November 2014, 2014.
[4] Association of Water Technologies, homepage: http://www.awt.org/, last viewed November 2014, 2014.
[5] EU Water Framework Directive (Directive 2000/60/EC), 2000.
[6] TRAGSA group home page: http://www.tragsa.es/en/, last viewed November 2014.
[7] MEGA project homepage: http://www.gestiondelagua.es/en/, last viewed November 2014.
[8] OPC homepage: https://opcfoundation.org, last viewed November 2014.
[9] J. Gubbi, R. Buyya, S. Marusic, and M. Palaniswami, “Building the common future we want,” United Nations

Department of Economic and Social Affairs, 2013.

[10] M. Weiser, R. Gold, and J. S. Brown, “The Origins of Ubiquitous Computing Research at PARC in the Late

1980s,” IBM Systems Journal, vol. 38, no. 4, pp. 693–696, December 1999.

[11] R. Alcarria, T. Robles, A. Morales, D. L. de Ipi˜na, and U. Aguilera, “Enabling ﬂexible and continuous
capability invocation in mobile prosumer environments,” Sensors, vol. 12, no. 7, pp. 8930–8954, June 2012.
[12] R. Alcarria, T. Robles, A. Morales, and E. Cede˜no, “Resolving coordination challenges in distributed mobile
service executions,” International Journal of Web and Grid Services, vol. 10, no. 2, pp. 168–191, January
2014.

[13] E. Serrano, P. Moncada, M. Garijo, and C. Iglesias, “Evaluating social choice techniques into intelligent
environments by agent based social simulation,” Information Sciences, vol. 286, pp. 102–124, December
2014.

[14] L. Atzori, A. Iera, and G. Morabito, “The Internet of Things: A survey,” Computer Networks, vol. 54, no. 15,

pp. 2787–2805, October 2010.

[15] D. Miorandi, S. Sicari, F. D. Pellegrini, and I. Chlamtac, “Internet of things: Vision, applications and research

challenges,” Ad Hoc Networks, vol. 10, no. 7, pp. 1497–1516, September 2012.

[16] AENOR EN 61512: Batch control – Part 2: Data structures and guidelines for languages, 2002.
[17] AENOR EN 62264: Enterprise-control system integration - Part 1: Models and terminology, 2013.
[18] M. Melik-Merkumians, T. Baier, M. Steinegger, W. Lepuschitz, I. Hegny, and A. Zoitl, “Towards OPC UA
as portable SOA middleware between control software and external added value applications,” in Proc. of
the 17th IEEE Conference on Emerging Technologies and Factory Automation (ETFA’12), Krak´ow, Poland.
IEEE, September 2012, pp. 1–8.

[19] J. Imtiaz and J. Jasperneite, “Scalability of OPC-UA down to the chip level enables Internet of Things,” in
Proc. of the 11th IEEE International Conference on Industrial Informatics (INDIN’13), Bochum, Germany.
IEEE, July 2013, pp. 500–505.

[20] PSI Directive (2003/98/EC). Directive on the re-use of public sector information entered into force on 31

December 2003, European Commission.

——————————————————————————

21

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Author Biography

Tom´as Robles received a M.S. and Ph.D. degrees in Telecommunication Engineering
from Technical University of Madrid in 1987 and 1991 respectively. Since 1991 he is
associate professor on Telematics Engineering at the E.T.S.I. Telecommunication of
the Technical University of Madrid. His research interest is focused on Advanced Ap-
plications and services for Broadband networks, both wired and wireless networks.

Ram´on Alcarria received his M.S. and Ph.D. degrees in Telecommunication En-
gineering from the Technical University of Madrid in 2008 and 2013 respectively.
Currently, he is an assistant professor at the E.T.S.I Topography of the Technical Uni-
versity of Madrid. His research interests are Service Architectures, Sensor Networks,
Service Composition and Prosumer Environments.

Diego Mart´ın received his doctoral degree in 2012, holds a B.Sc in Computer En-
gineering and an M.S. in Computer Science from the Department of Informatics at
the Carlos III University of Madrid, Spain. His main research areas are Software
Process Improvement, Knowledge Management and Reutilization and Prosumer En-
vironments.

Mariano Navarro graduated as Telecommunications Engineer from Technical Uni-
versity of Madrid in 1990. He is currently working as the Head of the ICT Unit since
2005. He has been working in TRAGSA Group, (Tragsa & Tragsatec) for 18 years.
Expert on Open Innovation and Social Spaces for Research and Innovation, also par-
ticipates and coordinates several EU projects. Member of ENoLL, leader of TRAGSA
Living lab, and member of SSRI network.

Rodrigo Calero graduated in Agricultural Engineering, specialization in Rural Engi-
neering, from University of Cordoba. Since 1999, he is working in Tragsa Group in
the R&D Unit in areas related to water treatment, water management, irrigation, rural
infrastructures, biomass and energy usage. He is currently Head of Department in the
R&D Unit. In this sense, he has coordinated some R&D national projects and he is
the author of some patents and papers.

22

An IoT based reference architecture for smart water management

processes

Tom´as Robles1, Ram´on Alcarria2∗, Diego Mart´ın1,

Mariano Navarro3, Rodrigo Calero3, Sof´ıa Iglesias3, and Manuel L´opez3

1Dep. de Ingenier´ıa de Sistemas Telem´aticos
2Dep. de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa

Universidad Polit´ecnica de Madrid, Spain

{tomas.robles, ramon.alcarria, diego.martin}@upm.es

3Innovation and R&D unit

Tragsa Group, Spain

{mnc, rcalero, siglesias, mlopez}@tragsa.es

Abstract

Water is a vital resource for life, and its management is a key issue nowadays. Information and com-
munications technology systems for water control are currently facing interoperability problems due
to the lack of support of standardization in monitory and control equipment. This problem affects var-
ious processes in water management, such as water consumption, distribution, system identiﬁcation
and equipment maintenance. OPC UA (Object Linking and Embedding for Process Control Uniﬁed
Architecture) is a platform independent service-oriented architecture for the control of processes in
the logistic and manufacturing sectors. Based on this standard we propose a smart water management
model combining Internet of Things technologies with business processes coordination and decision
support systems. We provide an architecture for sub-system interaction and a detailed description of
the physical scenario in which we will test our implementation, allowing speciﬁc vendor equipment
to be manageable and interoperable in the speciﬁc context of water management processes.

Keywords: Water management, Irrigation, OPC UA, Internet of Things

1 Introduction

Water management is deﬁned as the activity of planning, developing, distributing and managing the op-
timum use of water resources. This impacts on several key matters [1] of human lives, such as food
production, water consumption, sewage treatment, irrigation, puriﬁcation, energy generation and utiliza-
tion, etc.

The lack of water ICT (Information and communications technology) standards prevents an effective
interoperability, and increases the cost and the maintenance of new products. Nowadays there are many
small and local producers of speciﬁc solutions in a weak and fragmented market. The almost no adop-
tion of complex and interoperable systems jeopardizes the control and monitoring of water distribution
networks, preventing also their evolution and necessary improvements, as an adoption of IoT (Internet
of Things) paradigm.

In addition, current ICT systems for water management are proprietary and packed as independent
products, support all management levels from the product development to the communication with man-
agement systems. System maintenance and sustainability depends on the company providing it. This

Journal of Wireless Mobile Networks, Ubiquitous Computing, and Dependable Applications, volume: 6, number: 1, pp. 4-23

∗Corresponding author: Departamento de Ingenier´ıa Topogr´aﬁca y Cartograf´ıa, Universidad Polit´ecnica de Madrid, Avenida

del Mediterr´aneo km 7,0, 28031 Madrid, Spain, Tel: +34-91-336-6487

4

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

entails the SMEs (Small and medium-sized enterprises) that develop water management ICT systems
and tools may not enter the water market even with powerful solutions without considering a complete
system that jeopardize their strengths.

OPC (Object Linking and Embedding for Process Control) was developed by the automation and
logistic industry as an open standard speciﬁcation that would allow the communication of real-time
plants data between control devices produced by different manufacturers. The most recent version of
OPC (OPC UA), is based on web services technology, so OPC UA becomes platform-independent and
can thus be applied in scenarios where classic OPC is not used.

In this work we complete the smart water management model that we proposed on [2]. In our pre-
vious work we deﬁned an Internet of Things-based model for smart water management using OPC UA.
This previous work has been extended by the provision of a detailed architecture in which we con-
sider IoT technologies for decoupling decision support systems and monitoring from business processes
coordination and subsystem implementation. This functional architecture considers several layers and
interfaces to enable layer interaction. We also extended our reference model describing a practical use
case deﬁning how the MEGA architecture is used to develop a simple water management process con-
trol by using recipes, and explaining more practical aspects of our validation scenario, held in a water
management experimental station in Zaragoza, Spain.

The rest of the paper is as follows: Section 2 proposed a high level architecture based on industrial
challenges, water management requirements and OPC UA functionalities; Section 3 describes the in-
tegration of IoT into the water management system; Section 4 develops the reference model for smart
water management, comes up with a simple use case, and ﬁnally analyses current water management
scenario and future implementation.

2 High Level Architecture for effective water management

Consumers in the water sector provide a weak critical mass to inﬂuence in decisions resulting in ap-
propriate changes. The water sector operates in a complex interaction between water resources and the
socio-economic and environmental systems. The range of stakeholders is huge, public and private, from
global to local companies, supported by national, regional and again local authorities. This different na-
ture in stakeholders and also the various schemes for water governance, which are continuously evolving
in every country, are the main reasons for current market fragmentation in water management solutions.
An excessive market fragmentation is a severe barrier for innovation under the desirable paradigm of
an Integrated Water Resources Management (IWRM), by slowing down the adoption of open reference
architectures and standards. This approach could enable interoperability, making it easier for developers
to upgrade current solutions and integrate and adopt innovative ones.

2.1 Challenges for deﬁning Industrial Standards for Water Management

In order to deﬁne feasible and wider industrial standards for water management processes, two main
challenges must be solved: 1) The lack of integration of current solutions and 2) the unexisting common
ICT reference model for water management processes.

There is a lack of integration of current solutions. Although there are many global vendors integrating
water management solutions, local solutions can be also developed and maintained. The small and local
nature of these companies make them anticipate to unexpected changes and enables them to provide
various solutions for intra-regional issues. However, as consumers, small businesses do not have the
critical mass to inﬂuence in decisions and to foster a reference system by themselves. The deﬁnition of a
common framework to canalize these efforts is required, not only to reinforce synergies among different

5

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

players, but also to enable the integration and widespread adoption of speciﬁc solutions.

Global and local vendors use different standards, methods, data models and communication channels
for their solutions. These solutions are often very complex and sometimes economically unsustainable
for their customers. This barrier leads to monitoring issues preventing the necessary decision making
process. It states the need of common understandings and consistent methodology for an effective water
management.

There is not an ICT reference model for water management processes. Nowadays, there are many
companies involved in water management activities, such as collection, distribution, conduction and
treatment. Furthermore, companies involved in areas related to soil management or chemistry also de-
mand suitable technologies for water support and provision.

This implies huge heterogeneity that requires various skills working together. Thousands of compa-
nies are directly active in this kind of processes. For example, 1.500 companies are involved in water
technology in the Netherlands [3]. In Europe, the EUWMA (European Union of Water Management As-
sociation) represents over 8.600 organizations in eight countries. Also, in USA, companies specialized
in water treatment are members of an international trade association representing over 500 companies
[4].

The new arrival of ICT technologies in the water management ﬁeld has to deal with the large variety
of processes and functions required to understand the water management cycle (urban and rural con-
sumption, weather and climate change, water resources, agriculture, ground water, forest, river basins,
environmental areas of special interest, etc). This complex cycle results in the lack of a reference model
for the use of ICT and the absence of a clear leader on ICT technologies that covers the entire water
management process. There are some European initiatives [5] for deﬁning common frameworks for wa-
ter policies, but there is not any international organization promoting the deﬁnition of ICT standards to
foster effective interworking of water management infrastructures and components. This is mainly due
to two reasons:

Little appreciation for interoperability: water management processes are performed by speciﬁc tech-
nologies coming from other sectors, such as automation, energy, etc. The control of such technologies
is provided by proprietary solutions. One reason for the lack of effective interworking of water manage-
ment infrastructures and components is that there is not any requirement, demand or legal regulation that
imposes the interconnection of such systems.

Water management companies locally oriented: most of the water management solutions currently
used are provided by SMEs. Those companies provide simple solutions for very speciﬁc problems with
local markets that needs close relationships, but they usually ﬁnd problems to expand their business top
other areas or countries due to different regulations, and low equipment interworking. The problem for
the end-users is that they are engaged with local providers which can even disappear and the existing
infrastructure cannot be maintained and updated by any other. Therefore they are forced to start from the
scratch with a big reinvestment.

To overcome these problems, Tragsa [6] is promoting the MEGA [7] model as an speciﬁc initiative in
Spain that can be translated to European and International levels. Tragsa is a public company that belongs
to Spanish Ministry of Agriculture, Food & Environment deals with all aspects of water management.
In Mediterranean countries water consumption for agriculture represents the 70% of the total and higher
energy consumption than a big city like Madrid, Rome, Paris, or Athens. The MEGA model considers a
functional decoupled architecture to allow interoperability between speciﬁc vendor equipment.

2.2 Requirements for a reference Architecture

We deﬁne the following requirements that must be fulﬁlled to develop a standard water management
model:

6

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

REQ #1: The system should cover these water management functions: remote management of phys-
ical elements and operation of basic units; identiﬁcation of resources in the water network, deﬁnition of
operations and conditions over the network.

REQ #2: It should support interoperability with other applications such as geographic information
systems and also databases containing information regarding soils, weather forecast, environment, farm-
ing, etc.

REQ #3: It should provide a ﬂexible and extensible architecture for the integration of various sys-
tems. To do that, it must deﬁne open interfaces among communication and process control layers, and
also integrate IoT systems for a direct access to individual water management devices.

REQ #4: It should support integration with legacy systems, controlling current equipment. Water
management infrastructures currently deployed in the countryside consist of many interconnected and
simple devices that must be managed using legacy systems. They integrate communication functions,
data models, and protocols dependent on an speciﬁc technology of the manufacturer. Overriding these
systems with new ones is not always a feasible solution.

2.3 Requirements for a reference Architecture

OLE for Process Control (OPC), which stands for Object Linking and Embedding (OLE) for Process
Control, is the original name for a standards speciﬁcation developed in 1996 by an industrial automation
industry task force. The standard speciﬁes the communication of real-time plant data between control
devices from different manufacturers[8] .

As of November 2011, the OPC Foundation has ofﬁcially renamed the acronym to mean ”Open
Platform Communications”. The change in name reﬂects the applications of OPC technology for appli-
cations in process control, discrete manufacturing, building automation, and many others. Initially, the
OPC standard was restricted to the Windows operating system. This speciﬁcation, which is currently
known as OPC Classic, enjoyed widespread adoption across multiple industries, including manufactur-
ing, building automation, oil and gas, renewable energy and utilities.

With the introduction of service-oriented architectures in manufacturing systems new challenges
in security and data modeling arrived. The OPC Foundation developed the OPC UA (OPC Uniﬁed
Architecture) speciﬁcation to address these needs and at the same time to provide a feature-rich open-
platform architecture to be future-proof, scalable and extensible.

OPC UA, released in 2008, consists of the following parts: Concepts, Security Model, Address
Space Model, Services, Information Model, Mappings, Proﬁles, Data Access, Alarms and Conditions,
Programs, Historical Access, Discovery and Aggregates. It also deﬁnes a platform independent service-
oriented architecture that integrates all the functionality of the individual OPC Classic speciﬁcation into
one extensible framework. The multi-layered approach of OPC UA accomplishes these original design
goals:

• Functional equivalence: all COM OPC Classic speciﬁcations are mapped to UA
• Platform independence: from an embedded micro-controller to cloud-based infrastructure
• Secure: encryption, authentication, and auditing
• Extensible: ability to add new features without affecting existing applications
• Comprehensive information modeling: for deﬁning complex information

7

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

The OPC UA information-modeling framework turns data into information. With complete object-
oriented capabilities, even the most complex multi-level structures can be modeled and extended. Data-
types and structures are deﬁned in proﬁles. For example, the existing OPC Classic speciﬁcations were
modeled into UA proﬁles, which can also be extended by other organizations.

Figure 1: OPC UA information Modeling

OPC UA offers a set of Base Services, which is complemented with optional services (Data Access,
ASE, Historical Data Access, Commands, Alarms and Events, Data Exchange and Security), as shown
on Figure 1. Over Base Services and using some of the optional services, the OPC UA standard can be
applied to any speciﬁc domain by the deﬁnition of the Information Model Speciﬁcation. In the top level
vendors can deﬁne their own speciﬁc Information Model.

The new functionalities provided by OPC-UA speciﬁcation (support for Web applications to access
OPC-UA servers, OPC-UA cloud computing service) are aligned with the requirements of the proposed
water management architecture. Thus, we decide to use this standard for the communication between
MEGA interfaces.

2.4 High level Architecture for effective water management

The MEGA architecture is described in Figure 2. The proposed high level model identiﬁes three layers
(from bottom to top): the Subsystems layer, the Coordination layer and the Management - Exploitation
layer. These layers deal with a common Water Management Model that considers the deﬁnition of En-
tities, Recipes, Procedures, Planned processes, and Alarms. The water management model is the key
element for enabling MEGA to provide a common behavior framework. Between the Subsystem layer
and the Coordination layer there is a Coordination - Subsystems interface and between the Coordination
and the Management - Exploitation layer there is a Common Communication interface. It is also consid-
ered an Administration layer that manages the information provided by the Coordination layer through
the Administration Interface.

We describe the main elements of the MEGA architecture:
Management and Exploitation layer: this layer hosts the main applications and services respon-
sible for the efﬁcient management of water infrastructures, and supports the deﬁnition and management
for the processes applied to those infrastructures. In this layer the Operators (big service companies,
and end-users associations among others) drive management processes abstracting from the speciﬁc ﬁ-
nal systems deployed in the real environment. Services can be executed on local hosts, cloud services or
whatever other service environment provided by current state of the art technologies.

Coordination layer: this layer supports the interoperability among different management and ex-
ploitation systems and the underlying hardware and software subsystems. Based on the deﬁnition of a
water management model, the Coordination layer perform the following functions:

• Entity management: The coordination layer deﬁnes and associates entities to physical objects.
Entities can be Real Entities when they directly correspond to physical devices or Virtual Entities,

8

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 2: MEGA High level Functional Structure

when they correspond to a functionality that can be either covered by multiple devices or part of a
single device.

• Procedure management: A procedure is a high level water management use case that is per-
formed in one or many subsystems. Procedures deﬁned by the Management and Exploitation are
collected and delivered to the Subsystem layer. The coordination layer interacts with the subsys-
tems taking into account the topology of the water system, and the interface of each subsystem.

• Recipe management: Recipes specify the sequence of activities to be executed in subsystems.
They are associated to procedures. The Procedure manager binds recipes with deﬁned procedures.
• Process planning: Processes are atomic activities that are executed inside a subsystem. Recipes
are composed by processes. The Process planner deﬁnes processes and delivers them to the Pro-
cess performer, which is in change of its execution.

Subsystems layer: the subsystems layer contains the different subsystems integrated into the Wa-
ter Management System. Each subsystem is independent from others and manages the lifecycle of the
operations that are executed. Subsystem can be heterogeneous and dependent from proprietary technolo-
gies. In order to achieve interoperability they must implement the methods deﬁned in the Coordination-
Subsystems interface.

9

Procedure manager Process planner Recipes Procedures Process performer Planned processes DB Alarm and message manager Entity manager Subsystem controller Coordination-Subsystems interface Administration interface Common Communication interface Alarm messages DB Entities Management Exploitation layer Subsystems Administration layer Virtual Entities manager Real Entities manager Coordination layer An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Administration layer: the administration layer enables the conﬁguration of the different entities
deﬁned in the Coordination layer. It provides a user interface that can be consumed by platform admin-
istrators to perform administration and monitoring functions.

Three main interfaces are deﬁned in this high level architecture, the Administration Interface, Com-

mon Communication Interface and the Coordination-Subsystems Interface:

Administration Interface: The Administration interface enables the monitoring of the entities de-
ﬁned and stored in the coordination layer. Speciﬁcally it monitors entities, procedures, and processes,
and how these processes a being executed into subsystems.

Common Communication Interface: This bidirectional interface provides a common solution in
order to handle messages from business processes in the management and exploitation layer and process
them in the coordination layer by using industry driven standards such as ISA-95/88 and OPC UA, as
explained in Section 2.3.

Coordination-Subsystems Interface: this interface enables the execution of water management
processes in the subsytems. The Coordination layer does not know precisely the internal structure of
each subsystem (which is implemented by each company), but can delegate processes and monitor their
execution and the status of the physical systems requesting relevant information. This information is
collected, processed and further translated to the Management and Exploitation layer.

These layers and interfaces rely on how water management elements and processes are deﬁned. Data
analysis, collection, process distribution and system behavior are deﬁned into a physical model and a
process model.

Physical Model: The physical model enables the deﬁnition of the equipment integrated in the water
management systems in a hierarchical way. This model identiﬁes in an unique way the entities partic-
ipating in the subsystem, how the are related and grouped. As subsystems can be heterogeneous and
dependent from proprietary technologies, it allows SMEs, which do not have the resources to implement
a whole reference system on their own, to develop o reuse a single subsystem.

Process Model: based on the physical model and knowing the process each subsystem is able to
perform, simple or complex processes are deﬁned and (i) loaded into the system; (ii) validated according
to internal information; (iii) distributed to the suitable subsystems; (iv) executed and monitored; and
ﬁnally (v) stopped and reported.

OPC UA is deﬁned for controlling processes assigned to physical entities. Due to the speciﬁc nature
of water management systems, MEGA identiﬁes the “virtual entities” as a concept that is deﬁned for
facilitating the water management over one speciﬁc water system. The virtual entities can be deﬁned
as “logic devices generated by the logic operation of an hydraulic entity”. The use of virtual entities
enables the deﬁnition of processes for such elements that do not correspond to real devices, instead they
correspond to a functionality that can be either covered by multiple devices or part of a single device.

Due to the virtual nature of such entities, their functional behavior and states will be determined in
the Coordination Layer, instead of in the Subsystems. Then, control recipes including procedures for
such virtual entities are going to be executed by the Control Layer, as such those recipes are not going to
be transferred to any subsystem.

MEGA provides a reference Architecture for water management process using OPC UA. Figure 3
shows how the MEGA reference architecture ﬁts into the automation pyramid, and uses OPC UA for
communication between the Coordination Layer and the Subsystem Layer.

The ﬁrst version of MEGA deﬁned the two interfaces based on OPC UA: the Common Communica-
tion Interface and the Coordination-Subsystem Interface. Nevertheless the interface between the Process
Control Level and the Control & ﬁeld Level is not deﬁned in MEGA at all. This is because the na-
ture of water management system for irrigation in the ﬁeld. MEGA reference architecture identiﬁes the
subsystems for covering the Process Control Level and the Control & ﬁeld Level, so each manufacturer
company can provide on the box solutions using the most suitable process and communication tech-

10

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 3: OPC UA in the automation pyramid for MEGA

nologies according to the state of the art and the requirements imposed by such kind of systems. In the
water management process the equipment has to be deployed into an hostile environment (open air, bad
weather conditions, unattended or difﬁcult access equipment, etc.) Therefore it is a key issue for every
provider that their system is able to solve such difﬁculties even with speciﬁc interfaces.

3 Integrating IoT in water management

Contributing to solutions that integrate the Internet of Things paradigm into water management processes
can be beneﬁcial to address expected solutions. The rest of this Section describes the main beneﬁts of
adopting IoT and the IoT characteristics that are considered in the proposed MEGA model, considering
new advances on ICT technologies for creating feasible and commercial systems [9].

Mark Weiser deﬁned a ”Smart Environment” [10] as - the physical world that is richly and invisibly
interwoven with sensors, actuators, displays, and computational elements, embedded seamlessly in the
everyday objects of our lives, and connected through a continuous network. There are many research
works that contributes to solve various issues in Smart Environments, such as seamless access to re-
sources and devices [11], distributed service executions [12], social choice techniques [13], etc. Other
works explains how IoT is based on three paradigms - internet-oriented (middleware), things oriented
(sensors) and knowledge-oriented (semantics) [14]. Although this type of delineation is required due to
the interdisciplinary nature of the subject, the usefulness of IoT can be unleashed only in an application
domain where the three paradigms intersect.

3.1

IoT for Water Management

The provision of Internet of Things capabilities in water management scenarios can be achieved if we
consider some considerations from the business, social and technical point of view. Here we list the main
beneﬁts of providing IoT in water management scenarios:

Efﬁciency increase: water management companies and associations can use real-time operational
control to make smarter business decisions and reduce operating costs. They use real-time data from

11

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

sensors and actuators to monitor and improve water management infrastructures, making them more
efﬁcient, reducing energy costs and minimizing human intervention.

Cost savings: water management costs can be reduced through improved asset utilization, process
efﬁciencies and productivity. Customers and organizations can beneﬁt from improved asset utilization
(e.g., smart water irrigation units that eliminate manual operation) and service improvements (e.g., re-
mote monitoring of irrigation conditions)

Asset utilization: with improved tracking of assets (machinery, equipment, tools, etc.) using sensors
and connectivity, companies can beneﬁt from transparency and visibility into their assets and supply
chains. They can easily locate assets and run preventive maintenance on critical pieces of infrastructure
and machinery.

Productivity increase: Productivity is a critical parameter that affects the proﬁtability of any organi-
zation. IoT allows real-time control, new business models, process optimization, resource conservations,
service time reduction, and the capability to do all of this globally, reducing the mismatch of required vs.
available skills and improving labor efﬁciency.

Expansion of new and existing business models: IoT is beneﬁcial in any of the three deﬁned
layers. In the subsystem layer, IoT subsystems are able to execute processes and communicate using a
standard communication interface; in the coordination layer, it can be useful to enable SMEs to design
new coordination applications, with the purpose to orchestrate the management and exploitation layer
with the subsystem layers; and ﬁnally, in the management and exploitation layer, IoT identiﬁcation
capabilities contribute to provide tailored information services for an speciﬁc water distribution network
community.

As we explained before, IoT builds on three pillars [14]: Internet orientation, thing orientation, and
knowledge orientation. We link these pillars with the ability of objects to (i) be identiﬁable (anything
identiﬁes itself), (ii) communicate (anything communicates) and (iii) to interact (anything interacts),
either among themselves, building networks of interconnected objects, or with end-users or other entities
in the network. The proposed MEGA model considers these properties:

Internet-oriented: the proposed MEGA model identiﬁes three layers (see Figure. ??). These layers
are communicated with two web interfaces enabling the deﬁnition of a ﬂexible and scalable commu-
nication system for controlling the huge amount of subsystems to be required for a complete water
management system.

The Coordination and Management - Exploitation layers are deﬁned as Cloud services. IoT,
as a broader vision of the previous concept of machine-to-machine (M2M) communications, is gaining
support by current Cloud computing infrastructures, which begin to provide so called cloud-based IoT
solutions.

Furthermore, subsystem capabilities (i.e. sensing, actuating, computing and communication tech-
nologies) depend on the speciﬁc conditions of the scenarios in which they are deployed. A seamless
access to subsystems will require that the Subsystems layer includes homogenization through a large
diversity of communication paradigms and higher granularity, to deal with many communication
technologies.

Thing-oriented: Due to previous experiences of the development of systems for water management,
the most granular element to be accessible is the subsystem. It is expected higher granularity in the
coming years, as subsystems are composed by many devices and interrelations, as we describe in the
physical and process models of Section 4. These elements can be redeﬁned as Smart Objects, being
objects which are able to describe its own possible interactions. Smart Object may provide the following
information: Object properties (physical properties and a text description), behavior (different behaviors
based on state variables) and, also, interaction information (current state of dials, gauges, switches, etc.).
It is important to deﬁne how subsystems as smart object containers fulﬁlls the features identiﬁed by
[14] and [15]. Subsystems deﬁnes and provides object identiﬁcation, to do that they must incorporate

12

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Unique system identiﬁcation features. Also, they publish subsystem capabilities, as a list of functions
supported by them, considering the capabilities of integrating objects.

Knowledge-oriented: due to the large heterogeneity of subsystems for water management it is im-
portant to model the characteristics that these subsystems have in common, and their behavior. In this
work we provide a physical model, deﬁning the physical elements executing water management pro-
cesses in a hierarchical way, and also a process model, organizing the execution of particular processes
in water management subsystems. Based on these models, smart execution of water management pro-
cesses is supported through collaboration between subsystems and the Coordination layer, based on the
interchange of information among them (see Figure. 3). Thanks to knowledge provision systems can be
monitored to facilitate public entities tracking the fulﬁllment of regulations. Information to be moni-
tored is autonomously provided by the subsystems based on sensor capabilities. These models can be
enriched with semantics to describe, share, and integrate information, inferring new knowledge related
to water management and irrigation processes. Semantics also helps to create machine-interpretable and
self-descriptive data in the IoT domain. Semantic descriptions can support data integration by enabling
interoperability between different data sources (sensors, devices); however, analysis and mapping be-
tween different semantic description models is still required to facilitate the IoT data integration with
other existing domain knowledge.

4 Reference model for smart water management

This Section describes the water management model that is being developed. This model consist of three
main elements, the Water Management Model, Common Communication Interface and Coordination-
Subsystems (C-S) Interface.

4.1 Water Management Model

The water management model includes the physical model and the process model.

The physical model follows standards EN 61512 [16] and EN 62264 [17]. As proposed by EN 61512
a layered structure is deﬁned and represented in Figure 4. The three upper layers (Company, Location
and Area) are modeled as in EN62264, representing companies organization. The Process Cell and Unit
represent entities in which processes are executed. Examples of process cells and units are an Irrigation
Sector and a Pump Management Station (PMS) respectively. Finally, the Equipment Module and Control
Module are elements belonging to the subsystem and can not be directly accessed by the Coordination
layer. Due to the current advance in the state of the art in IoT these elements will become Smart Elements
in a future and they will be directly identiﬁed and accessed. Hydrants, ﬁltering stations and pumping lines
are examples of equipment modules. Valves engines and meters are examples of control modules.

The process model organizes the execution of particular processes in water management subsystems,
following a predeﬁned strategy. Examples of processes are irrigation, tank ﬁlling, or water consumption
measurements. The process model identiﬁes the Procedure, as the basic element to be executed by
the Process Cell. Procedures are composed by Unit Procedures, as the basic element to be executed
by one unit, and ﬁnally, the Operations, as atomic instructions executed inside units. For example, an
atomic instruction to be executed in a pump management station can be to execute a periodic cleaning
process to optimize the performance of the station. The deﬁnitions of elements and operations in the
physical model and process model respectively enable the operation and remote management of water
management elements, as REQ #1 demands

13

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.2 Common Communication Interface

The Common Communication interface is composed by a set of web services that are consumed by
applications belonging to the Management - Exploitation layer, in order to operate on entities deﬁned by
the physical model, identify the current state of the systems and also send water management operations
to control the water consume.

Figure 4: Layers of the physical and process models

The Common Communication interface handles messages from the business processes (GIS-based
applications, services providing information about soils, meteorology, as REQ #2 demands), in XML
format, and transforms them to ISA-95/88-compliant OPC UA information models. OPC UA (IEC
62541) is an industry driven standard which provides uniﬁed communication and interaction means for
Service Oriented Architectures and Web Services. It is often used to implement different proﬁles for
automation systems [18] such as home and industrial automation and also water management systems.
OPC UA contributes to fulﬁll REQ #3, as it enables the integration of different systems based on speciﬁc
technologies.

OPC UA deﬁnes an information model that enables the creation of device instances and device types.
We implemented the physical model in OPC UA deﬁning control messages in the Management - Ex-
ploitation layer, and enabling the execution of these messages in the Coordination layer. In order to be
compliant to ISA-9588, we deﬁne recipes, which specify the sequence of activities in the form of pro-
cedural steps. Thus, control messages contain recipes that will be executed in the subsystems, by the
physical components located inside. Using recipes becomes the solution to manage subsystem elements,
which are not directly accessible by the Coordination layer, as the sequence of activities to be performed
must be decoupled from the speciﬁc technology in the subsystems, as REQ #4 demands.

There can be some problems if more that one recipe is executed on the same entity at the same time.
To solve that we deﬁne recipes with execution restrictions, which prevent multiple recipe executions
over the same physical element. To check which elements are used by a recipe the Coordination layer
retrieves the list of operations to be done by the recipe and gets the identiﬁers of the process cells and
units which perform these operations. If any of these process cells and units are used by other recipe that
must be executed at the same time the coordination layer ﬁnds an incompatibility, which must be solved
in the Management - Exploitation layer by user intervention.

Figure 5 describes the deﬁned model for recipes. The control recipe has a RecipeID that uniquely
identiﬁes it. Also, it Header identiﬁes the procedure in which the recipe is included with the Procedu-
ralID, and the type of recipe to execute (RecipeType). The Formula includes the set of actions to be
performed over the entity EntityID. Depending on the recipe type, the formula applies to either the ac-
tive elements (monitoring recipe), irrigation elements (irrigation recipe), hydrants of the entity (hydrant

14

Location Area Process Cell Unit Equipment Module Control Module Company Physical Model Process Design Loading Monitoring Checking Validating Process Execution Operations Procedure Unit Procedure An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Figure 5: Control recipe model

recipe), etc.

4.3 Coordination-Subsystems interface

The Coordination-Subsystems (C-S) interface exchanges OPC-UA messages between the Coordination
layer and the Subsystems.

Figure 6: Invoking a simple control recipe

This interface considers the water management elements (Units, Process Cells, etc) as a set of nodes,
which can be monitored and accessed by OPC-UA clients. A modiﬁcation of these nodes, due to the
execution of a recipe formula, results in changes in the behavior of physical elements. Recipe formulas
are transfered from the coordination layer to subsystems that can execute them. To do that, the coordi-
nation layer must know the subsystem capabilities. OPC-UA supports the deﬁnition of Proﬁles, which
describes the supported features by an OPC-UA compliant product. Mandatory features that must be
supported by clients and servers are deﬁned in proﬁles, along with other non-required functionalities that
are negotiated between entities. Currently, the OPC Foundation has published more than 60 OPC-UA
proﬁles [19].

Figure 6 describes an interaction diagram of the use case ’Invoking a simple control recipe’. The
diagram reﬂects the interaction between Coordination layer and Subsystems, which includes an OPC-
UA server and an OPC-UA client respectively. Subsystems must discover supported proﬁles by getting
the server endpoints. Then, a secure communication channel is created with the server. A modiﬁcation
of a property in a subsystem device (such as opening a valve) is transmitted through the C-S interface
using the OPC Get Node Attributes command, to retrieve the name, type, description and permissions
(read and/or write) of the node, and ﬁnally, using the OPC write command to change the node value.

15

ControlRecipeRecipeIDHeaderRecipeTypeProceduralIDEntityIDFormulaStartDateMonitoringIrrigationHydrant	  CoordinationOPC-UA ServerOPC-UA ClientSubsystem controllerinvoke ControlRecipediscovery: getEndpointsCreateSecureChannel()Coordination-Subsystems interfaceEndpointDescription[]Get Node AttributesSet S1.valve1 to OPENWrite (nodepath,value)Set valve#1 to OPENSubsystem 1resultdataChange(nodepath,value,status)DONEAn IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

When the change is performed in the physical system (e.g. a valve is opened), the element responds with
a dataChange event that is delivered to the Coordination layer, with the result of the action.

4.4 A simple Use Case

In this Section we illustrate by the use of a simple example how MEGA can be used. We describe a
simple but realistic scenario, we show how the data are deﬁned for loading into MEGA, and ﬁnally we
outline how MEGA performs the process control.

1. Scenario description

The proposed scenario contains “a single subsystem with a hydrant and a water deposit that pro-
vides water to the system”. Figure 7.A shows the scenario schema.

Figure 7: Physical Model

For such Hydraulic Network we want to deﬁne the next process, direct expressed by the farmer:
“to irrigate the 27th of September at 12.00 ﬁnishing at 12:30 and using 800 liters as maximum
volume”.

2. Deﬁnition of the Physical Model

Based on the real equipment described on Figure 7.A the next step is the deﬁnition of the Physical
Model according to MEGA speciﬁcations. Figure 7.B depicts the component identiﬁcation, and
Figure 7.C describes the physical model for this use case. MEGA does not deﬁne any standard
procedure for loading the physical model into MEGA System. The table of Figure 8 is elaborated
from Figure 7.C and loaded into the Coordination Layer.

Figure 8: Physical Model loaded into the Coordination Layer

16

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4.5 Deﬁnition of the Master recipe
As described in Section 4.2 MEGA requires the deﬁnition of a Master recipe. The translation of the
informal process to a semi-formal recipe is as follows:

• It is required to execute the process Irrigation recipe 1 over the simple hydrant HYS01
• Starting time for initiating the execution of the recipe: 27th of October of 2013, at 12:00
• End of the execution of the recipe: 27th of October of 2013, at 12:30
• Max water used for irrigation: 800 liters
MEGA does not specify how to deﬁne the recipes. In our case, the following elements apply:
• The target entity for the recipe is: WMD01.IRS01.DNT01.NBU01.HYS02
• The conditions that apply to this recipe are:

– StartDate (201312011200) according to ISO8601
– Two conditions for ﬁnishing:
∗ MaxVolume − > 0.8(m3)
∗ MaxDuration − > 1800(seg.)

In order to illustrate how a water management procedure recipe looks like Figure 9 presents the XML

description of the example of Master recipe given above.

Figure 9: Operation Process over a single Entity

The ﬁnal element to be loaded into the MEGA system is the Master Recipe, which encloses the
process deﬁned in Figure 9 into several “administrative” envelops, which detailed description is beyond
the scope of this paper.

The Master recipe is transferred to the Coordination Level, where the following functions are per-

formed:

17

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

1. Identiﬁers Mapping: Identiﬁers of the Master recipe are mapped into identiﬁer of the subsys-
tems. The identiﬁers mapping algorithm is not deﬁned by MEGA, neither current version of OPC
UA. In MEGA this functionality is left for manual or semiautomatic implementation according to
developer’s preferences. Currently there is an initiative of OPC UA standardization in order to be
able to support automatic identiﬁcation of entities with OPC UA, we expect that next version of
MEGA can incorporate this enhancement.

2. Recipe validation: The validation of the recipe sent by the Management and Exploitation Layer
requires to check that the corresponding subsystem is able to execute the process contained in this
Recipe. MEGA deﬁnes a procedure for deciding when it is not going to be concurrency problems
related to the assignation of more than one process to the same entity at the same time period. In
our simple scenario HYSO1 does not have any other process assigned for execution, so there is
not any scheduling problem.

3. Process transfer to the suitable subsystem: The process to be executed for each entity is going to
be transferred to the subsystem where the entity is located, and alarms and values can be monitored
from the Control Application using standard mechanisms of OPC UA. In this case there is no
alarms or values to be monitored.

4. Control and monitoring of the process execution: The transferred process is monitored from
the Control application, while the process is autonomously executed at the subsystem level. The
Coordination Layer provides information to the Management and Exploitation Layer about the
execution of each Recipe.

4.6 Water management scenario description

Scenarios for water management consider natural environments, cities and rural regions. Systems de-
ployed in these scenarios are controlled by applications that access to subsystems. It is necessary to
consider various conditions, ranging from the number of subsystems to be deployed to the business mod-
els that must be considered for subsystem control, exploitation services and information exchange. This
Section describes the deployment scenario we have deﬁned for validating the MEGA model, that is de-
veloped in Aula Dei, an experimental station in Zaragoza, Spain. We also enumerate the list of functions
that we are going to test in this station.

The Aula Dei experimental station is focused in the water management cycle, speciﬁcally in irri-
gation. A complete irrigation system is modeled, from the water intake to the distribution to the latest
elements (i.e. hydrants). One irrigation system works by gravity and the other one works by artiﬁcial
pressure, to cover all the situations that can be presented in a real setting. From the point of view of the
automation and control elements, the execution of various procedures is allowed in the same hydraulic
element. Speciﬁcally, the installation is divided into:

1. Upper network with two water tanks at different levels and a lifting station with two pumps in

parallel and level control function.

2. Pressure network with automatic pumping station, three pumps in parallel. Two of them with
variable speed drive. The network is composed by 20 hydrants, grouped into 4 lines that return
water to the tank, closing the cycle.

3. Control center with the necessary computer equipment for proper control and installation, as well

as for conducting some tests over the management applications.

18

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

4. Channel with regulation elements for downstream water, regulation gate for upstream water, mixed

regulation gate and ﬂow controlled regulation gate.

Figure 10: Deposit and three pumping stations in Aula Dei

Figure 11: Irrigation system in Aula Dei

Figure 10 shows the deposit and the three pumping stations that are installed in Aula Dei. Figure 11

shows the irrigation system composed by 20 hydrants and the corresponding regulation elements.
The following tests were performed to verify the proper operation of the installed equipment:
• Tests on remote systems, checking the correct operation of the installed equipment based on re-

quired settings. Also checking the interoperability between equipment and the control center.

19

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

• Water regulation ﬂow tests, checking the optimal functioning of various control algorithms, both in
pumping stations operating in conjunction with tanks and in regulation control points for hydrants.
• Tests on management applications, checking the correct operation and interoperability with the
installed systems. Multiple computers are installed in order to perform parallel tests to check
equipment coordination and detect interferences.

We enumerate a list of functions that we are going to test in the described scenario:
• Loading and conﬁguration of the elements of the physical model. Mapping of hydraulic entities
and association to subsystem controllers. Monitoring and listing of the elements of the physical
model registered in the Coordination layer.

• Collection and consolidation of data from subsystems. Subsystem coordination and data integra-

tion, i.e. integration of hydrants’ aggregated data for branch surveillance.

• Execution of control recipes in virtual entities, assigning to associated subsystem the correspond-

ing actions. Creation of normalized history registries for virtual entities.

• Reception, interpretation, allocation and delivery of elements from the process model. Monitoring

and listing of these elements.

• Storage, publication, and distribution of the hydraulic topology to applications that require it.
Storage and publication of sensor data (weather conditions, humidity, temperature) collected by
legacy subsystems, adapted to the MEGA model.

5 Conclusions and Future Work

Water management impacts on several key matters of human lives and several scenarios, such as cities,
natural areas, agriculture, etc. Some works focus in the lack of ICT services and tools for water manage-
ment, which would enable information reuse (goal of the PSI Directive [20]), easier fulﬁllment of policy
regulations and resource monitoring.

In this paper we presented the MEGA initiative for deﬁning a reference architecture for water man-
agement based on integrating IoT capabilities to achieve a scalable and feasible industrial system. We
deﬁne the management exploitation layer, coordination layer, subsystems layer and administration layer
and the interfaces that enable layer interaction. We also consider the physical model, which deﬁnes the
physical elements executing water management processes in a hierarchical way, and also, the process
model, which organizes the execution of particular processes in water management subsystems.

Processes are deﬁned based on automation principles and using the widely used standard OPC UA.
We illustrate how such architecture can be used for controlling real water management systems, but still
we need to clearly deﬁne operation procedures for dealing with many real problems such as physical
network deﬁnition or identiﬁers mapping.

Finally, we describe the deployment scenario we have deﬁned for validation the MEGA model,
developed in Aula Dei, an experimental station on Zaragoza, enumerating the list of functions that we
are going to test in this station.

We can conclude that the adoption of IoT and OPC UA facilitates water management companies the
access to a wider global market and incorporates new beneﬁts to decisions support systems, monitoring,
water governance and also water-energy nexus. Future work will describe the performed test and will
focus on the contribution to solve coordination problems when executing multiple recipes over the same
physical resources, considering priority and conditional executions and also process optimization.

20

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Acknowledgments

This work is partially supported by MEGA, a join research effort of Tragsa and UPM. It is also supported
by CALISTA project, TEC2012-32457, awarded by the Ministry of Economy and Competitiveness in
Spain.

References

[1] United Nations. Global Sustainable Development Report – Executive Summary: Building the Common Fu-
ture We Want. New York: United Nations Department of Economic and Social Affairs, Division for Sustain-
able Development. 2013. http://sustainabledevelopment.un.org/globalsdreport/, last viewed November 2014.
[2] T. Robles, R. Alcarria, D. Mart´ın, and A. Morales, “An Internet of Things-based model for smart water
management,” in Proc. of the 8th International Conference on Advanced Information Networking and Appli-
cations Workshops (WAINA’14), Victoria, Canada.

IEEE, May 2014, pp. 821–826.

[3] HollandTrade, homepage: http://www.hollandtrade.com/, last viewed November 2014, 2014.
[4] Association of Water Technologies, homepage: http://www.awt.org/, last viewed November 2014, 2014.
[5] EU Water Framework Directive (Directive 2000/60/EC), 2000.
[6] TRAGSA group home page: http://www.tragsa.es/en/, last viewed November 2014.
[7] MEGA project homepage: http://www.gestiondelagua.es/en/, last viewed November 2014.
[8] OPC homepage: https://opcfoundation.org, last viewed November 2014.
[9] J. Gubbi, R. Buyya, S. Marusic, and M. Palaniswami, “Building the common future we want,” United Nations

Department of Economic and Social Affairs, 2013.

[10] M. Weiser, R. Gold, and J. S. Brown, “The Origins of Ubiquitous Computing Research at PARC in the Late

1980s,” IBM Systems Journal, vol. 38, no. 4, pp. 693–696, December 1999.

[11] R. Alcarria, T. Robles, A. Morales, D. L. de Ipi˜na, and U. Aguilera, “Enabling ﬂexible and continuous
capability invocation in mobile prosumer environments,” Sensors, vol. 12, no. 7, pp. 8930–8954, June 2012.
[12] R. Alcarria, T. Robles, A. Morales, and E. Cede˜no, “Resolving coordination challenges in distributed mobile
service executions,” International Journal of Web and Grid Services, vol. 10, no. 2, pp. 168–191, January
2014.

[13] E. Serrano, P. Moncada, M. Garijo, and C. Iglesias, “Evaluating social choice techniques into intelligent
environments by agent based social simulation,” Information Sciences, vol. 286, pp. 102–124, December
2014.

[14] L. Atzori, A. Iera, and G. Morabito, “The Internet of Things: A survey,” Computer Networks, vol. 54, no. 15,

pp. 2787–2805, October 2010.

[15] D. Miorandi, S. Sicari, F. D. Pellegrini, and I. Chlamtac, “Internet of things: Vision, applications and research

challenges,” Ad Hoc Networks, vol. 10, no. 7, pp. 1497–1516, September 2012.

[16] AENOR EN 61512: Batch control – Part 2: Data structures and guidelines for languages, 2002.
[17] AENOR EN 62264: Enterprise-control system integration - Part 1: Models and terminology, 2013.
[18] M. Melik-Merkumians, T. Baier, M. Steinegger, W. Lepuschitz, I. Hegny, and A. Zoitl, “Towards OPC UA
as portable SOA middleware between control software and external added value applications,” in Proc. of
the 17th IEEE Conference on Emerging Technologies and Factory Automation (ETFA’12), Krak´ow, Poland.
IEEE, September 2012, pp. 1–8.

[19] J. Imtiaz and J. Jasperneite, “Scalability of OPC-UA down to the chip level enables Internet of Things,” in
Proc. of the 11th IEEE International Conference on Industrial Informatics (INDIN’13), Bochum, Germany.
IEEE, July 2013, pp. 500–505.

[20] PSI Directive (2003/98/EC). Directive on the re-use of public sector information entered into force on 31

December 2003, European Commission.

——————————————————————————

21

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Author Biography

Tom´as Robles received a M.S. and Ph.D. degrees in Telecommunication Engineering
from Technical University of Madrid in 1987 and 1991 respectively. Since 1991 he is
associate professor on Telematics Engineering at the E.T.S.I. Telecommunication of
the Technical University of Madrid. His research interest is focused on Advanced Ap-
plications and services for Broadband networks, both wired and wireless networks.

Ram´on Alcarria received his M.S. and Ph.D. degrees in Telecommunication En-
gineering from the Technical University of Madrid in 2008 and 2013 respectively.
Currently, he is an assistant professor at the E.T.S.I Topography of the Technical Uni-
versity of Madrid. His research interests are Service Architectures, Sensor Networks,
Service Composition and Prosumer Environments.

Diego Mart´ın received his doctoral degree in 2012, holds a B.Sc in Computer En-
gineering and an M.S. in Computer Science from the Department of Informatics at
the Carlos III University of Madrid, Spain. His main research areas are Software
Process Improvement, Knowledge Management and Reutilization and Prosumer En-
vironments.

Mariano Navarro graduated as Telecommunications Engineer from Technical Uni-
versity of Madrid in 1990. He is currently working as the Head of the ICT Unit since
2005. He has been working in TRAGSA Group, (Tragsa & Tragsatec) for 18 years.
Expert on Open Innovation and Social Spaces for Research and Innovation, also par-
ticipates and coordinates several EU projects. Member of ENoLL, leader of TRAGSA
Living lab, and member of SSRI network.

Rodrigo Calero graduated in Agricultural Engineering, specialization in Rural Engi-
neering, from University of Cordoba. Since 1999, he is working in Tragsa Group in
the R&D Unit in areas related to water treatment, water management, irrigation, rural
infrastructures, biomass and energy usage. He is currently Head of Department in the
R&D Unit. In this sense, he has coordinated some R&D national projects and he is
the author of some patents and papers.

22

An IoT based reference architecture

Robles, Alcarria, Mart´ın, Navarro, Calero, Iglesias and L´opez

Sof´ıa Iglesias graduated in Agricultural Engineering from Technical University of
Madrid (2001). Master in International Trade (CESMA). After one year being em-
ployed at the commercial area as international product manager, she started working
in Tragsa 10 years ago. She participates in water-related national and international
projects, implements water management and civil engineering projects and teaches
water and project management at the School of Engineering and Architecture.

Manuel L´opez received a Ph.D. degree from the University of C´ordoba. Expert in
Applied Physics, Analysis, Simulation and Control Advanced Techniques Program
(2007). He is also Agricultural Engineer specialized in rural engineering. He has been
working in Tragsa Group for 25 years. He assumed the head of the Innovation and
R&D unit for 15 years. He has coordinated several R&D national and international
projects and he is author of several papers, book chapters, and patents. Currently, he
is the Technical Support Deputy Director in Tragsa.

23

